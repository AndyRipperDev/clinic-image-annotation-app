/*! For license information please see annotorious-selector-pack.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Annotorious=e():(t.Annotorious=t.Annotorious||{},t.Annotorious.SelectorPack=e())}(self,(()=>(()=>{var t={495:t=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}t.exports=function t(n,r){if(n===r)return!0;if(n&&r&&"object"==e(n)&&"object"==e(r)){if(n.constructor!==r.constructor)return!1;var o,i,u;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!t(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(u=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,u[i]))return!1;for(i=o;0!=i--;){var a=u[i];if(!t(n[a],r[a]))return!1}return!0}return n!=n&&r!=r}},154:t=>{function e(){}e.prototype={on:function(t,e,n){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var r=this;function o(){r.off(t,o),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),r=n[t],o=[];if(r&&e)for(var i=0,u=r.length;i<u;i++)r[i].fn!==e&&r[i].fn._!==e&&o.push(r[i]);return o.length?n[t]=o:delete n[t],this}},t.exports=e,t.exports.TinyEmitter=e}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};return(()=>{"use strict";n.d(r,{default:()=>wo});var t,e=n(154),o=n.n(e),i="http://www.w3.org/2000/svg",u=new Uint8Array(16);function a(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(u)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var l=[],s=0;s<256;++s)l.push((s+256).toString(16).substr(1));const f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&c.test(t)}(n))throw TypeError("Stringified UUID is invalid");return n},p=function(t,e,n){var r=(t=t||{}).random||(t.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=r[o];return e}return f(r)};var b,y=n(495),d=n.n(y);function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function w(t,e,n){return(e=O(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==m(e)?e:e+""}var S=function(){return t=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),w(this,"clone",(function(e,n){return new t(v(v({},r.underlying),e),v(v({},r.opts),n))})),w(this,"selector",(function(t){var e=r.underlying.target;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((function(e){return e.type===t}))})),this.underlying=e,this.opts=n},(e=[{key:"isEqual",value:function(t){return"Annotation"===(null==t?void 0:t.type)&&(this.underlying===t.underlying||!(!this.underlying.id||!t.underlying.id)&&d()(this.underlying,t.underlying))}},{key:"readOnly",get:function(){var t;return null===(t=this.opts)||void 0===t?void 0:t.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(t){this.underlying.body=t}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){var t;return null===(t=this.selector("TextQuoteSelector"))||void 0===t?void 0:t.exact}},{key:"start",get:function(){var t;return null===(t=this.selector("TextPositionSelector"))||void 0===t?void 0:t.start}},{key:"end",get:function(){var t;return null===(t=this.selector("TextPositionSelector"))||void 0===t?void 0:t.end}}])&&g(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function x(t,e,n){return(e=C(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t){var e=function(t,e){if("object"!=j(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==j(e)?e:e+""}b=S,w(S,"create",(function(t){var e={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(p()),body:[]};return new b(v(v({},e),t))}));var k=function(){return t=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),x(this,"clone",(function(e){var n=new t;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),e&&(n.underlying=E(E({},n.underlying),e)),n})),x(this,"selector",(function(t){var e=r.underlying.target;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((function(e){return e.type===t}))})),x(this,"toAnnotation",(function(){var t=Object.assign({},r.underlying,{type:"Annotation",id:"#".concat(p())});return new S(t)})),this.underlying={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Selection",body:n||[],target:e}},(e=[{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(t){return!!t&&d()(this.underlying,t.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){var t;return null===(t=this.selector("TextQuoteSelector"))||void 0===t?void 0:t.exact}},{key:"isSelection",get:function(){return!0}}])&&A(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,U(r.key),r)}}function G(t,e,n){return e&&T(t.prototype,e),n&&T(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function R(t,e,n){return e=N(e),function(t,e){if(e&&("object"===M(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,D()?Reflect.construct(e,n||[],N(t).constructor):e.apply(t,n))}function D(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(D=function(){return!!t})()}function N(t){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},N(t)}function L(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}function H(t,e){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H(t,e)}function B(t,e,n){return(e=U(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function U(t){var e=function(t,e){if("object"!=M(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==M(e)?e:e+""}var q="An implementation is missing",X="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,F=function(t){function e(t,n,r){var o;_(this,e),B(o=R(this,e),"enableResponsive",(function(){window.ResizeObserver&&(o.resizeObserver=new ResizeObserver((function(){var t=o.svg.getBoundingClientRect(),e=o.svg.viewBox.baseVal,n=e.width,r=e.height;o.scale=Math.max(n/t.width,r/t.height),o.onScaleChanged&&o.onScaleChanged(o.scale)})),o.resizeObserver.observe(o.svg.parentNode))})),B(o,"getSVGPoint",(function(t){var e=o.svg.createSVGPoint();if(X){var n=o.svg.getBoundingClientRect(),r=t.clientX-n.x,i=t.clientY-n.y,u=o.svg.getBoundingClientRect(),a=u.left,c=u.top;return e.x=r+a,e.y=i+c,e.matrixTransform(o.g.getScreenCTM().inverse())}return e.x=t.offsetX,e.y=t.offsetY,e.matrixTransform(o.g.getCTM().inverse())})),B(o,"drawHandle",(function(t,e){var n=document.createElementNS(i,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(i,"g"),u=function(n){var r=document.createElementNS(i,"circle");return r.setAttribute("cx",t),r.setAttribute("cy",e),r.setAttribute("r",n),r.setAttribute("transform-origin","".concat(t," ").concat(e)),r},a=o.config.handleRadius||6,c=u(a);c.setAttribute("class","a9s-handle-inner");var l=u(a+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),B(o,"setHandleXY",(function(t,e,n){var r=t.querySelector(".a9s-handle-inner");r.setAttribute("cx",e),r.setAttribute("cy",n),r.setAttribute("transform-origin","".concat(e," ").concat(n));var o=t.querySelector(".a9s-handle-outer");o.setAttribute("cx",e),o.setAttribute("cy",n),o.setAttribute("transform-origin","".concat(e," ").concat(n))})),B(o,"getHandleXY",(function(t){var e=t.querySelector(".a9s-handle-outer");return{x:parseFloat(e.getAttribute("cx")),y:parseFloat(e.getAttribute("cy"))}})),B(o,"scaleHandle",(function(t){var e=t.querySelector(".a9s-handle-inner"),n=t.querySelector(".a9s-handle-outer"),r=o.scale*(o.config.handleRadius||6);e.setAttribute("r",r),n.setAttribute("r",r)})),o.svg=t.closest("svg"),o.g=t,o.config=n,o.env=r,o.scale=1;var u=r.image;return(u instanceof Element||u instanceof HTMLDocument)&&o.enableResponsive(),o}return L(e,t),G(e,[{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}])}(o()),V=function(t){function e(t,n,r){var o;return _(this,e),B(o=R(this,e,[t,n,r]),"attachListeners",(function(t){var e=t.mouseMove,n=t.mouseUp,r=t.dblClick;e&&(o.mouseMove=function(t){var n=o.getSVGPoint(t),r=n.x,i=n.y;o.started||(o.emit("startSelection",{x:r,y:i}),o.started=!0),e(r,i,t)},o.svg.addEventListener("mousemove",o.mouseMove)),n&&(o.mouseUp=function(t){if(0===t.button){var e=o.getSVGPoint(t),r=e.x,i=e.y;n(r,i,t)}},document.addEventListener("mouseup",o.mouseUp)),r&&(o.dblClick=function(t){var e=o.getSVGPoint(t),n=e.x,i=e.y;r(n,i,t)},document.addEventListener("dblclick",o.dblClick))})),B(o,"detachListeners",(function(){o.mouseMove&&o.svg.removeEventListener("mousemove",o.mouseMove),o.mouseUp&&document.removeEventListener("mouseup",o.mouseUp),o.dblClick&&document.removeEventListener("dblclick",o.dblClick)})),B(o,"start",(function(t,e){var n=o.getSVGPoint(t),r=n.x,i=n.y,u=o.env.image,a=u.naturalWidth,c=u.naturalHeight,l=r<0?0:r>a?a:r,s=i<0?0:i>c?c:i;o.startDrawing(l,s,e,t)})),B(o,"startDrawing",(function(t){throw new Error(q)})),B(o,"createEditableShape",(function(t,e){throw new Error(q)})),o.started=!1,o}return L(e,t),G(e,[{key:"isDrawing",get:function(){throw new Error(q)}}])}(F);function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,K(r.key),r)}}function I(t,e,n){return e=$(e),function(t,e){if(e&&("object"===Y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,W()?Reflect.construct(e,n||[],$(t).constructor):e.apply(t,n))}function W(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(W=function(){return!!t})()}function $(t){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$(t)}function Z(t,e){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Z(t,e)}function K(t){var e=function(t,e){if("object"!=Y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}V.supports=function(t){throw new Error(q)};var J="An implementation is missing",Q=function(t){function e(t,n,r,o){var i,u,a,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),u=i=I(this,e,[n,r,o]),c=function(t){throw new Error(J)},(a=K(a="updateState"))in u?Object.defineProperty(u,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):u[a]=c,i.annotation=t,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Z(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){throw new Error(J)}}])&&z(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F),tt=function(t){var e=function(t){Array.from(t.attributes).forEach((function(e){e.name.startsWith("on")&&t.removeAttribute(e.name)}))},n=t.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(t){return t.parentNode.removeChild(t)})),e(t),Array.from(t.querySelectorAll("*")).forEach(e),t},et=function(t){var e,n,r=t.selector("SvgSelector");if(r){var o=new DOMParser,u=r.value,a=o.parseFromString(u,"image/svg+xml"),c=a.lookupPrefix(i),l=a.lookupNamespaceURI(null);return c||l?tt(a).firstChild:tt((e=a,n=(new XMLSerializer).serializeToString(e.documentElement).replace("<svg>",'<svg xmlns="'.concat(i,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},nt=function(t){var e=et(t),n=document.createElementNS(i,"g"),r=e.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=e.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},rt=function(t,e){var n=t.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(i,'"'),""),{source:null==e?void 0:e.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}};function ot(t){return function(t){if(Array.isArray(t))return it(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return it(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?it(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ut=/firefox/i.test(navigator.userAgent),at=function(t,e,n,r,o){t.setAttribute("width",r),t.setAttribute("height",o),ut?(t.setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("transform","translate(".concat(e,", ").concat(n,")"))):(t.setAttribute("x",e),t.setAttribute("y",n))},ct=function(t,e,n){if(!n)return t;var r=n.reduce((function(t,n){var r=n(e);if(!r)return t;if("string"==typeof r||r instanceof String)t.className=t.className?"".concat(t.className," ").concat(r):r;else if(r.nodeType===Node.ELEMENT_NODE)t.elements=t.elements?[].concat(ot(t.elements),[r]):[r];else{var o=r.className,i=r.style,u=r.element;o&&(t.className=t.className?"".concat(t.className," ").concat(o):o),i&&(t.style=t.style?"".concat(t.style," ").concat(i):i),u&&(t.elements=t.elements?[].concat(ot(t.elements),[u]):[u])}for(var a in r)r.hasOwnProperty(a)&&a.startsWith("data-")&&(t[a]=r[a]);return t}),{}),o=r.className,u=r.style,a=r.elements;if(o&&function(t,e){var n=function(t){var e=t.getAttribute("class");return e?new Set(e.split(" ")):new Set}(t);n.add(e),t.setAttribute("class",Array.from(n).join(" "))}(t,o),u){var c=t.querySelector(".a9s-outer"),l=t.querySelector(".a9s-inner");c&&l?(c.setAttribute("style","display:none"),l.setAttribute("style",u)):t.setAttribute("style",u)}for(var s in a&&a.forEach((function(e){return function(t,e){var n=e.getBBox(),r=n.x,o=n.y,u=n.width,a=n.height,c=document.createElementNS(i,"svg");c.setAttribute("class","a9s-formatter-el"),at(c,r,o,u,a);var l=document.createElementNS(i,"g");l.appendChild(t),c.appendChild(l),e.append(c)}(e,t)})),r)r.hasOwnProperty(s)&&s.startsWith("data-")&&t.setAttribute(s,r[s])},lt=function(t,e,n,r,o){var i=t.querySelector(".a9s-formatter-el");i&&at(i,e,n,r,o)};function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function ft(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vt(r.key),r)}}function pt(t,e,n){return e=mt(e),function(t,e){if(e&&("object"===st(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bt()?Reflect.construct(e,n||[],mt(t).constructor):e.apply(t,n))}function bt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(bt=function(){return!!t})()}function yt(t,e){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yt(t,e)}function dt(){return dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},dt.apply(this,arguments)}function mt(t){return mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mt(t)}function ht(t,e,n){return(e=vt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vt(t){var e=function(t,e){if("object"!=st(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=st(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==st(e)?e:e+""}var gt=function(t){var e=t.getAttribute("d").match(/M(\S+),(\S+)/);return e?[parseFloat(e[1]),parseFloat(e[2])+25]:[0,0]},wt=function(t){return t.querySelector(".a9s-inner").getBBox()},Ot=function(t){function e(t,n,r,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ht(u=pt(this,e,[t,n,r,o]),"setPoint",(function(t){var e=parseFloat(t[0]),n=parseFloat(t[1]),r="M"+e+","+(n-25)+" V"+(n+25)+" M"+(e-25)+","+n+" H"+(e+25);u.shape.querySelector(".a9s-inner").setAttribute("d",r);var o=u.shape.querySelector(".a9s-outer");o.setAttribute("d",r);var i=o.getBBox(),a=i.x,c=i.y,l=i.width,s=i.height;lt(u.elementGroup,a,c,l,s)})),ht(u,"onGrab",(function(t){return function(e){u.grabbedElem=t;var n=u.getSVGPoint(e);u.grabbedAt={x:n.x,y:n.y}}})),ht(u,"onMouseMove",(function(t){var e=function(t,e,n){return t+e<0?-t:t+e>n?n-t:e};if(u.grabbedElem){var n=u.getSVGPoint(t),r=wt(u.shape),o=r.x,i=r.y,a=r.width,c=r.height;if(u.grabbedElem===u.shape){var l=u.env.image,s=l.naturalWidth,f=l.naturalHeight,p=e(o,n.x-u.grabbedAt.x,s-a),b=e(i,n.y-u.grabbedAt.y,f-c),y=u.shape.querySelector(".a9s-inner"),d=gt(y);d[0]=d[0]+p,d[1]=d[1]+b,u.grabbedAt=n,u.setPoint(d),u.emit("update",rt(u.shape,u.env.image))}}})),ht(u,"onMouseUp",(function(t){u.grabbedElem=null,u.grabbedAt=null})),ht(u,"updateState",(function(t){var e=gt(et(t));u.setPoint(e)})),ht(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),dt(mt(e.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=nt(t),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.shape),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ct(u.shape,t,r.formatter),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape));var a=wt(u.shape);return a.x,a.y,a.width,a.height,u.grabbedElem=null,u.grabbedAt=null,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yt(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}}])&&ft(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function St(t){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(t)}function jt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Pt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(n),!0).forEach((function(e){At(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xt(r.key),r)}}function At(t,e,n){return(e=xt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xt(t){var e=function(t,e){if("object"!=St(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=St(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==St(e)?e:e+""}var Ct=function(){return t=function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),At(this,"setPoint",(function(t){o.group.style.display=null;var e=parseFloat(t[0]),n=parseFloat(t[1]),r="M"+e+","+(n-25)+" V"+(n+25)+" M"+(e-25)+","+n+" H"+(e+25);o.outer.setAttribute("d",r),o.inner.setAttribute("d",r)})),At(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),At(this,"dragTo",(function(t){o.setPoint(t)})),At(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.pointcross=null,o.group=null})),At(this,"toSelection",(function(){return new k(Pt(Pt({},rt(o.group,o.env.image)),{},{renderedVia:{name:"pointcross"}}))})),this.point=e,this.env=r,this.group=document.createElementNS(i,"g"),this.pointcross=document.createElementNS(i,"g"),this.pointcross.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoint(this.point),this.pointcross.appendChild(this.outer),this.pointcross.appendChild(this.inner),this.group.appendChild(this.pointcross),n.appendChild(this.group)},(e=[{key:"element",get:function(){return this.pointcross}}])&&Et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Nt(r.key),r)}}function _t(t,e,n){return e=Gt(e),function(t,e){if(e&&("object"===kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Tt()?Reflect.construct(e,n||[],Gt(t).constructor):e.apply(t,n))}function Tt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Tt=function(){return!!t})()}function Gt(t){return Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gt(t)}function Rt(t,e){return Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Rt(t,e)}function Dt(t,e,n){return(e=Nt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nt(t){var e=function(t,e){if("object"!=kt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kt(e)?e:e+""}var Lt=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Dt(o=_t(this,e,[t,n,r]),"startDrawing",(function(t,e){o.pointcrossSelection=new Ct([t,e],o.g,o.env);var n=o.pointcrossSelection.element;n.annotation=o.pointcrossSelection.toSelection(),o.emit("complete",n)})),Dt(o,"stop",(function(){})),Dt(o,"createEditableShape",(function(t){return new Ot(t,o.g,o.config,o.env)})),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rt(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return!1}}])&&Mt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Lt.identifier="pointcross",Lt.supports=function(t){var e=t.selector("SvgSelector");if(e)return e.value.match(/^<svg.*<path*/g)&&!e.value.toUpperCase().includes("Z")};var Bt=function(t,e){var n=t.selector("FragmentSelector");if(null!=n&&n.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){var r=n.value,o=r.includes(":")?r.substring(r.indexOf("=")+1,r.indexOf(":")):"pixel",i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ht(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ht(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((r.includes(":")?r.substring(r.indexOf(":")+1):r.substring(r.indexOf("=")+1)).split(",").map(parseFloat),4),u=i[0],a=i[1],c=i[2],l=i[3];return"percent"===o.toLowerCase()&&(u=u*e.naturalWidth/100,a=a*e.naturalHeight/100,c=c*e.naturalWidth/100,l=l*e.naturalHeight/100),{x:u,y:a,w:c,h:l}}};function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function qt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Xt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?qt(Object(n),!0).forEach((function(e){var r,o,i;r=t,o=e,i=n[e],o=function(t){var e=function(t,e){if("object"!=Ut(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ut(e)?e:e+""}(o),o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ft=function(t,e,n,r){return Xt(Xt({},function(t,e,n,r,o,i){return"percent"===(null==i?void 0:i.toLowerCase())?function(t,e,n,r,o){var i=t/o.naturalWidth*100,u=e/o.naturalHeight*100,a=0/o.naturalWidth*100,c=0/o.naturalHeight*100;return{source:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=percent:".concat(i,",").concat(u,",").concat(a,",").concat(c)}}}(t,e,0,0,o):function(t,e,n,r,o){return{source:null==o?void 0:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(t,",").concat(e,",").concat(0,",").concat(0)}}}(t,e,0,0,o)}(t,e,0,0,n,r)),{},{renderedVia:{name:"point"}})};function Vt(t){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}function Yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Jt(r.key),r)}}function zt(t,e,n){return e=$t(e),function(t,e){if(e&&("object"===Vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,It()?Reflect.construct(e,n||[],$t(t).constructor):e.apply(t,n))}function It(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(It=function(){return!!t})()}function Wt(){return Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$t(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Wt.apply(this,arguments)}function $t(t){return $t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$t(t)}function Zt(t,e){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zt(t,e)}function Kt(t,e,n){return(e=Jt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Jt(t){var e=function(t,e){if("object"!=Vt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vt(e)?e:e+""}var Qt=function(t){function e(t,n,r,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Kt(u=zt(this,e,[t,n,r,o]),"onScaleChanged",(function(){return u.scaleHandle(u.point)})),Kt(u,"onGrab",(function(){u.isGrabbed=!0})),Kt(u,"onMouseMove",(function(t){if(0===t.button&&u.isGrabbed){var e=u.getSVGPoint(t),n=e.x,r=e.y;u.setHandleXY(u.point,n,r);var o=Ft(n,r,u.env.image,u.config.fragmentUnit);u.emit("update",o)}})),Kt(u,"onMouseUp",(function(){u.isGrabbed=!1})),Kt(u,"updateState",(function(t){var e=Bt(t,u.env.image),n=e.x,r=e.y;u.setHandleXY(u.point,n,r)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp);var a=Bt(t,o.image),c=a.x,l=a.y;return u.container=document.createElementNS(i,"g"),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.point=u.drawHandle(c,l),u.point.addEventListener("mousedown",u.onGrab),u.elementGroup.appendChild(u.point),u.container.appendChild(u.elementGroup),n.appendChild(u.container),u.isGrabbed=!1,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zt(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),Wt($t(e.prototype),"destroy",this).call(this)}}])&&Yt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ae(r.key),r)}}function ne(t,e,n){return e=oe(e),function(t,e){if(e&&("object"===te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,re()?Reflect.construct(e,n||[],oe(t).constructor):e.apply(t,n))}function re(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(re=function(){return!!t})()}function oe(t){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oe(t)}function ie(t,e){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ie(t,e)}function ue(t,e,n){return(e=ae(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ae(t){var e=function(t,e){if("object"!=te(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=te(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==te(e)?e:e+""}var ce=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ue(o=ne(this,e,[t,n,r]),"startDrawing",(function(t,e,n,r){var i,u=null===(i=r.target.closest(".a9s-annotation"))||void 0===i?void 0:i.annotation;if(u&&function(t){var e;return"point"===(null===(e=t.target.renderedVia)||void 0===e?void 0:e.name)}(u))o.emit("cancel");else{var a=o.drawHandle(t,e);o.scaleHandle(a),o.g.appendChild(a),a.annotation=new k(Ft(t,e,o.env.image,o.config.fragmentUnit)),o.emit("complete",a)}})),ue(o,"stop",(function(){})),ue(o,"createEditableShape",(function(t){return new Qt(t,o.g,o.config,o.env)})),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ie(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return!1}}])&&ee(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);ce.identifier="point",ce.supports=function(t){return!1};var le=function(t,e,n,r){t.setAttribute("cx",e),t.setAttribute("cy",n),t.setAttribute("r",r)},se=function(t,e,n,r){var o=t.querySelector(".a9s-inner"),i=t.querySelector(".a9s-outer");le(o,e,n,r),le(i,e,n,r)},fe=function(t){var e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),r:parseFloat(e.getAttribute("r"))}};function pe(t){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(t)}function be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,de(r.key),r)}}function ye(t,e,n){return(e=de(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function de(t){var e=function(t,e){if("object"!=pe(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pe(e)?e:e+""}var me=function(){return t=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ye(this,"redraw",(function(){var t=fe(r.circle),e=t.cx,n=t.cy,o=t.r,i=e+o>r.w?r.w-o:e,u=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(u," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),ye(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.circle=n;var o=fe(this.circle),u=o.cx,a=o.cy,c=o.r,l=u+c>this.w?this.w-c:u,s=a+c>this.h?this.h-c:a+c;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))},(e=[{key:"element",get:function(){return this.mask}}])&&be(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function he(t){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(t)}function ve(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,we(r.key),r)}}function ge(t,e,n){return(e=we(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function we(t){var e=function(t,e){if("object"!=he(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=he(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==he(e)?e:e+""}var Oe=function(){return t=function t(e,n,r,o){var u=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ge(this,"dragTo",(function(t,e){var n=u.env.image,r=n.naturalWidth,o=n.naturalHeight;u.group.style.display=null;var i=t-u.anchor[0],a=e-u.anchor[1],c=Math.max(1,Math.pow(Math.pow(i,2)+Math.pow(a,2),.5)/2),l=u.anchor[0]+i/2,s=u.anchor[1]+a/2;l-c<0||l+c>r||s-c<0||s+c>o||(se(u.circle,l,s,c),u.mask.redraw())})),ge(this,"getBoundingClientRect",(function(){return u.circle.getBoundingClientRect()})),ge(this,"toSelection",(function(){return new k(rt(u.group,u.env.image))})),ge(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.circle=null,u.group=null})),this.anchor=[e,n],this.env=o,this.group=document.createElementNS(i,"g"),this.circle=function(t,e,n){var r=document.createElementNS(i,"g"),o=document.createElementNS(i,"circle"),u=document.createElementNS(i,"circle");return u.setAttribute("class","a9s-inner"),le(u,t,e,2),o.setAttribute("class","a9s-outer"),le(o,t,e,2),r.appendChild(o),r.appendChild(u),r}(e,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new me(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)},(e=[{key:"element",get:function(){return this.circle}}])&&ve(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function je(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Pe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Te(r.key),r)}}function Ae(t,e,n){return e=ke(e),function(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xe()?Reflect.construct(e,n||[],ke(t).constructor):e.apply(t,n))}function xe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xe=function(){return!!t})()}function Ce(){return Ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ke(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ce.apply(this,arguments)}function ke(t){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ke(t)}function Me(t,e){return Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Me(t,e)}function _e(t,e,n){return(e=Te(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Te(t){var e=function(t,e){if("object"!=Se(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Se(e)?e:e+""}var Ge=function(t){function e(t,n,r,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),_e(u=Ae(this,e,[t,n,r,o]),"setSize",(function(t,e,n){se(u.circle,t,e,n),u.mask.redraw(),lt(u.elementGroup,t,e,n,n);var r=je(u.handles,4),o=r[0],i=r[1],a=r[2],c=r[3];u.setHandleXY(o,t,e-n),u.setHandleXY(i,t+n,e),u.setHandleXY(a,t,e+n),u.setHandleXY(c,t-n,e)})),_e(u,"stretchCorners",(function(t,e,n){var r,o=u.getHandleXY(e),i=n.x,a=n.y,c=0,l=0;0==t||2==t?(i=o.x,l=a-o.y,r=Math.abs(l)/2):(a=o.y,c=i-o.x,r=Math.abs(c)/2);var s=c>0?o.x:i,f=l>0?o.y:a,p=s+Math.abs(c)/2,b=f+Math.abs(l)/2;if(se(u.circle,p,b,r),u.mask.redraw(),lt(u.elementGroup,p,b,r,r),0==t||2==t){var y=0,d=2;(0==t&&l>0||2==t&&l<0)&&(y=2,d=0),u.setHandleXY(u.handles[y],p,b-r),u.setHandleXY(u.handles[d],p,b+r),u.setHandleXY(u.handles[1],p+r,b),u.setHandleXY(u.handles[3],p-r,b)}else{var m=3,h=1;(1==t&&c>0||3==t&&c<0)&&(m=1,h=3),u.setHandleXY(u.handles[m],p+r,b),u.setHandleXY(u.handles[h],p-r,b),u.setHandleXY(u.handles[0],p,b-r),u.setHandleXY(u.handles[2],p,b+r)}})),_e(u,"onGrab",(function(t){return function(e){u.grabbedElem=t;var n=u.getSVGPoint(e),r=fe(u.circle),o=r.cx,i=r.cy;u.grabbedAt={x:n.x-o,y:n.y-i}}})),_e(u,"onMouseMove",(function(t){var e=function(t,e){return t<0?0:t>e?e:t};if(u.grabbedElem){var n=u.getSVGPoint(t);if(u.grabbedElem===u.circle){var r=fe(u.circle).r,o=u.env.image,i=o.naturalWidth,a=o.naturalHeight,c=Math.max(e(n.x-u.grabbedAt.x,i-r),r),l=Math.max(e(n.y-u.grabbedAt.y,a-r),r);u.setSize(c,l,r),u.emit("update",rt(u.circle,u.env.image))}else{var s=u.handles.indexOf(u.grabbedElem),f=s<2?u.handles[s+2]:u.handles[s-2];u.stretchCorners(s,f,n),u.emit("update",rt(u.circle,u.env.image))}}})),_e(u,"onMouseUp",(function(){u.grabbedElem=null,u.grabbedAt=null})),_e(u,"onScaleChanged",(function(t){return u.handles.map(u.scaleHandle)})),_e(u,"updateState",(function(t){var e=et(t),n=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),o=parseFloat(e.getAttribute("r"));u.setSize(n,r,o)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.circle=nt(t),u.circle.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.circle)),u.mask=new me(o.image,u.circle),u.containerGroup.appendChild(u.mask.element),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.circle);var a=fe(u.circle),c=a.cx,l=a.cy,s=a.r;return u.handles=[[c,l-s],[c+s,l],[c,l+s],[c-s,l]].map((function(t){var e=je(t,2),n=e[0],r=e[1],o=u.drawHandle(n,r);return o.addEventListener("mousedown",u.onGrab(o)),u.elementGroup.appendChild(o),o})),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ct(u.circle,t,r.formatter),u.grabbedElem=null,u.grabbedAt=null,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Me(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),Ce(ke(e.prototype),"destroy",this).call(this)}}])&&Ee(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function Re(t){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Re(t)}function De(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qe(r.key),r)}}function Ne(t,e,n){return e=He(e),function(t,e){if(e&&("object"===Re(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Le()?Reflect.construct(e,n||[],He(t).constructor):e.apply(t,n))}function Le(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Le=function(){return!!t})()}function He(t){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},He(t)}function Be(t,e){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Be(t,e)}function Ue(t,e,n){return(e=qe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qe(t){var e=function(t,e){if("object"!=Re(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Re(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Re(e)?e:e+""}var Xe=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Ue(o=Ne(this,e,[t,n,r]),"startDrawing",(function(t,e){o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp}),o.rubberband=new Oe(t,e,o.g,o.env)})),Ue(o,"stop",(function(){o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),Ue(o,"onMouseMove",(function(t,e){return o.rubberband.dragTo(t,e)})),Ue(o,"onMouseUp",(function(){o.detachListeners(),o.started=!1;var t=o.rubberband.getBoundingClientRect(),e=t.width,n=t.height,r=o.config.minSelectionWidth||4,i=o.config.minSelectionHeight||4;if(e>=r&&n>=i){var u=o.rubberband.element;u.annotation=o.rubberband.toSelection(),o.emit("complete",u)}else o.emit("cancel");o.stop()})),Ue(o,"createEditableShape",(function(t){return new Ge(t,o.g,o.config,o.env)})),o.rubberband=null,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Be(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&De(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);Xe.identifier="circle",Xe.supports=function(t){var e,n=t.selector("SvgSelector");if(n)return null===(e=n.value)||void 0===e?void 0:e.match(/^<svg.*<circle/g)};var Fe=function(t,e,n,r,o){t.setAttribute("cx",e),t.setAttribute("cy",n),t.setAttribute("rx",r),t.setAttribute("ry",o)},Ve=function(t,e,n,r,o){var i=t.querySelector(".a9s-inner"),u=t.querySelector(".a9s-outer");Fe(i,e,n,r,o),Fe(u,e,n,r,o)},Ye=function(t){var e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),rx:parseFloat(e.getAttribute("rx")),ry:parseFloat(e.getAttribute("ry"))}};function ze(t){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ze(t)}function Ie(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$e(r.key),r)}}function We(t,e,n){return(e=$e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $e(t){var e=function(t,e){if("object"!=ze(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ze(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ze(e)?e:e+""}var Ze=function(){return t=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),We(this,"redraw",(function(){var t=Ye(r.ellipse),e=t.cx,n=t.cy,o=t.rx,i=t.ry,u=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(e," ").concat(u," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),We(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.ellipse=n;var o=Ye(this.ellipse),u=o.cx,a=o.cy,c=o.rx,l=o.ry,s=a+l;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(u," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))},(e=[{key:"element",get:function(){return this.mask}}])&&Ie(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Ke(t){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ke(t)}function Je(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tn(r.key),r)}}function Qe(t,e,n){return(e=tn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tn(t){var e=function(t,e){if("object"!=Ke(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ke(e)?e:e+""}var en=function(){return t=function t(e,n,r,o){var u=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Qe(this,"dragTo",(function(t,e){u.group.style.display=null;var n=t-u.anchor[0],r=e-u.anchor[1],o=n>0?u.anchor[0]+n/2:t+n/2,i=r>0?u.anchor[1]+r/2:e+r/2,a=Math.abs(n/2),c=Math.abs(r/2);Ve(u.ellipse,o,i,a,c),u.mask.redraw()})),Qe(this,"getBoundingClientRect",(function(){return u.ellipse.getBoundingClientRect()})),Qe(this,"toSelection",(function(){return new k(rt(u.group,u.env.image))})),Qe(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.ellipse=null,u.group=null})),this.anchor=[e,n],this.env=o,this.group=document.createElementNS(i,"g"),this.ellipse=function(t,e,n,r){var o=document.createElementNS(i,"g"),u=document.createElementNS(i,"ellipse"),a=document.createElementNS(i,"ellipse");return u.setAttribute("class","a9s-inner"),Fe(u,t,e,2,r),a.setAttribute("class","a9s-outer"),Fe(a,t,e,2,r),o.appendChild(a),o.appendChild(u),o}(e,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new Ze(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)},(e=[{key:"element",get:function(){return this.ellipse}}])&&Je(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function nn(t){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(t)}function rn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return on(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?on(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function on(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function un(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bn(r.key),r)}}function an(t,e,n){return e=sn(e),function(t,e){if(e&&("object"===nn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,cn()?Reflect.construct(e,n||[],sn(t).constructor):e.apply(t,n))}function cn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(cn=function(){return!!t})()}function ln(){return ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=sn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},ln.apply(this,arguments)}function sn(t){return sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sn(t)}function fn(t,e){return fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fn(t,e)}function pn(t,e,n){return(e=bn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bn(t){var e=function(t,e){if("object"!=nn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=nn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nn(e)?e:e+""}var yn=function(t){function e(t,n,r,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),pn(u=an(this,e,[t,n,r,o]),"setSize",(function(t,e,n,r){Ve(u.ellipse,t,e,n,r),u.mask.redraw(),lt(u.elementGroup,t,e,n,r);var o=rn(u.handles,4),i=o[0],a=o[1],c=o[2],l=o[3];u.setHandleXY(i,t,e-r),u.setHandleXY(a,t+n,e),u.setHandleXY(c,t,e+r),u.setHandleXY(l,t-n,e)})),pn(u,"stretchCorners",(function(t,e,n,r){var o=u.getHandleXY(e),i=u.getHandleXY(n),a=r.x,c=r.y,l=0,s=0;0==t||2==t?a=o.x:c=o.y;var f=a-o.x,p=c-o.y,b=f>0?o.x:a,y=p>0?o.y:c,d=Math.abs(f),m=Math.abs(p),h=b+d/2,v=y+m/2;if(l=d/2,s=m/2,0==t||2==t?l=Math.abs(o.x-i.x):s=Math.abs(o.y-i.y),Ve(u.ellipse,h,v,l,s),u.mask.redraw(),lt(u.elementGroup,h,v,l,s),0==t||2==t){var g=0,w=2;(0==t&&p>0||2==t&&p<0)&&(g=2,w=0),u.setHandleXY(u.handles[g],h,v-s),u.setHandleXY(u.handles[w],h,v+s),u.setHandleXY(u.handles[1],h+l,v),u.setHandleXY(u.handles[3],h-l,v)}else{var O=3,S=1;(1==t&&f>0||3==t&&f<0)&&(O=1,S=3),u.setHandleXY(u.handles[O],h+l,v),u.setHandleXY(u.handles[S],h-l,v),u.setHandleXY(u.handles[0],h,v-s),u.setHandleXY(u.handles[2],h,v+s)}})),pn(u,"onGrab",(function(t){return function(e){u.grabbedElem=t;var n=u.getSVGPoint(e),r=Ye(u.ellipse),o=r.cx,i=r.cy;u.grabbedAt={x:n.x-o,y:n.y-i}}})),pn(u,"onMouseMove",(function(t){var e=function(t,e){return t<0?0:t>e?e:t};if(u.grabbedElem){var n=u.getSVGPoint(t);if(u.grabbedElem===u.ellipse){var r=Ye(u.ellipse),o=r.rx,i=r.ry,a=u.env.image,c=a.naturalWidth,l=a.naturalHeight,s=e(n.x-u.grabbedAt.x,c-o),f=e(n.y-u.grabbedAt.y,l-i);u.setSize(s,f,o,i),u.emit("update",rt(u.ellipse,u.env.image))}else{var p=u.handles.indexOf(u.grabbedElem),b=p<2?u.handles[p+2]:u.handles[p-2],y=u.handles[(p+3)%4];u.stretchCorners(p,b,y,n),u.emit("update",rt(u.ellipse,u.env.image))}}})),pn(u,"onMouseUp",(function(){u.grabbedElem=null,u.grabbedAt=null})),pn(u,"onScaleChanged",(function(t){return u.handles.map(u.scaleHandle)})),pn(u,"updateState",(function(t){var e=et(t),n=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),o=parseFloat(e.getAttribute("rx")),i=parseFloat(e.getAttribute("ry"));u.setSize(n,r,o,i)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.ellipse=nt(t),u.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.ellipse)),u.mask=new Ze(o.image,u.ellipse),u.containerGroup.appendChild(u.mask.element),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.ellipse);var a=Ye(u.ellipse),c=a.cx,l=a.cy,s=a.rx,f=a.ry;return u.handles=[[c,l-f],[c+s,l],[c,l+f],[c-s,l]].map((function(t){var e=rn(t,2),n=e[0],r=e[1],o=u.drawHandle(n,r);return o.addEventListener("mousedown",u.onGrab(o)),u.elementGroup.appendChild(o),o})),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ct(u.ellipse,t,r.formatter),u.grabbedElem=null,u.grabbedAt=null,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fn(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ln(sn(e.prototype),"destroy",this).call(this)}}])&&un(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function dn(t){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dn(t)}function mn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Sn(r.key),r)}}function hn(t,e,n){return e=gn(e),function(t,e){if(e&&("object"===dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vn()?Reflect.construct(e,n||[],gn(t).constructor):e.apply(t,n))}function vn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(vn=function(){return!!t})()}function gn(t){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gn(t)}function wn(t,e){return wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wn(t,e)}function On(t,e,n){return(e=Sn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Sn(t){var e=function(t,e){if("object"!=dn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=dn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dn(e)?e:e+""}var jn=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),On(o=hn(this,e,[t,n,r]),"startDrawing",(function(t,e){o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp}),o.rubberband=new en(t,e,o.g,o.env)})),On(o,"stop",(function(){o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),On(o,"onMouseMove",(function(t,e){return o.rubberband.dragTo(t,e)})),On(o,"onMouseUp",(function(){o.detachListeners(),o.started=!1;var t=o.rubberband.getBoundingClientRect(),e=t.width,n=t.height,r=o.config.minSelectionWidth||4,i=o.config.minSelectionHeight||4;if(e>=r&&n>=i){var u=o.rubberband.element;u.annotation=o.rubberband.toSelection(),o.emit("complete",u)}else o.emit("cancel");o.stop()})),On(o,"createEditableShape",(function(t){return new yn(t,o.g,o.config,o.env)})),o.rubberband=null,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wn(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&mn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Pn(t){return Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pn(t)}function En(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function An(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Cn(r.key),r)}}function xn(t,e,n){return(e=Cn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cn(t){var e=function(t,e){if("object"!=Pn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Pn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pn(e)?e:e+""}jn.identifier="ellipse",jn.supports=function(t){var e,n=t.selector("SvgSelector");if(n)return null===(e=n.value)||void 0===e?void 0:e.match(/^<svg.*<ellipse/g)};var kn=function(){return t=function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),xn(this,"setPoints",(function(t){var e=t.map((function(t){return"L".concat(t[0]," ").concat(t[1])})).join(" ");e="M"+e.substring(1),o.outer.setAttribute("d",e),o.inner.setAttribute("d",e)})),xn(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),xn(this,"dragTo",(function(t){o.group.style.display=null,o.addPoint(t)})),xn(this,"addPoint",(function(t){var e;o.points=[].concat(function(t){if(Array.isArray(t))return En(t)}(e=o.points)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return En(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?En(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t]),o.setPoints(o.points)})),xn(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),xn(this,"toSelection",(function(){return new k(rt(o.group,o.env.image))})),this.points=[e],this.env=r,this.group=document.createElementNS(i,"g"),this.freehand=document.createElementNS(i,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)},(e=[{key:"element",get:function(){return this.freehand}}])&&An(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Mn(t){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mn(t)}function _n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Hn(r.key),r)}}function Tn(t,e,n){return e=Nn(e),function(t,e){if(e&&("object"===Mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Gn()?Reflect.construct(e,n||[],Nn(t).constructor):e.apply(t,n))}function Gn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Gn=function(){return!!t})()}function Rn(t,e){return Rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Rn(t,e)}function Dn(){return Dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Dn.apply(this,arguments)}function Nn(t){return Nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nn(t)}function Ln(t,e,n){return(e=Hn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Hn(t){var e=function(t,e){if("object"!=Mn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Mn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mn(e)?e:e+""}var Bn=function(t){var e=t.getAttribute("d").split("L"),n=[];if(e.length>0){var r=e[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<e.length;o++)r=e[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},Un=function(t){return t.querySelector(".a9s-inner").getBBox()},qn=function(t){function e(t,n,r,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Ln(u=Tn(this,e,[t,n,r,o]),"setPoints",(function(t){var e=function(t){return Math.round(10*t)/10},n=t.map((function(t){return"L".concat(e(t.x)," ").concat(e(t.y))})).join(" ");n="M"+n.substring(1),u.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=u.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,a=o.y,c=o.width,l=o.height;lt(u.elementGroup,i,a,c,l)})),Ln(u,"onGrab",(function(t){return function(e){u.grabbedElem=t;var n=u.getSVGPoint(e);u.grabbedAt={x:n.x,y:n.y}}})),Ln(u,"onMouseMove",(function(t){var e=function(t,e,n){return t+e<0?-t:t+e>n?n-t:e};if(u.grabbedElem){var n=u.getSVGPoint(t),r=Un(u.shape),o=r.x,i=r.y,a=r.width,c=r.height;if(u.grabbedElem===u.shape){var l=u.env.image,s=l.naturalWidth,f=l.naturalHeight,p=e(o,n.x-u.grabbedAt.x,s-a),b=e(i,n.y-u.grabbedAt.y,f-c),y=u.shape.querySelector(".a9s-inner"),d=Bn(y).map((function(t){return{x:t.x+p,y:t.y+b}}));u.grabbedAt=n,u.setPoints(d),u.emit("update",rt(u.shape,u.env.image))}}})),Ln(u,"onMouseUp",(function(t){u.grabbedElem=null,u.grabbedAt=null})),Ln(u,"updateState",(function(t){var e=Bn(et(t));u.setPoints(e)})),Ln(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),Dn(Nn(e.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=nt(t),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.shape),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ct(u.shape,t,r.formatter),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape));var a=Un(u.shape);return a.x,a.y,a.width,a.height,u.grabbedElem=null,u.grabbedAt=null,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rn(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}}])&&_n(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function Xn(t){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xn(t)}function Fn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$n(r.key),r)}}function Vn(t,e,n){return e=zn(e),function(t,e){if(e&&("object"===Xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Yn()?Reflect.construct(e,n||[],zn(t).constructor):e.apply(t,n))}function Yn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Yn=function(){return!!t})()}function zn(t){return zn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zn(t)}function In(t,e){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},In(t,e)}function Wn(t,e,n){return(e=$n(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $n(t){var e=function(t,e){if("object"!=Xn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Xn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xn(e)?e:e+""}var Zn=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Wn(o=Vn(this,e,[t,n,r]),"startDrawing",(function(t,e){o._isDrawing=!0,o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp,dblClick:o.onDblClick}),o.rubberband=new kn([t,e],o.g,o.env)})),Wn(o,"stop",(function(){o.detachListeners(),o._isDrawing=!1,o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),Wn(o,"onMouseMove",(function(t,e){return o.rubberband.dragTo([t,e])})),Wn(o,"onMouseUp",(function(t,e){o.onDblClick(t,e)})),Wn(o,"onDblClick",(function(t,e){o._isDrawing=!1,o.rubberband.addPoint([t,e]),o.detachListeners();var n=o.rubberband.getBoundingClientRect(),r=n.width,i=n.height,u=o.config.minSelectionWidth||4,a=o.config.minSelectionHeight||4;if(r>=u||i>=a){var c=o.rubberband.element;c.annotation=o.rubberband.toSelection(),o.emit("complete",c)}else o.emit("cancel");o.stop()})),Wn(o,"createEditableShape",(function(t){return new qn(t,o.g,o.config,o.env)})),o._isDrawing=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&In(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Fn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Kn(t){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kn(t)}function Jn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tr(r.key),r)}}function Qn(t,e,n){return(e=tr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tr(t){var e=function(t,e){if("object"!=Kn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kn(e)?e:e+""}Zn.identifier="freehand",Zn.supports=function(t){var e=t.selector("SvgSelector");if(e)return e.value.match(/^<svg.*<path*/g)&&!e.value.toUpperCase().includes("Z")};var er=function(){return t=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Qn(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.polygon.getAttribute("points")," z"))})),Qn(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.polygon=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.polygon.getAttribute("points")," z"))},(e=[{key:"element",get:function(){return this.mask}}])&&Jn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function nr(t){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nr(t)}function rr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function or(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rr(Object(n),!0).forEach((function(e){sr(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ir(t){return function(t){if(Array.isArray(t))return cr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ar(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ur(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ar(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){a=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function ar(t,e){if(t){if("string"==typeof t)return cr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cr(t,e):void 0}}function cr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fr(r.key),r)}}function sr(t,e,n){return(e=fr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fr(t){var e=function(t,e){if("object"!=nr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=nr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nr(e)?e:e+""}var pr=function(){return t=function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),sr(this,"setPoints",(function(t){var e,n="",r=ur(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,u="";if(i.length>0){var a,c=ur(i);try{for(c.s();!(a=c.n()).done;){var l=a.value;l&&(u+=""===u?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(t){c.e(t)}finally{c.f()}n+=u}}}catch(t){r.e(t)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),sr(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),sr(this,"dragTo",(function(t){o.group.style.display=null;var e=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(ir(e),[t,e[0]]);n.push(r),o.setPoints(n),o.mask.redraw()})),sr(this,"addPoint",(function(t){if(o.points[o.points.length-1].length>0){var e=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=e[e.length-1];Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(ir(e),[t,e[0]]),o.setPoints(o.points),o.mask.redraw())}else o.points[o.points.length-1]=[t,t],o.setPoints(o.points)})),sr(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),sr(this,"newPart",(function(){o.points.push([])})),sr(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),sr(this,"toSelection",(function(){return new k(or(or({},rt(o.group,o.env.image)),{},{renderedVia:{name:"multipolygon"}}))})),this.points=[],this.points.push([e,e]),this.env=r,this.group=document.createElementNS(i,"g"),this.multipolygon=document.createElementNS(i,"g"),this.multipolygon.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new er(r.image,this.inner),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.multipolygon),n.appendChild(this.group)},(e=[{key:"element",get:function(){return this.multipolygon}}])&&lr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function br(t){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},br(t)}function yr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function dr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yr(Object(n),!0).forEach((function(e){Sr(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function mr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jr(r.key),r)}}function hr(t,e,n){return e=Or(e),function(t,e){if(e&&("object"===br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vr()?Reflect.construct(e,n||[],Or(t).constructor):e.apply(t,n))}function vr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(vr=function(){return!!t})()}function gr(t,e){return gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gr(t,e)}function wr(){return wr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Or(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},wr.apply(this,arguments)}function Or(t){return Or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Or(t)}function Sr(t,e,n){return(e=jr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jr(t){var e=function(t,e){if("object"!=br(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=br(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==br(e)?e:e+""}function Pr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Er(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Er(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){a=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function Er(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ar=function(t){var e,n=[],r=Pr(xr(t.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(e=r.n()).done;){var o,i=e.value,u=[],a=Pr(i);try{for(a.s();!(o=a.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};u.push(l)}}catch(t){a.e(t)}finally{a.f()}n.push(u)}}catch(t){r.e(t)}finally{r.f()}return n},xr=function(t){var e=t.split("M"),n=[];return e.forEach((function(t,e){if(t.length>0){var r=[];(t=(t=(t=(t=(t=t.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(t,e){r.push([parseFloat(t.split(",")[0]).toFixed(2).toString(),parseFloat(t.split(",")[1]).toFixed(2).toString()])})),r[0]!==r[r.length-1]&&r.push(r[0]),n.push(r)}})),n},Cr=function(t){function e(t,n,r,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Sr(u=hr(this,e,[t,n,r,o]),"setPoints",(function(t){var e,n=function(t){return Math.round(10*t)/10},r="",o=Pr(t);try{for(o.s();!(e=o.n()).done;){var i=e.value;r+="M";var a,c=!0,l=Pr(i);try{for(l.s();!(a=l.n()).done;){var s=a.value;c?(c=!1,r+=s.x.toString()+","+s.y.toString()):r+=" L"+n(s.x).toString()+","+n(s.y).toString()}}catch(t){l.e(t)}finally{l.f()}r+=" Z"}}catch(t){o.e(t)}finally{o.f()}u.shape.querySelector(".a9s-inner").setAttribute("d",r);var f=u.shape.querySelector(".a9s-outer");f.setAttribute("d",r);var p=f.getBBox(),b=p.x,y=p.y,d=p.width,m=p.height;lt(u.elementGroup,b,y,d,m)})),Sr(u,"onGrab",(function(t){return function(e){u.grabbedElem=t;var n=u.getSVGPoint(e);u.grabbedAt={x:n.x,y:n.y}}})),Sr(u,"onMouseMove",(function(t){if(u.grabbedElem){var e=u.getSVGPoint(t);if(u.grabbedElem===u.shape){var n,r=e.x-u.grabbedAt.x,o=e.y-u.grabbedAt.y,i=[],a=Pr(Ar(u.shape));try{for(a.s();!(n=a.n()).done;){var c=n.value;i.push(c.map((function(t){return{x:t.x+r,y:t.y+o}})))}}catch(t){a.e(t)}finally{a.f()}u.grabbedAt=e,u.setPoints(i);for(var l=0,s=0,f=i;s<f.length;s++)f[s].forEach((function(t,e){void 0!==u.handles[l][e]&&u.setHandleXY(u.handles[l][e],t.x,t.y)})),l+=1;u.emit("update",dr(dr({},rt(u.shape,u.env.image)),{},{renderedVia:{name:"multipolygon"}}))}else{var p,b=-1,y=0,d=!1,m=Pr(u.handles);try{for(m.s();!(p=m.n()).done;){var h=p.value;h.indexOf(u.grabbedElem)>0?(b=h.indexOf(u.grabbedElem),d=!0):d||(y+=1)}}catch(t){m.e(t)}finally{m.f()}var v,g=Ar(u.shape),w=[],O=0,S=Pr(g);try{var j=function(){var t=v.value;if(O===y){var n=[];t.forEach((function(t,r){r===b?n.push(e):n.push(t)})),w.push(n)}else w.push(t);O+=1};for(S.s();!(v=S.n()).done;)j()}catch(t){S.e(t)}finally{S.f()}u.setPoints(w),O=0;var P,E=Pr(u.handles);try{for(E.s();!(P=E.n()).done;){var A=P.value;O===y&&u.setHandleXY(A[b],e.x,e.y),O+=1}}catch(t){E.e(t)}finally{E.f()}u.emit("update",dr(dr({},rt(u.shape,u.env.image)),{},{renderedVia:{name:"multipolygon"}}))}}})),Sr(u,"onMouseUp",(function(t){u.grabbedElem=null,u.grabbedAt=null})),Sr(u,"updateState",(function(t){var e=Ar(et(t));u.setPoints(e)})),Sr(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),wr(Or(e.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=function(t){var e=et(t);!function(t){var e=et(t).getAttribute("d");xr(e)}(t);var n=document.createElementNS(i,"g"),r=e.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=e.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n}(t),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.shape);var a=Ar(u.shape);u.handles=[];var c,l=Pr(a);try{for(l.s();!(c=l.n()).done;){var s=c.value;u.handles.push(s.map((function(t){var e=u.drawHandle(t.x,t.y);return e.addEventListener("mousedown",u.onGrab(e)),u.elementGroup.appendChild(e),e})))}}catch(t){l.e(t)}finally{l.f()}u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ct(u.shape,t,r.formatter),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape));var f=u.shape.querySelector(".a9s-inner").getBBox();return f.x,f.y,f.width,f.height,u.grabbedElem=null,u.grabbedAt=null,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gr(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}}])&&mr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function kr(t){return kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kr(t)}function Mr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Nr(r.key),r)}}function _r(t,e,n){return e=Gr(e),function(t,e){if(e&&("object"===kr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Tr()?Reflect.construct(e,n||[],Gr(t).constructor):e.apply(t,n))}function Tr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Tr=function(){return!!t})()}function Gr(t){return Gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gr(t)}function Rr(t,e){return Rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Rr(t,e)}function Dr(t,e,n){return(e=Nr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nr(t){var e=function(t,e){if("object"!=kr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=kr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kr(e)?e:e+""}var Lr=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Dr(o=_r(this,e,[t,n,r]),"startDrawing",(function(t,e){o._isDrawing=!0,o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp,dblClick:o.onDblClick}),o.rubberband=new pr([t,e],o.g,o.env)})),Dr(o,"stop",(function(){o.detachListeners(),o._isDrawing=!1,o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),Dr(o,"undo",(function(){o.rubberband&&o.rubberband.undo()})),Dr(o,"newPart",(function(){o.rubberband&&o.rubberband.newPart()})),Dr(o,"onMouseMove",(function(t,e){return o.rubberband.dragTo([t,e])})),Dr(o,"onMouseUp",(function(t,e,n){if(n.altKey)o.onDblClick(n);else if(n.ctrlKey)o.rubberband.undo();else{var r=o.rubberband.getBoundingClientRect(),i=r.width,u=r.height,a=o.config.minSelectionWidth||4,c=o.config.minSelectionHeight||4;i>=a||u>=c?o.rubberband.addPoint([t,e]):(o.emit("cancel"),o.stop())}})),Dr(o,"onDblClick",(function(t,e){o._isDrawing=!1,o.rubberband.addPoint([t,e]);var n=o.rubberband.element;n.annotation=o.rubberband.toSelection(),o.emit("complete",n),o.stop()})),Dr(o,"createEditableShape",(function(t){return new Cr(t,o.g,o.config,o.env)})),o._isDrawing=!1,document.addEventListener("keydown",(function(t){"z"==t.key&&t.ctrlKey&&o.undo(),"n"==t.key&&o.newPart()})),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rr(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Mr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Hr(t){return Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hr(t)}function Br(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qr(r.key),r)}}function Ur(t,e,n){return(e=qr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qr(t){var e=function(t,e){if("object"!=Hr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Hr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Hr(e)?e:e+""}Lr.identifier="multipolygon",Lr.supports=function(t){return!1};var Xr=function(){return t=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ur(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.line.getAttribute("x1")," ").concat(r.line.getAttribute("y1")," ").concat(r.line.getAttribute("x2")," ").concat(r.line.getAttribute("y2"),"z"))})),Ur(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.line=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," z"))},(e=[{key:"element",get:function(){return this.mask}}])&&Br(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Fr(t){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fr(t)}function Vr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Yr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vr(Object(n),!0).forEach((function(e){Wr(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function zr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ir(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$r(r.key),r)}}function Wr(t,e,n){return(e=$r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $r(t){var e=function(t,e){if("object"!=Fr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Fr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fr(e)?e:e+""}var Zr=function(){return t=function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Wr(this,"setPoints",(function(t){var e=t;o.outer.setAttribute("x1",e[0]),o.inner.setAttribute("x1",e[0]),o.outer.setAttribute("y1",e[1]),o.inner.setAttribute("y1",e[1]),e.length>2&&(o.outer.setAttribute("x2",e[2]),o.inner.setAttribute("x2",e[2]),o.outer.setAttribute("y2",e[3]),o.inner.setAttribute("y2",e[3]))})),Wr(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Wr(this,"dragTo",(function(t){o.group.style.display=null,o.mousepos=t;var e,n=[].concat(function(t){if(Array.isArray(t))return zr(t)}(e=o.points)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return zr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zr(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t[0],t[1]]);o.setPoints(n),o.mask.redraw()})),Wr(this,"addPoint",(function(t){o.points.length<=2&&(o.points[2]=t[0],o.points[3]=t[1],o.setPoints(o.points))})),Wr(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),Wr(this,"newPart",(function(){o.points.push([])})),Wr(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.Line=null,o.group=null})),Wr(this,"toSelection",(function(){return new k(Yr(Yr({},rt(o.group,o.env.image)),{},{renderedVia:{name:"line"}}))})),this.points=e,this.env=r,this.group=document.createElementNS(i,"g"),this.Line=document.createElementNS(i,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new Xr(r.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),n.appendChild(this.group)},(e=[{key:"element",get:function(){return this.Line}}])&&Ir(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Kr(t){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kr(t)}function Jr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Qr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,uo(r.key),r)}}function to(t,e,n){return e=oo(e),function(t,e){if(e&&("object"===Kr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,eo()?Reflect.construct(e,n||[],oo(t).constructor):e.apply(t,n))}function eo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(eo=function(){return!!t})()}function no(t,e){return no=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},no(t,e)}function ro(){return ro="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oo(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},ro.apply(this,arguments)}function oo(t){return oo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oo(t)}function io(t,e,n){return(e=uo(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function uo(t){var e=function(t,e){if("object"!=Kr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Kr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kr(e)?e:e+""}var ao=function(t){var e=t.querySelector(".a9s-inner");return[[e.x1.baseVal,e.y1.baseVal],[e.x2.baseVal,e.y2.baseVal]]},co=function(t){function e(t,n,r,o){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),io(u=to(this,e,[t,n,r,o]),"onScaleChanged",(function(){return u.handles.map(u.scaleHandle)})),io(u,"setPoints",(function(t){var e=t[0].x,n=t[0].y,r=t[1].x,o=t[1].y,i=u.shape.querySelector(".a9s-inner");i.setAttribute("x1",e),i.setAttribute("y1",n),i.setAttribute("x2",r),i.setAttribute("y2",o);var a=u.shape.querySelector(".a9s-outer");a.setAttribute("x1",e),a.setAttribute("y1",n),a.setAttribute("x2",r),a.setAttribute("y2",o),u.mask.redraw();var c=a.getBBox(),l=c.x,s=c.y,f=c.width,p=c.height;lt(u.elementGroup,l,s,f,p)})),io(u,"onGrab",(function(t){return function(e){0===e.button&&(u.grabbedElem=t,u.grabbedAt=u.getSVGPoint(e))}})),io(u,"onMouseMove",(function(t){var e=function(t,e,n){return t+e<0?-t:t+e>n?n-t:e};if(u.grabbedElem){var n=u.getSVGPoint(t);if(u.grabbedElem===u.shape){var r=u.shape.querySelector(".a9s-inner").getBBox(),o=r.x,i=r.y,a=r.width,c=r.height,l=u.env.image,s=l.naturalWidth,f=l.naturalHeight,p=e(o,n.x-u.grabbedAt.x,s-a),b=e(i,n.y-u.grabbedAt.y,f-c),y=ao(u.shape).map((function(t){return{x:t[0].value+p,y:t[1].value+b}}));u.grabbedAt=n,u.setPoints(y),y.forEach((function(t,e){return u.setHandleXY(u.handles[e],t.x,t.y)})),u.emit("update",rt(u.shape,u.env.image))}else{var d=u.handles.indexOf(u.grabbedElem),m=ao(u.shape).map((function(t,e){return e===d?n:{x:t[0].value,y:t[1].value}}));u.setPoints(m),u.setHandleXY(u.handles[d],n.x,n.y),u.emit("update",rt(u.shape,u.env.image))}}})),io(u,"onMouseUp",(function(t){u.grabbedElem=null,u.grabbedAt=null})),io(u,"updateState",(function(t){var e=et(t).getAttribute("points").split(" ").map((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Jr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.split(",").map((function(t){return parseFloat(t.trim())})),2);return{x:e[0],y:e[1]}}));u.setPoints(e),e.forEach((function(t,e){return u.setHandleXY(u.handles[e],t.x,t.y)}))})),io(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),ro(oo(e.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=nt(t),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape)),u.mask=new Xr(o.image,u.shape.querySelector(".a9s-inner")),u.containerGroup.appendChild(u.mask.element),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.setAttribute("data-id",t.id),u.elementGroup.appendChild(u.shape),u.handles=ao(u.shape).map((function(t){var e=u.drawHandle(t[0].value,t[1].value);return e.addEventListener("mousedown",u.onGrab(e)),u.elementGroup.appendChild(e),e})),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ct(u.shape,t,r.formatters),u.grabbedElem=null,u.grabbedAt=null,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&no(t,e)}(e,t),n=e,(r=[{key:"element",get:function(){return this.elementGroup}}])&&Qr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function lo(t){return lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lo(t)}function so(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ho(r.key),r)}}function fo(t,e,n){return e=bo(e),function(t,e){if(e&&("object"===lo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,po()?Reflect.construct(e,n||[],bo(t).constructor):e.apply(t,n))}function po(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(po=function(){return!!t})()}function bo(t){return bo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bo(t)}function yo(t,e){return yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yo(t,e)}function mo(t,e,n){return(e=ho(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ho(t){var e=function(t,e){if("object"!=lo(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=lo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lo(e)?e:e+""}var vo=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),mo(o=fo(this,e,[t,n,r]),"startDrawing",(function(t,e){o._isDrawing=!0,o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp}),o.rubberband=new Zr([t,e],o.g,o.env)})),mo(o,"stop",(function(){o.detachListeners(),o._isDrawing=!1,o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),mo(o,"undo",(function(){o.rubberband&&o.rubberband.undo()})),mo(o,"newPart",(function(){o.rubberband&&o.rubberband.newPart()})),mo(o,"onMouseMove",(function(t,e){return o.rubberband.dragTo([t,e])})),mo(o,"onMouseUp",(function(t,e,n){if(n.altKey)o.onDblClick(n);else if(n.ctrlKey)o.rubberband.undo();else if(2==o.rubberband.points.length)if(o.rubberband.addPoint([t,e]),o.rubberband.points[0]==o.rubberband.points[2]&&o.rubberband.points[1]==o.rubberband.points[3])o.emit("cancel"),o.stop();else{o._isDrawing=!1;var r=o.rubberband.element;r.annotation=o.rubberband.toSelection(),o.emit("complete",r),o.stop()}})),mo(o,"createEditableShape",(function(t){return new co(t,o.g,o.config,o.env)})),o._isDrawing=!1,document.addEventListener("keydown",(function(t){"z"==t.key&&t.ctrlKey&&o.undo(),"n"==t.key&&o.newPart()})),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yo(t,e)}(e,t),n=e,(r=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&so(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);vo.identifier="line",vo.supports=function(t){var e,n=t.selector("SvgSelector");if(n)return null===(e=n.value)||void 0===e?void 0:e.match(/^<svg.*<line/g)};var go=new Set(["point","pointcross","circle","ellipse","freehand","line"]);const wo=function(t,e){(null!=e&&e.tools?e.tools.map((function(t){return t.toLowerCase()})):go).forEach((function(e){"point"===e&&t.addDrawingTool(ce),"pointcross"===e&&t.addDrawingTool(Lt),"circle"===e&&t.addDrawingTool(Xe),"ellipse"===e&&t.addDrawingTool(jn),"freehand"===e&&t.addDrawingTool(Zn),"multipolygon"===e&&t.addDrawingTool(Lr),"line"===e&&t.addDrawingTool(vo)}))}})(),r.default})()));
//# sourceMappingURL=annotorious-selector-pack.js.map