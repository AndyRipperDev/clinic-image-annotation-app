/*! For license information please see annotorious-selector-pack.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Annotorious=t():(e.Annotorious=e.Annotorious||{},e.Annotorious.SelectorPack=t())}(self,(()=>(()=>{var e={495:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}e.exports=function e(n,r){if(n===r)return!0;if(n&&r&&"object"==t(n)&&"object"==t(r)){if(n.constructor!==r.constructor)return!1;var o,i,u;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!e(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(u=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,u[i]))return!1;for(i=o;0!=i--;){var a=u[i];if(!e(n[a],r[a]))return!1}return!0}return n!=n&&r!=r}},154:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,u=r.length;i<u;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";n.d(r,{default:()=>wo});var e,t=n(154),o=n.n(t),i="http://www.w3.org/2000/svg",u=new Uint8Array(16);function a(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(u)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var l=[],s=0;s<256;++s)l.push((s+256).toString(16).substr(1));const f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&c.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},p=function(e,t,n){var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return f(r)};var b,y=n(495),d=n.n(y);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function w(e,t,n){return(t=O(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}var S=function(){return e=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,"clone",(function(t,n){return new e(v(v({},r.underlying),t),v(v({},r.opts),n))})),w(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),this.underlying=t,this.opts=n},(t=[{key:"isEqual",value:function(e){return"Annotation"===(null==e?void 0:e.type)&&(this.underlying===e.underlying||!(!this.underlying.id||!e.underlying.id)&&d()(this.underlying,e.underlying))}},{key:"readOnly",get:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(e){this.underlying.body=e}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){var e;return null===(e=this.selector("TextQuoteSelector"))||void 0===e?void 0:e.exact}},{key:"start",get:function(){var e;return null===(e=this.selector("TextPositionSelector"))||void 0===e?void 0:e.start}},{key:"end",get:function(){var e;return null===(e=this.selector("TextPositionSelector"))||void 0===e?void 0:e.end}}])&&g(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,C(r.key),r)}}function x(e,t,n){return(t=C(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){var t=function(e,t){if("object"!=j(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:t+""}b=S,w(S,"create",(function(e){var t={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(p()),body:[]};return new b(v(v({},t),e))}));var k=function(){return e=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),x(this,"clone",(function(t){var n=new e;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),t&&(n.underlying=E(E({},n.underlying),t)),n})),x(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),x(this,"toAnnotation",(function(){var e=Object.assign({},r.underlying,{type:"Annotation",id:"#".concat(p())});return new S(e)})),this.underlying={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Selection",body:n||[],target:t}},(t=[{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(e){return!!e&&d()(this.underlying,e.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){var e;return null===(e=this.selector("TextQuoteSelector"))||void 0===e?void 0:e.exact}},{key:"isSelection",get:function(){return!0}}])&&A(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,U(r.key),r)}}function G(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function R(e,t,n){return t=N(t),function(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,D()?Reflect.construct(t,n||[],N(e).constructor):t.apply(e,n))}function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(D=function(){return!!e})()}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},N(e)}function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function B(e,t,n){return(t=U(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e){var t=function(e,t){if("object"!=M(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==M(t)?t:t+""}var q="An implementation is missing",X="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,F=function(e){function t(e,n,r){var o;_(this,t),B(o=R(this,t),"enableResponsive",(function(){window.ResizeObserver&&(o.resizeObserver=new ResizeObserver((function(){var e=o.svg.getBoundingClientRect(),t=o.svg.viewBox.baseVal,n=t.width,r=t.height;o.scale=Math.max(n/e.width,r/e.height),o.onScaleChanged&&o.onScaleChanged(o.scale)})),o.resizeObserver.observe(o.svg.parentNode))})),B(o,"getSVGPoint",(function(e){var t=o.svg.createSVGPoint();if(X){var n=o.svg.getBoundingClientRect(),r=e.clientX-n.x,i=e.clientY-n.y,u=o.svg.getBoundingClientRect(),a=u.left,c=u.top;return t.x=r+a,t.y=i+c,t.matrixTransform(o.g.getScreenCTM().inverse())}return t.x=e.offsetX,t.y=e.offsetY,t.matrixTransform(o.g.getCTM().inverse())})),B(o,"drawHandle",(function(e,t){var n=document.createElementNS(i,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(i,"g"),u=function(n){var r=document.createElementNS(i,"circle");return r.setAttribute("cx",e),r.setAttribute("cy",t),r.setAttribute("r",n),r.setAttribute("transform-origin","".concat(e," ").concat(t)),r},a=o.config.handleRadius||6,c=u(a);c.setAttribute("class","a9s-handle-inner");var l=u(a+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),B(o,"setHandleXY",(function(e,t,n){var r=e.querySelector(".a9s-handle-inner");r.setAttribute("cx",t),r.setAttribute("cy",n),r.setAttribute("transform-origin","".concat(t," ").concat(n));var o=e.querySelector(".a9s-handle-outer");o.setAttribute("cx",t),o.setAttribute("cy",n),o.setAttribute("transform-origin","".concat(t," ").concat(n))})),B(o,"getHandleXY",(function(e){var t=e.querySelector(".a9s-handle-outer");return{x:parseFloat(t.getAttribute("cx")),y:parseFloat(t.getAttribute("cy"))}})),B(o,"scaleHandle",(function(e){var t=e.querySelector(".a9s-handle-inner"),n=e.querySelector(".a9s-handle-outer"),r=o.scale*(o.config.handleRadius||6);t.setAttribute("r",r),n.setAttribute("r",r)})),o.svg=e.closest("svg"),o.g=e,o.config=n,o.env=r,o.scale=1;var u=r.image;return(u instanceof Element||u instanceof HTMLDocument)&&o.enableResponsive(),o}return L(t,e),G(t,[{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}])}(o()),V=function(e){function t(e,n,r){var o;return _(this,t),B(o=R(this,t,[e,n,r]),"attachListeners",(function(e){var t=e.mouseMove,n=e.mouseUp,r=e.dblClick;t&&(o.mouseMove=function(e){var n=o.getSVGPoint(e),r=n.x,i=n.y;o.started||(o.emit("startSelection",{x:r,y:i}),o.started=!0),t(r,i,e)},o.svg.addEventListener("mousemove",o.mouseMove)),n&&(o.mouseUp=function(e){if(0===e.button){var t=o.getSVGPoint(e),r=t.x,i=t.y;n(r,i,e)}},document.addEventListener("mouseup",o.mouseUp)),r&&(o.dblClick=function(e){var t=o.getSVGPoint(e),n=t.x,i=t.y;r(n,i,e)},document.addEventListener("dblclick",o.dblClick))})),B(o,"detachListeners",(function(){o.mouseMove&&o.svg.removeEventListener("mousemove",o.mouseMove),o.mouseUp&&document.removeEventListener("mouseup",o.mouseUp),o.dblClick&&document.removeEventListener("dblclick",o.dblClick)})),B(o,"start",(function(e,t){var n=o.getSVGPoint(e),r=n.x,i=n.y,u=o.env.image,a=u.naturalWidth,c=u.naturalHeight,l=r<0?0:r>a?a:r,s=i<0?0:i>c?c:i;o.startDrawing(l,s,t,e)})),B(o,"startDrawing",(function(e){throw new Error(q)})),B(o,"createEditableShape",(function(e,t){throw new Error(q)})),o.started=!1,o}return L(t,e),G(t,[{key:"isDrawing",get:function(){throw new Error(q)}}])}(F);function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,K(r.key),r)}}function I(e,t,n){return t=$(t),function(e,t){if(t&&("object"===Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,W()?Reflect.construct(t,n||[],$(e).constructor):t.apply(e,n))}function W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(W=function(){return!!e})()}function $(e){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$(e)}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function K(e){var t=function(e,t){if("object"!=Y(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Y(t)?t:t+""}V.supports=function(e){throw new Error(q)};var J="An implementation is missing",Q=function(e){function t(e,n,r,o){var i,u,a,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u=i=I(this,t,[n,r,o]),c=function(e){throw new Error(J)},(a=K(a="updateState"))in u?Object.defineProperty(u,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):u[a]=c,i.annotation=e,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){throw new Error(J)}}])&&z(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F),ee=function(e){var t=function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(e){return e.parentNode.removeChild(e)})),t(e),Array.from(e.querySelectorAll("*")).forEach(t),e},te=function(e){var t,n,r=e.selector("SvgSelector");if(r){var o=new DOMParser,u=r.value,a=o.parseFromString(u,"image/svg+xml"),c=a.lookupPrefix(i),l=a.lookupNamespaceURI(null);return c||l?ee(a).firstChild:ee((t=a,n=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",'<svg xmlns="'.concat(i,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},ne=function(e){var t=te(e),n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},re=function(e,t){var n=e.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(i,'"'),""),{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}};function oe(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ue=/firefox/i.test(navigator.userAgent),ae=function(e,t,n,r,o){e.setAttribute("width",r),e.setAttribute("height",o),ue?(e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("transform","translate(".concat(t,", ").concat(n,")"))):(e.setAttribute("x",t),e.setAttribute("y",n))},ce=function(e,t,n){if(!n)return e;var r=n.reduce((function(e,n){var r=n(t);if(!r)return e;if("string"==typeof r||r instanceof String)e.className=e.className?"".concat(e.className," ").concat(r):r;else if(r.nodeType===Node.ELEMENT_NODE)e.elements=e.elements?[].concat(oe(e.elements),[r]):[r];else{var o=r.className,i=r.style,u=r.element;o&&(e.className=e.className?"".concat(e.className," ").concat(o):o),i&&(e.style=e.style?"".concat(e.style," ").concat(i):i),u&&(e.elements=e.elements?[].concat(oe(e.elements),[u]):[u])}for(var a in r)r.hasOwnProperty(a)&&a.startsWith("data-")&&(e[a]=r[a]);return e}),{}),o=r.className,u=r.style,a=r.elements;if(o&&function(e,t){var n=function(e){var t=e.getAttribute("class");return t?new Set(t.split(" ")):new Set}(e);n.add(t),e.setAttribute("class",Array.from(n).join(" "))}(e,o),u){var c=e.querySelector(".a9s-outer"),l=e.querySelector(".a9s-inner");c&&l?(c.setAttribute("style","display:none"),l.setAttribute("style",u)):e.setAttribute("style",u)}for(var s in a&&a.forEach((function(t){return function(e,t){var n=t.getBBox(),r=n.x,o=n.y,u=n.width,a=n.height,c=document.createElementNS(i,"svg");c.setAttribute("class","a9s-formatter-el"),ae(c,r,o,u,a);var l=document.createElementNS(i,"g");l.appendChild(e),c.appendChild(l),t.append(c)}(t,e)})),r)r.hasOwnProperty(s)&&s.startsWith("data-")&&e.setAttribute(s,r[s])},le=function(e,t,n,r,o){var i=e.querySelector(".a9s-formatter-el");i&&ae(i,t,n,r,o)};function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ve(r.key),r)}}function pe(e,t,n){return t=me(t),function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,be()?Reflect.construct(t,n||[],me(e).constructor):t.apply(e,n))}function be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(be=function(){return!!e})()}function ye(e,t){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ye(e,t)}function de(){return de="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=me(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},de.apply(this,arguments)}function me(e){return me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},me(e)}function he(e,t,n){return(t=ve(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ve(e){var t=function(e,t){if("object"!=se(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==se(t)?t:t+""}var ge=function(e){console.log("8");var t=e.getAttribute("d").match(/M(\S+),(\S+)/);if(t){var n=parseFloat(t[1]),r=parseFloat(t[2]);return console.log("x: ".concat(n,", y: ").concat(r)),[n,r+25]}return console.log("rip"),[0,0]},we=function(e){return console.log("7"),e.querySelector(".a9s-inner").getBBox()},Oe=function(e){function t(e,n,r,o){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("6"),he(u=pe(this,t,[e,n,r,o]),"setPoint",(function(e){console.log("5");var t=parseFloat(e[0]),n=parseFloat(e[1]),r="M"+t+","+(n-25)+" V"+(n+25)+" M"+(t-25)+","+n+" H"+(t+25);u.shape.querySelector(".a9s-inner").setAttribute("d",r);var o=u.shape.querySelector(".a9s-outer");o.setAttribute("d",r);var i=o.getBBox(),a=i.x,c=i.y,l=i.width,s=i.height;le(u.elementGroup,a,c,l,s)})),he(u,"onGrab",(function(e){return function(t){console.log("grabbed1"),u.grabbedElem=e;var n=u.getSVGPoint(t);u.grabbedAt={x:n.x,y:n.y}}})),he(u,"onMouseMove",(function(e){console.log("4");var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(console.log("11"),u.grabbedElem){var n=u.getSVGPoint(e),r=we(u.shape),o=r.x,i=r.y,a=r.width,c=r.height;if(u.grabbedElem===u.shape){console.log("grabbed");var l=u.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-u.grabbedAt.x,s-a),b=t(i,n.y-u.grabbedAt.y,f-c),y=u.shape.querySelector(".a9s-inner"),d=ge(y);d[0]=d[0]+p,d[1]=d[1]+b,u.grabbedAt=n,u.setPoint(d),console.log(d),u.emit("update",re(u.shape,u.env.image))}}})),he(u,"onMouseUp",(function(e){console.log("2"),u.grabbedElem=null,u.grabbedAt=null})),he(u,"updateState",(function(e){console.log("uuuuupdated1");var t=ge(te(e));console.log("uuuuupdated"),u.setPoint(t)})),he(u,"destroy",(function(){console.log("3"),u.containerGroup.parentNode.removeChild(u.containerGroup),de(me(t.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=ne(e),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.shape),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ce(u.shape,e,r.formatter),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape));var a=we(u.shape);return a.x,a.y,a.width,a.height,u.grabbedElem=null,u.grabbedAt=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ye(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return console.log("1"),this.elementGroup}}])&&fe(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xe(r.key),r)}}function Ae(e,t,n){return(t=xe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xe(e){var t=function(e,t){if("object"!=Se(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}var Ce=function(){return e=function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ae(this,"setPoint",(function(e){o.group.style.display=null;var t=parseFloat(e[0]),n=parseFloat(e[1]),r="M"+t+","+(n-25)+" V"+(n+25)+" M"+(t-25)+","+n+" H"+(t+25);o.outer.setAttribute("d",r),o.inner.setAttribute("d",r)})),Ae(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Ae(this,"dragTo",(function(e){console.log(e),o.setPoint(e)})),Ae(this,"destroy",(function(){console.log("8"),o.group.parentNode.removeChild(o.group),o.pointcross=null,o.group=null})),Ae(this,"toSelection",(function(){return new k(Pe(Pe({},re(o.group,o.env.image)),{},{renderedVia:{name:"pointcross"}}))})),this.point=t,this.env=r,this.group=document.createElementNS(i,"g"),this.pointcross=document.createElementNS(i,"g"),this.pointcross.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoint(this.point),this.pointcross.appendChild(this.outer),this.pointcross.appendChild(this.inner),this.group.appendChild(this.pointcross),n.appendChild(this.group),console.log("hey")},(t=[{key:"element",get:function(){return console.log("hey2"),this.pointcross}}])&&Ee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ne(r.key),r)}}function _e(e,t,n){return t=Ge(t),function(e,t){if(t&&("object"===ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Te()?Reflect.construct(t,n||[],Ge(e).constructor):t.apply(e,n))}function Te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Te=function(){return!!e})()}function Ge(e){return Ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ge(e)}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Re(e,t)}function De(e,t,n){return(t=Ne(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ne(e){var t=function(e,t){if("object"!=ke(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ke(t)?t:t+""}var Le=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),De(o=_e(this,t,[e,n,r]),"startDrawing",(function(e,t){console.log("here"),o.pointcrossSelection=new Ce([e,t],o.g,o.env),console.log("here2");var n=o.pointcrossSelection.element;n.annotation=o.pointcrossSelection.toSelection(),o.emit("complete",n),console.log("here3")})),De(o,"stop",(function(){})),De(o,"createEditableShape",(function(e){return new Oe(e,o.g,o.config,o.env)})),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return!1}}])&&Me(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Le.identifier="pointcross",Le.supports=function(e){var t=e.selector("SvgSelector");if(t)return t.value.match(/^<svg.*<path*/g)&&!t.value.toUpperCase().includes("Z")};var Be=function(e,t){var n=e.selector("FragmentSelector");if(null!=n&&n.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){var r=n.value,o=r.includes(":")?r.substring(r.indexOf("=")+1,r.indexOf(":")):"pixel",i=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?He(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((r.includes(":")?r.substring(r.indexOf(":")+1):r.substring(r.indexOf("=")+1)).split(",").map(parseFloat),4),u=i[0],a=i[1],c=i[2],l=i[3];return"percent"===o.toLowerCase()&&(u=u*t.naturalWidth/100,a=a*t.naturalHeight/100,c=c*t.naturalWidth/100,l=l*t.naturalHeight/100),{x:u,y:a,w:c,h:l}}};function Ue(e){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],o=function(e){var t=function(e,t){if("object"!=Ue(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ue(t)?t:t+""}(o),o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fe=function(e,t,n,r){return Xe(Xe({},function(e,t,n,r,o,i){return"percent"===(null==i?void 0:i.toLowerCase())?function(e,t,n,r,o){var i=e/o.naturalWidth*100,u=t/o.naturalHeight*100,a=0/o.naturalWidth*100,c=0/o.naturalHeight*100;return{source:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=percent:".concat(i,",").concat(u,",").concat(a,",").concat(c)}}}(e,t,0,0,o):function(e,t,n,r,o){return{source:null==o?void 0:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(e,",").concat(t,",").concat(0,",").concat(0)}}}(e,t,0,0,o)}(e,t,0,0,n,r)),{},{renderedVia:{name:"point"}})};function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Je(r.key),r)}}function ze(e,t,n){return t=$e(t),function(e,t){if(t&&("object"===Ve(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ie()?Reflect.construct(t,n||[],$e(e).constructor):t.apply(e,n))}function Ie(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ie=function(){return!!e})()}function We(){return We="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$e(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},We.apply(this,arguments)}function $e(e){return $e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$e(e)}function Ze(e,t){return Ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ze(e,t)}function Ke(e,t,n){return(t=Je(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Je(e){var t=function(e,t){if("object"!=Ve(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ve(t)?t:t+""}var Qe=function(e){function t(e,n,r,o){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ke(u=ze(this,t,[e,n,r,o]),"onScaleChanged",(function(){return u.scaleHandle(u.point)})),Ke(u,"onGrab",(function(){u.isGrabbed=!0})),Ke(u,"onMouseMove",(function(e){if(0===e.button&&u.isGrabbed){var t=u.getSVGPoint(e),n=t.x,r=t.y;u.setHandleXY(u.point,n,r);var o=Fe(n,r,u.env.image,u.config.fragmentUnit);u.emit("update",o)}})),Ke(u,"onMouseUp",(function(){u.isGrabbed=!1})),Ke(u,"updateState",(function(e){var t=Be(e,u.env.image),n=t.x,r=t.y;u.setHandleXY(u.point,n,r)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp);var a=Be(e,o.image),c=a.x,l=a.y;return u.container=document.createElementNS(i,"g"),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.point=u.drawHandle(c,l),u.point.addEventListener("mousedown",u.onGrab),u.elementGroup.appendChild(u.point),u.container.appendChild(u.elementGroup),n.appendChild(u.container),u.isGrabbed=!1,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ze(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),We($e(t.prototype),"destroy",this).call(this)}}])&&Ye(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function et(e){return et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},et(e)}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,at(r.key),r)}}function nt(e,t,n){return t=ot(t),function(e,t){if(t&&("object"===et(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,rt()?Reflect.construct(t,n||[],ot(e).constructor):t.apply(e,n))}function rt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(rt=function(){return!!e})()}function ot(e){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ot(e)}function it(e,t){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},it(e,t)}function ut(e,t,n){return(t=at(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function at(e){var t=function(e,t){if("object"!=et(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=et(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==et(t)?t:t+""}var ct=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ut(o=nt(this,t,[e,n,r]),"startDrawing",(function(e,t,n,r){var i,u=null===(i=r.target.closest(".a9s-annotation"))||void 0===i?void 0:i.annotation;if(u&&function(e){var t;return"point"===(null===(t=e.target.renderedVia)||void 0===t?void 0:t.name)}(u))o.emit("cancel");else{var a=o.drawHandle(e,t);o.scaleHandle(a),o.g.appendChild(a),a.annotation=new k(Fe(e,t,o.env.image,o.config.fragmentUnit)),o.emit("complete",a)}})),ut(o,"stop",(function(){})),ut(o,"createEditableShape",(function(e){return new Qe(e,o.g,o.config,o.env)})),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&it(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return!1}}])&&tt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);ct.identifier="point",ct.supports=function(e){return!1};var lt=function(e,t,n,r){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("r",r)},st=function(e,t,n,r){var o=e.querySelector(".a9s-inner"),i=e.querySelector(".a9s-outer");lt(o,t,n,r),lt(i,t,n,r)},ft=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),r:parseFloat(t.getAttribute("r"))}};function pt(e){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(e)}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dt(r.key),r)}}function yt(e,t,n){return(t=dt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dt(e){var t=function(e,t){if("object"!=pt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==pt(t)?t:t+""}var mt=function(){return e=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),yt(this,"redraw",(function(){var e=ft(r.circle),t=e.cx,n=e.cy,o=e.r,i=t+o>r.w?r.w-o:t,u=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(u," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),yt(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=n;var o=ft(this.circle),u=o.cx,a=o.cy,c=o.r,l=u+c>this.w?this.w-c:u,s=a+c>this.h?this.h-c:a+c;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))},(t=[{key:"element",get:function(){return this.mask}}])&&bt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ht(e){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ht(e)}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,wt(r.key),r)}}function gt(e,t,n){return(t=wt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e){var t=function(e,t){if("object"!=ht(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ht(t)?t:t+""}var Ot=function(){return e=function e(t,n,r,o){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),gt(this,"dragTo",(function(e,t){var n=u.env.image,r=n.naturalWidth,o=n.naturalHeight;u.group.style.display=null;var i=e-u.anchor[0],a=t-u.anchor[1],c=Math.max(1,Math.pow(Math.pow(i,2)+Math.pow(a,2),.5)/2),l=u.anchor[0]+i/2,s=u.anchor[1]+a/2;l-c<0||l+c>r||s-c<0||s+c>o||(st(u.circle,l,s,c),u.mask.redraw())})),gt(this,"getBoundingClientRect",(function(){return u.circle.getBoundingClientRect()})),gt(this,"toSelection",(function(){return new k(re(u.group,u.env.image))})),gt(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.circle=null,u.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.circle=function(e,t,n){var r=document.createElementNS(i,"g"),o=document.createElementNS(i,"circle"),u=document.createElementNS(i,"circle");return u.setAttribute("class","a9s-inner"),lt(u,e,t,2),o.setAttribute("class","a9s-outer"),lt(o,e,t,2),r.appendChild(o),r.appendChild(u),r}(t,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new mt(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)},(t=[{key:"element",get:function(){return this.circle}}])&&vt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function jt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tt(r.key),r)}}function At(e,t,n){return t=kt(t),function(e,t){if(t&&("object"===St(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xt()?Reflect.construct(t,n||[],kt(e).constructor):t.apply(e,n))}function xt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xt=function(){return!!e})()}function Ct(){return Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=kt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Ct.apply(this,arguments)}function kt(e){return kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kt(e)}function Mt(e,t){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mt(e,t)}function _t(e,t,n){return(t=Tt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tt(e){var t=function(e,t){if("object"!=St(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=St(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==St(t)?t:t+""}var Gt=function(e){function t(e,n,r,o){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_t(u=At(this,t,[e,n,r,o]),"setSize",(function(e,t,n){st(u.circle,e,t,n),u.mask.redraw(),le(u.elementGroup,e,t,n,n);var r=jt(u.handles,4),o=r[0],i=r[1],a=r[2],c=r[3];u.setHandleXY(o,e,t-n),u.setHandleXY(i,e+n,t),u.setHandleXY(a,e,t+n),u.setHandleXY(c,e-n,t)})),_t(u,"stretchCorners",(function(e,t,n){var r,o=u.getHandleXY(t),i=n.x,a=n.y,c=0,l=0;0==e||2==e?(i=o.x,l=a-o.y,r=Math.abs(l)/2):(a=o.y,c=i-o.x,r=Math.abs(c)/2);var s=c>0?o.x:i,f=l>0?o.y:a,p=s+Math.abs(c)/2,b=f+Math.abs(l)/2;if(st(u.circle,p,b,r),u.mask.redraw(),le(u.elementGroup,p,b,r,r),0==e||2==e){var y=0,d=2;(0==e&&l>0||2==e&&l<0)&&(y=2,d=0),u.setHandleXY(u.handles[y],p,b-r),u.setHandleXY(u.handles[d],p,b+r),u.setHandleXY(u.handles[1],p+r,b),u.setHandleXY(u.handles[3],p-r,b)}else{var m=3,h=1;(1==e&&c>0||3==e&&c<0)&&(m=1,h=3),u.setHandleXY(u.handles[m],p+r,b),u.setHandleXY(u.handles[h],p-r,b),u.setHandleXY(u.handles[0],p,b-r),u.setHandleXY(u.handles[2],p,b+r)}})),_t(u,"onGrab",(function(e){return function(t){u.grabbedElem=e;var n=u.getSVGPoint(t),r=ft(u.circle),o=r.cx,i=r.cy;u.grabbedAt={x:n.x-o,y:n.y-i}}})),_t(u,"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(u.grabbedElem){var n=u.getSVGPoint(e);if(u.grabbedElem===u.circle){var r=ft(u.circle).r,o=u.env.image,i=o.naturalWidth,a=o.naturalHeight,c=Math.max(t(n.x-u.grabbedAt.x,i-r),r),l=Math.max(t(n.y-u.grabbedAt.y,a-r),r);u.setSize(c,l,r),u.emit("update",re(u.circle,u.env.image))}else{var s=u.handles.indexOf(u.grabbedElem),f=s<2?u.handles[s+2]:u.handles[s-2];u.stretchCorners(s,f,n),u.emit("update",re(u.circle,u.env.image))}}})),_t(u,"onMouseUp",(function(){u.grabbedElem=null,u.grabbedAt=null})),_t(u,"onScaleChanged",(function(e){return u.handles.map(u.scaleHandle)})),_t(u,"updateState",(function(e){var t=te(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),o=parseFloat(t.getAttribute("r"));u.setSize(n,r,o)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.circle=ne(e),u.circle.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.circle)),u.mask=new mt(o.image,u.circle),u.containerGroup.appendChild(u.mask.element),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.circle);var a=ft(u.circle),c=a.cx,l=a.cy,s=a.r;return u.handles=[[c,l-s],[c+s,l],[c,l+s],[c-s,l]].map((function(e){var t=jt(e,2),n=t[0],r=t[1],o=u.drawHandle(n,r);return o.addEventListener("mousedown",u.onGrab(o)),u.elementGroup.appendChild(o),o})),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ce(u.circle,e,r.formatter),u.grabbedElem=null,u.grabbedAt=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mt(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),Ct(kt(t.prototype),"destroy",this).call(this)}}])&&Et(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function Rt(e){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rt(e)}function Dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,qt(r.key),r)}}function Nt(e,t,n){return t=Ht(t),function(e,t){if(t&&("object"===Rt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Lt()?Reflect.construct(t,n||[],Ht(e).constructor):t.apply(e,n))}function Lt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Lt=function(){return!!e})()}function Ht(e){return Ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ht(e)}function Bt(e,t){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Bt(e,t)}function Ut(e,t,n){return(t=qt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qt(e){var t=function(e,t){if("object"!=Rt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Rt(t)?t:t+""}var Xt=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ut(o=Nt(this,t,[e,n,r]),"startDrawing",(function(e,t){o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp}),o.rubberband=new Ot(e,t,o.g,o.env)})),Ut(o,"stop",(function(){o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),Ut(o,"onMouseMove",(function(e,t){return o.rubberband.dragTo(e,t)})),Ut(o,"onMouseUp",(function(){o.detachListeners(),o.started=!1;var e=o.rubberband.getBoundingClientRect(),t=e.width,n=e.height,r=o.config.minSelectionWidth||4,i=o.config.minSelectionHeight||4;if(t>=r&&n>=i){var u=o.rubberband.element;u.annotation=o.rubberband.toSelection(),o.emit("complete",u)}else o.emit("cancel");o.stop()})),Ut(o,"createEditableShape",(function(e){return new Gt(e,o.g,o.config,o.env)})),o.rubberband=null,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bt(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&Dt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);Xt.identifier="circle",Xt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<circle/g)};var Ft=function(e,t,n,r,o){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("rx",r),e.setAttribute("ry",o)},Vt=function(e,t,n,r,o){var i=e.querySelector(".a9s-inner"),u=e.querySelector(".a9s-outer");Ft(i,t,n,r,o),Ft(u,t,n,r,o)},Yt=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),rx:parseFloat(t.getAttribute("rx")),ry:parseFloat(t.getAttribute("ry"))}};function zt(e){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$t(r.key),r)}}function Wt(e,t,n){return(t=$t(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $t(e){var t=function(e,t){if("object"!=zt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==zt(t)?t:t+""}var Zt=function(){return e=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Wt(this,"redraw",(function(){var e=Yt(r.ellipse),t=e.cx,n=e.cy,o=e.rx,i=e.ry,u=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(t," ").concat(u," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),Wt(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=n;var o=Yt(this.ellipse),u=o.cx,a=o.cy,c=o.rx,l=o.ry,s=a+l;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(u," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))},(t=[{key:"element",get:function(){return this.mask}}])&&It(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Kt(e){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(e)}function Jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,en(r.key),r)}}function Qt(e,t,n){return(t=en(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function en(e){var t=function(e,t){if("object"!=Kt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Kt(t)?t:t+""}var tn=function(){return e=function e(t,n,r,o){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qt(this,"dragTo",(function(e,t){u.group.style.display=null;var n=e-u.anchor[0],r=t-u.anchor[1],o=n>0?u.anchor[0]+n/2:e+n/2,i=r>0?u.anchor[1]+r/2:t+r/2,a=Math.abs(n/2),c=Math.abs(r/2);Vt(u.ellipse,o,i,a,c),u.mask.redraw()})),Qt(this,"getBoundingClientRect",(function(){return u.ellipse.getBoundingClientRect()})),Qt(this,"toSelection",(function(){return new k(re(u.group,u.env.image))})),Qt(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.ellipse=null,u.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.ellipse=function(e,t,n,r){var o=document.createElementNS(i,"g"),u=document.createElementNS(i,"ellipse"),a=document.createElementNS(i,"ellipse");return u.setAttribute("class","a9s-inner"),Ft(u,e,t,2,r),a.setAttribute("class","a9s-outer"),Ft(a,e,t,2,r),o.appendChild(a),o.appendChild(u),o}(t,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new Zt(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)},(t=[{key:"element",get:function(){return this.ellipse}}])&&Jt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function nn(e){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nn(e)}function rn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return on(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?on(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function on(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,bn(r.key),r)}}function an(e,t,n){return t=sn(t),function(e,t){if(t&&("object"===nn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,cn()?Reflect.construct(t,n||[],sn(e).constructor):t.apply(e,n))}function cn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(cn=function(){return!!e})()}function ln(){return ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=sn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ln.apply(this,arguments)}function sn(e){return sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},sn(e)}function fn(e,t){return fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fn(e,t)}function pn(e,t,n){return(t=bn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bn(e){var t=function(e,t){if("object"!=nn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=nn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==nn(t)?t:t+""}var yn=function(e){function t(e,n,r,o){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),pn(u=an(this,t,[e,n,r,o]),"setSize",(function(e,t,n,r){Vt(u.ellipse,e,t,n,r),u.mask.redraw(),le(u.elementGroup,e,t,n,r);var o=rn(u.handles,4),i=o[0],a=o[1],c=o[2],l=o[3];u.setHandleXY(i,e,t-r),u.setHandleXY(a,e+n,t),u.setHandleXY(c,e,t+r),u.setHandleXY(l,e-n,t)})),pn(u,"stretchCorners",(function(e,t,n,r){var o=u.getHandleXY(t),i=u.getHandleXY(n),a=r.x,c=r.y,l=0,s=0;0==e||2==e?a=o.x:c=o.y;var f=a-o.x,p=c-o.y,b=f>0?o.x:a,y=p>0?o.y:c,d=Math.abs(f),m=Math.abs(p),h=b+d/2,v=y+m/2;if(l=d/2,s=m/2,0==e||2==e?l=Math.abs(o.x-i.x):s=Math.abs(o.y-i.y),Vt(u.ellipse,h,v,l,s),u.mask.redraw(),le(u.elementGroup,h,v,l,s),0==e||2==e){var g=0,w=2;(0==e&&p>0||2==e&&p<0)&&(g=2,w=0),u.setHandleXY(u.handles[g],h,v-s),u.setHandleXY(u.handles[w],h,v+s),u.setHandleXY(u.handles[1],h+l,v),u.setHandleXY(u.handles[3],h-l,v)}else{var O=3,S=1;(1==e&&f>0||3==e&&f<0)&&(O=1,S=3),u.setHandleXY(u.handles[O],h+l,v),u.setHandleXY(u.handles[S],h-l,v),u.setHandleXY(u.handles[0],h,v-s),u.setHandleXY(u.handles[2],h,v+s)}})),pn(u,"onGrab",(function(e){return function(t){u.grabbedElem=e;var n=u.getSVGPoint(t),r=Yt(u.ellipse),o=r.cx,i=r.cy;u.grabbedAt={x:n.x-o,y:n.y-i}}})),pn(u,"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(u.grabbedElem){var n=u.getSVGPoint(e);if(u.grabbedElem===u.ellipse){var r=Yt(u.ellipse),o=r.rx,i=r.ry,a=u.env.image,c=a.naturalWidth,l=a.naturalHeight,s=t(n.x-u.grabbedAt.x,c-o),f=t(n.y-u.grabbedAt.y,l-i);u.setSize(s,f,o,i),u.emit("update",re(u.ellipse,u.env.image))}else{var p=u.handles.indexOf(u.grabbedElem),b=p<2?u.handles[p+2]:u.handles[p-2],y=u.handles[(p+3)%4];u.stretchCorners(p,b,y,n),u.emit("update",re(u.ellipse,u.env.image))}}})),pn(u,"onMouseUp",(function(){u.grabbedElem=null,u.grabbedAt=null})),pn(u,"onScaleChanged",(function(e){return u.handles.map(u.scaleHandle)})),pn(u,"updateState",(function(e){var t=te(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),o=parseFloat(t.getAttribute("rx")),i=parseFloat(t.getAttribute("ry"));u.setSize(n,r,o,i)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.ellipse=ne(e),u.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.ellipse)),u.mask=new Zt(o.image,u.ellipse),u.containerGroup.appendChild(u.mask.element),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.ellipse);var a=Yt(u.ellipse),c=a.cx,l=a.cy,s=a.rx,f=a.ry;return u.handles=[[c,l-f],[c+s,l],[c,l+f],[c-s,l]].map((function(e){var t=rn(e,2),n=t[0],r=t[1],o=u.drawHandle(n,r);return o.addEventListener("mousedown",u.onGrab(o)),u.elementGroup.appendChild(o),o})),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ce(u.ellipse,e,r.formatter),u.grabbedElem=null,u.grabbedAt=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fn(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ln(sn(t.prototype),"destroy",this).call(this)}}])&&un(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Sn(r.key),r)}}function hn(e,t,n){return t=gn(t),function(e,t){if(t&&("object"===dn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vn()?Reflect.construct(t,n||[],gn(e).constructor):t.apply(e,n))}function vn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(vn=function(){return!!e})()}function gn(e){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gn(e)}function wn(e,t){return wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wn(e,t)}function On(e,t,n){return(t=Sn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sn(e){var t=function(e,t){if("object"!=dn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=dn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==dn(t)?t:t+""}var jn=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),On(o=hn(this,t,[e,n,r]),"startDrawing",(function(e,t){o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp}),o.rubberband=new tn(e,t,o.g,o.env)})),On(o,"stop",(function(){o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),On(o,"onMouseMove",(function(e,t){return o.rubberband.dragTo(e,t)})),On(o,"onMouseUp",(function(){o.detachListeners(),o.started=!1;var e=o.rubberband.getBoundingClientRect(),t=e.width,n=e.height,r=o.config.minSelectionWidth||4,i=o.config.minSelectionHeight||4;if(t>=r&&n>=i){var u=o.rubberband.element;u.annotation=o.rubberband.toSelection(),o.emit("complete",u)}else o.emit("cancel");o.stop()})),On(o,"createEditableShape",(function(e){return new yn(e,o.g,o.config,o.env)})),o.rubberband=null,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wn(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&mn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Pn(e){return Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pn(e)}function En(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function An(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Cn(r.key),r)}}function xn(e,t,n){return(t=Cn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cn(e){var t=function(e,t){if("object"!=Pn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Pn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pn(t)?t:t+""}jn.identifier="ellipse",jn.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<ellipse/g)};var kn=function(){return e=function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xn(this,"setPoints",(function(e){var t=e.map((function(e){return"L".concat(e[0]," ").concat(e[1])})).join(" ");t="M"+t.substring(1),o.outer.setAttribute("d",t),o.inner.setAttribute("d",t)})),xn(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),xn(this,"dragTo",(function(e){o.group.style.display=null,o.addPoint(e)})),xn(this,"addPoint",(function(e){var t;o.points=[].concat(function(e){if(Array.isArray(e))return En(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return En(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?En(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]),o.setPoints(o.points)})),xn(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),xn(this,"toSelection",(function(){return new k(re(o.group,o.env.image))})),this.points=[t],this.env=r,this.group=document.createElementNS(i,"g"),this.freehand=document.createElementNS(i,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)},(t=[{key:"element",get:function(){return this.freehand}}])&&An(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Mn(e){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(e)}function _n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Hn(r.key),r)}}function Tn(e,t,n){return t=Nn(t),function(e,t){if(t&&("object"===Mn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Gn()?Reflect.construct(t,n||[],Nn(e).constructor):t.apply(e,n))}function Gn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Gn=function(){return!!e})()}function Rn(e,t){return Rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rn(e,t)}function Dn(){return Dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Dn.apply(this,arguments)}function Nn(e){return Nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nn(e)}function Ln(e,t,n){return(t=Hn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hn(e){var t=function(e,t){if("object"!=Mn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Mn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Mn(t)?t:t+""}var Bn=function(e){var t=e.getAttribute("d").split("L"),n=[];if(t.length>0){var r=t[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<t.length;o++)r=t[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},Un=function(e){return e.querySelector(".a9s-inner").getBBox()},qn=function(e){function t(e,n,r,o){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("freeCreated"),Ln(u=Tn(this,t,[e,n,r,o]),"setPoints",(function(e){var t=function(e){return Math.round(10*e)/10},n=e.map((function(e){return"L".concat(t(e.x)," ").concat(t(e.y))})).join(" ");n="M"+n.substring(1),u.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=u.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,a=o.y,c=o.width,l=o.height;le(u.elementGroup,i,a,c,l)})),Ln(u,"onGrab",(function(e){return function(t){u.grabbedElem=e;var n=u.getSVGPoint(t);u.grabbedAt={x:n.x,y:n.y}}})),Ln(u,"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(u.grabbedElem){var n=u.getSVGPoint(e),r=Un(u.shape),o=r.x,i=r.y,a=r.width,c=r.height;if(u.grabbedElem===u.shape){var l=u.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-u.grabbedAt.x,s-a),b=t(i,n.y-u.grabbedAt.y,f-c),y=u.shape.querySelector(".a9s-inner"),d=Bn(y).map((function(e){return{x:e.x+p,y:e.y+b}}));u.grabbedAt=n,u.setPoints(d),u.emit("update",re(u.shape,u.env.image))}}})),Ln(u,"onMouseUp",(function(e){u.grabbedElem=null,u.grabbedAt=null})),Ln(u,"updateState",(function(e){var t=Bn(te(e));u.setPoints(t)})),Ln(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),Dn(Nn(t.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=ne(e),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.shape),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ce(u.shape,e,r.formatter),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape));var a=Un(u.shape);return a.x,a.y,a.width,a.height,u.grabbedElem=null,u.grabbedAt=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rn(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return this.elementGroup}}])&&_n(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function Xn(e){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xn(e)}function Fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$n(r.key),r)}}function Vn(e,t,n){return t=zn(t),function(e,t){if(t&&("object"===Xn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Yn()?Reflect.construct(t,n||[],zn(e).constructor):t.apply(e,n))}function Yn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Yn=function(){return!!e})()}function zn(e){return zn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zn(e)}function In(e,t){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},In(e,t)}function Wn(e,t,n){return(t=$n(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $n(e){var t=function(e,t){if("object"!=Xn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Xn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xn(t)?t:t+""}var Zn=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Wn(o=Vn(this,t,[e,n,r]),"startDrawing",(function(e,t){o._isDrawing=!0,o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp,dblClick:o.onDblClick}),o.rubberband=new kn([e,t],o.g,o.env)})),Wn(o,"stop",(function(){o.detachListeners(),o._isDrawing=!1,o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),Wn(o,"onMouseMove",(function(e,t){return o.rubberband.dragTo([e,t])})),Wn(o,"onMouseUp",(function(e,t){o.onDblClick(e,t)})),Wn(o,"onDblClick",(function(e,t){o._isDrawing=!1,o.rubberband.addPoint([e,t]),o.detachListeners();var n=o.rubberband.getBoundingClientRect(),r=n.width,i=n.height,u=o.config.minSelectionWidth||4,a=o.config.minSelectionHeight||4;if(r>=u||i>=a){var c=o.rubberband.element;c.annotation=o.rubberband.toSelection(),o.emit("complete",c)}else o.emit("cancel");o.stop()})),Wn(o,"createEditableShape",(function(e){return new qn(e,o.g,o.config,o.env)})),o._isDrawing=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&In(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Fn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Kn(e){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(e)}function Jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,er(r.key),r)}}function Qn(e,t,n){return(t=er(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function er(e){var t=function(e,t){if("object"!=Kn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Kn(t)?t:t+""}Zn.identifier="freehand",Zn.supports=function(e){var t=e.selector("SvgSelector");if(t)return t.value.match(/^<svg.*<path*/g)&&!t.value.toUpperCase().includes("Z")};var tr=function(){return e=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qn(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.polygon.getAttribute("points")," z"))})),Qn(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.polygon=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.polygon.getAttribute("points")," z"))},(t=[{key:"element",get:function(){return this.mask}}])&&Jn(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function nr(e){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nr(e)}function rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(n),!0).forEach((function(t){sr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ir(e){return function(e){if(Array.isArray(e))return cr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ar(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ur(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ar(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){a=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function ar(e,t){if(e){if("string"==typeof e)return cr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cr(e,t):void 0}}function cr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fr(r.key),r)}}function sr(e,t,n){return(t=fr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fr(e){var t=function(e,t){if("object"!=nr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=nr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==nr(t)?t:t+""}var pr=function(){return e=function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),sr(this,"setPoints",(function(e){var t,n="",r=ur(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,u="";if(i.length>0){var a,c=ur(i);try{for(c.s();!(a=c.n()).done;){var l=a.value;l&&(u+=""===u?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(e){c.e(e)}finally{c.f()}n+=u}}}catch(e){r.e(e)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),sr(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),sr(this,"dragTo",(function(e){o.group.style.display=null;var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(ir(t),[e,t[0]]);n.push(r),o.setPoints(n),o.mask.redraw()})),sr(this,"addPoint",(function(e){if(o.points[o.points.length-1].length>0){var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=t[t.length-1];Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(ir(t),[e,t[0]]),o.setPoints(o.points),o.mask.redraw())}else o.points[o.points.length-1]=[e,e],o.setPoints(o.points)})),sr(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),sr(this,"newPart",(function(){o.points.push([])})),sr(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),sr(this,"toSelection",(function(){return new k(or(or({},re(o.group,o.env.image)),{},{renderedVia:{name:"multipolygon"}}))})),this.points=[],this.points.push([t,t]),this.env=r,this.group=document.createElementNS(i,"g"),this.multipolygon=document.createElementNS(i,"g"),this.multipolygon.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new tr(r.image,this.inner),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.multipolygon),n.appendChild(this.group)},(t=[{key:"element",get:function(){return this.multipolygon}}])&&lr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function br(e){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(e)}function yr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yr(Object(n),!0).forEach((function(t){Sr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,jr(r.key),r)}}function hr(e,t,n){return t=Or(t),function(e,t){if(t&&("object"===br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vr()?Reflect.construct(t,n||[],Or(e).constructor):t.apply(e,n))}function vr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(vr=function(){return!!e})()}function gr(e,t){return gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},gr(e,t)}function wr(){return wr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Or(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},wr.apply(this,arguments)}function Or(e){return Or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Or(e)}function Sr(e,t,n){return(t=jr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jr(e){var t=function(e,t){if("object"!=br(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=br(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==br(t)?t:t+""}function Pr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Er(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){a=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function Er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ar=function(e){var t,n=[],r=Pr(xr(e.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(t=r.n()).done;){var o,i=t.value,u=[],a=Pr(i);try{for(a.s();!(o=a.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};u.push(l)}}catch(e){a.e(e)}finally{a.f()}n.push(u)}}catch(e){r.e(e)}finally{r.f()}return n},xr=function(e){var t=e.split("M"),n=[];return t.forEach((function(e,t){if(e.length>0){var r=[];(e=(e=(e=(e=(e=e.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(e,t){r.push([parseFloat(e.split(",")[0]).toFixed(2).toString(),parseFloat(e.split(",")[1]).toFixed(2).toString()])})),r[0]!==r[r.length-1]&&r.push(r[0]),n.push(r)}})),n},Cr=function(e){function t(e,n,r,o){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Sr(u=hr(this,t,[e,n,r,o]),"setPoints",(function(e){var t,n=function(e){return Math.round(10*e)/10},r="",o=Pr(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r+="M";var a,c=!0,l=Pr(i);try{for(l.s();!(a=l.n()).done;){var s=a.value;c?(c=!1,r+=s.x.toString()+","+s.y.toString()):r+=" L"+n(s.x).toString()+","+n(s.y).toString()}}catch(e){l.e(e)}finally{l.f()}r+=" Z"}}catch(e){o.e(e)}finally{o.f()}u.shape.querySelector(".a9s-inner").setAttribute("d",r);var f=u.shape.querySelector(".a9s-outer");f.setAttribute("d",r);var p=f.getBBox(),b=p.x,y=p.y,d=p.width,m=p.height;le(u.elementGroup,b,y,d,m)})),Sr(u,"onGrab",(function(e){return function(t){u.grabbedElem=e;var n=u.getSVGPoint(t);u.grabbedAt={x:n.x,y:n.y}}})),Sr(u,"onMouseMove",(function(e){if(u.grabbedElem){var t=u.getSVGPoint(e);if(u.grabbedElem===u.shape){var n,r=t.x-u.grabbedAt.x,o=t.y-u.grabbedAt.y,i=[],a=Pr(Ar(u.shape));try{for(a.s();!(n=a.n()).done;){var c=n.value;i.push(c.map((function(e){return{x:e.x+r,y:e.y+o}})))}}catch(e){a.e(e)}finally{a.f()}u.grabbedAt=t,u.setPoints(i);for(var l=0,s=0,f=i;s<f.length;s++)f[s].forEach((function(e,t){void 0!==u.handles[l][t]&&u.setHandleXY(u.handles[l][t],e.x,e.y)})),l+=1;u.emit("update",dr(dr({},re(u.shape,u.env.image)),{},{renderedVia:{name:"multipolygon"}}))}else{var p,b=-1,y=0,d=!1,m=Pr(u.handles);try{for(m.s();!(p=m.n()).done;){var h=p.value;h.indexOf(u.grabbedElem)>0?(b=h.indexOf(u.grabbedElem),d=!0):d||(y+=1)}}catch(e){m.e(e)}finally{m.f()}var v,g=Ar(u.shape),w=[],O=0,S=Pr(g);try{var j=function(){var e=v.value;if(O===y){var n=[];e.forEach((function(e,r){r===b?n.push(t):n.push(e)})),w.push(n)}else w.push(e);O+=1};for(S.s();!(v=S.n()).done;)j()}catch(e){S.e(e)}finally{S.f()}u.setPoints(w),O=0;var P,E=Pr(u.handles);try{for(E.s();!(P=E.n()).done;){var A=P.value;O===y&&u.setHandleXY(A[b],t.x,t.y),O+=1}}catch(e){E.e(e)}finally{E.f()}u.emit("update",dr(dr({},re(u.shape,u.env.image)),{},{renderedVia:{name:"multipolygon"}}))}}})),Sr(u,"onMouseUp",(function(e){u.grabbedElem=null,u.grabbedAt=null})),Sr(u,"updateState",(function(e){var t=Ar(te(e));u.setPoints(t)})),Sr(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),wr(Or(t.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=function(e){var t=te(e);!function(e){var t=te(e).getAttribute("d");xr(t)}(e);var n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n}(e),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.appendChild(u.shape);var a=Ar(u.shape);u.handles=[];var c,l=Pr(a);try{for(l.s();!(c=l.n()).done;){var s=c.value;u.handles.push(s.map((function(e){var t=u.drawHandle(e.x,e.y);return t.addEventListener("mousedown",u.onGrab(t)),u.elementGroup.appendChild(t),t})))}}catch(e){l.e(e)}finally{l.f()}u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ce(u.shape,e,r.formatter),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape));var f=u.shape.querySelector(".a9s-inner").getBBox();return f.x,f.y,f.width,f.height,u.grabbedElem=null,u.grabbedAt=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gr(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return this.elementGroup}}])&&mr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function kr(e){return kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kr(e)}function Mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Nr(r.key),r)}}function _r(e,t,n){return t=Gr(t),function(e,t){if(t&&("object"===kr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Tr()?Reflect.construct(t,n||[],Gr(e).constructor):t.apply(e,n))}function Tr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Tr=function(){return!!e})()}function Gr(e){return Gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gr(e)}function Rr(e,t){return Rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rr(e,t)}function Dr(e,t,n){return(t=Nr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nr(e){var t=function(e,t){if("object"!=kr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=kr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==kr(t)?t:t+""}var Lr=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Dr(o=_r(this,t,[e,n,r]),"startDrawing",(function(e,t){o._isDrawing=!0,o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp,dblClick:o.onDblClick}),o.rubberband=new pr([e,t],o.g,o.env)})),Dr(o,"stop",(function(){o.detachListeners(),o._isDrawing=!1,o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),Dr(o,"undo",(function(){o.rubberband&&o.rubberband.undo()})),Dr(o,"newPart",(function(){o.rubberband&&o.rubberband.newPart()})),Dr(o,"onMouseMove",(function(e,t){return o.rubberband.dragTo([e,t])})),Dr(o,"onMouseUp",(function(e,t,n){if(n.altKey)o.onDblClick(n);else if(n.ctrlKey)o.rubberband.undo();else{var r=o.rubberband.getBoundingClientRect(),i=r.width,u=r.height,a=o.config.minSelectionWidth||4,c=o.config.minSelectionHeight||4;i>=a||u>=c?o.rubberband.addPoint([e,t]):(o.emit("cancel"),o.stop())}})),Dr(o,"onDblClick",(function(e,t){o._isDrawing=!1,o.rubberband.addPoint([e,t]);var n=o.rubberband.element;n.annotation=o.rubberband.toSelection(),o.emit("complete",n),o.stop()})),Dr(o,"createEditableShape",(function(e){return new Cr(e,o.g,o.config,o.env)})),o._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&o.undo(),"n"==e.key&&o.newPart()})),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rr(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Mr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Hr(e){return Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hr(e)}function Br(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,qr(r.key),r)}}function Ur(e,t,n){return(t=qr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qr(e){var t=function(e,t){if("object"!=Hr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Hr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Hr(t)?t:t+""}Lr.identifier="multipolygon",Lr.supports=function(e){return!1};var Xr=function(){return e=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ur(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.line.getAttribute("x1")," ").concat(r.line.getAttribute("y1")," ").concat(r.line.getAttribute("x2")," ").concat(r.line.getAttribute("y2"),"z"))})),Ur(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.line=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," z"))},(t=[{key:"element",get:function(){return this.mask}}])&&Br(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Fr(e){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fr(e)}function Vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vr(Object(n),!0).forEach((function(t){Wr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ir(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$r(r.key),r)}}function Wr(e,t,n){return(t=$r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $r(e){var t=function(e,t){if("object"!=Fr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Fr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fr(t)?t:t+""}var Zr=function(){return e=function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Wr(this,"setPoints",(function(e){var t=e;o.outer.setAttribute("x1",t[0]),o.inner.setAttribute("x1",t[0]),o.outer.setAttribute("y1",t[1]),o.inner.setAttribute("y1",t[1]),t.length>2&&(o.outer.setAttribute("x2",t[2]),o.inner.setAttribute("x2",t[2]),o.outer.setAttribute("y2",t[3]),o.inner.setAttribute("y2",t[3]))})),Wr(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Wr(this,"dragTo",(function(e){o.group.style.display=null,o.mousepos=e;var t,n=[].concat(function(e){if(Array.isArray(e))return zr(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return zr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zr(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e[0],e[1]]);o.setPoints(n),o.mask.redraw()})),Wr(this,"addPoint",(function(e){o.points.length<=2&&(o.points[2]=e[0],o.points[3]=e[1],o.setPoints(o.points))})),Wr(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),Wr(this,"newPart",(function(){o.points.push([])})),Wr(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.Line=null,o.group=null})),Wr(this,"toSelection",(function(){return new k(Yr(Yr({},re(o.group,o.env.image)),{},{renderedVia:{name:"line"}}))})),this.points=t,this.env=r,this.group=document.createElementNS(i,"g"),this.Line=document.createElementNS(i,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new Xr(r.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),n.appendChild(this.group)},(t=[{key:"element",get:function(){return this.Line}}])&&Ir(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Kr(e){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kr(e)}function Jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,uo(r.key),r)}}function eo(e,t,n){return t=oo(t),function(e,t){if(t&&("object"===Kr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,to()?Reflect.construct(t,n||[],oo(e).constructor):t.apply(e,n))}function to(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(to=function(){return!!e})()}function no(e,t){return no=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},no(e,t)}function ro(){return ro="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oo(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ro.apply(this,arguments)}function oo(e){return oo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oo(e)}function io(e,t,n){return(t=uo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uo(e){var t=function(e,t){if("object"!=Kr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Kr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Kr(t)?t:t+""}var ao=function(e){var t=e.querySelector(".a9s-inner");return[[t.x1.baseVal,t.y1.baseVal],[t.x2.baseVal,t.y2.baseVal]]},co=function(e){function t(e,n,r,o){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),io(u=eo(this,t,[e,n,r,o]),"onScaleChanged",(function(){return u.handles.map(u.scaleHandle)})),io(u,"setPoints",(function(e){var t=e[0].x,n=e[0].y,r=e[1].x,o=e[1].y,i=u.shape.querySelector(".a9s-inner");i.setAttribute("x1",t),i.setAttribute("y1",n),i.setAttribute("x2",r),i.setAttribute("y2",o);var a=u.shape.querySelector(".a9s-outer");a.setAttribute("x1",t),a.setAttribute("y1",n),a.setAttribute("x2",r),a.setAttribute("y2",o),u.mask.redraw();var c=a.getBBox(),l=c.x,s=c.y,f=c.width,p=c.height;le(u.elementGroup,l,s,f,p)})),io(u,"onGrab",(function(e){return function(t){0===t.button&&(u.grabbedElem=e,u.grabbedAt=u.getSVGPoint(t))}})),io(u,"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(u.grabbedElem){var n=u.getSVGPoint(e);if(u.grabbedElem===u.shape){var r=u.shape.querySelector(".a9s-inner").getBBox(),o=r.x,i=r.y,a=r.width,c=r.height,l=u.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-u.grabbedAt.x,s-a),b=t(i,n.y-u.grabbedAt.y,f-c),y=ao(u.shape).map((function(e){return{x:e[0].value+p,y:e[1].value+b}}));u.grabbedAt=n,u.setPoints(y),y.forEach((function(e,t){return u.setHandleXY(u.handles[t],e.x,e.y)})),u.emit("update",re(u.shape,u.env.image))}else{var d=u.handles.indexOf(u.grabbedElem),m=ao(u.shape).map((function(e,t){return t===d?n:{x:e[0].value,y:e[1].value}}));u.setPoints(m),u.setHandleXY(u.handles[d],n.x,n.y),u.emit("update",re(u.shape,u.env.image))}}})),io(u,"onMouseUp",(function(e){u.grabbedElem=null,u.grabbedAt=null})),io(u,"updateState",(function(e){var t=te(e).getAttribute("points").split(" ").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Jr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split(",").map((function(e){return parseFloat(e.trim())})),2);return{x:t[0],y:t[1]}}));console.log(e),console.log(te(e)),console.log(t),u.setPoints(t),t.forEach((function(e,t){return u.setHandleXY(u.handles[t],e.x,e.y)}))})),io(u,"destroy",(function(){u.containerGroup.parentNode.removeChild(u.containerGroup),ro(oo(t.prototype),"destroy",u).call(u)})),u.svg.addEventListener("mousemove",u.onMouseMove),u.svg.addEventListener("mouseup",u.onMouseUp),u.containerGroup=document.createElementNS(i,"g"),u.shape=ne(e),u.shape.querySelector(".a9s-inner").addEventListener("mousedown",u.onGrab(u.shape)),u.mask=new Xr(o.image,u.shape.querySelector(".a9s-inner")),u.containerGroup.appendChild(u.mask.element),u.elementGroup=document.createElementNS(i,"g"),u.elementGroup.setAttribute("class","a9s-annotation editable selected"),u.elementGroup.setAttribute("data-id",e.id),u.elementGroup.appendChild(u.shape),u.handles=ao(u.shape).map((function(e){var t=u.drawHandle(e[0].value,e[1].value);return t.addEventListener("mousedown",u.onGrab(t)),u.elementGroup.appendChild(t),t})),u.containerGroup.appendChild(u.elementGroup),n.appendChild(u.containerGroup),ce(u.shape,e,r.formatters),u.grabbedElem=null,u.grabbedAt=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&no(e,t)}(t,e),n=t,(r=[{key:"element",get:function(){return this.elementGroup}}])&&Qr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);function lo(e){return lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lo(e)}function so(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ho(r.key),r)}}function fo(e,t,n){return t=bo(t),function(e,t){if(t&&("object"===lo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,po()?Reflect.construct(t,n||[],bo(e).constructor):t.apply(e,n))}function po(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(po=function(){return!!e})()}function bo(e){return bo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bo(e)}function yo(e,t){return yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yo(e,t)}function mo(e,t,n){return(t=ho(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ho(e){var t=function(e,t){if("object"!=lo(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=lo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==lo(t)?t:t+""}var vo=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),mo(o=fo(this,t,[e,n,r]),"startDrawing",(function(e,t){o._isDrawing=!0,o.attachListeners({mouseMove:o.onMouseMove,mouseUp:o.onMouseUp}),o.rubberband=new Zr([e,t],o.g,o.env)})),mo(o,"stop",(function(){o.detachListeners(),o._isDrawing=!1,o.rubberband&&(o.rubberband.destroy(),o.rubberband=null)})),mo(o,"undo",(function(){o.rubberband&&o.rubberband.undo()})),mo(o,"newPart",(function(){o.rubberband&&o.rubberband.newPart()})),mo(o,"onMouseMove",(function(e,t){return o.rubberband.dragTo([e,t])})),mo(o,"onMouseUp",(function(e,t,n){if(n.altKey)o.onDblClick(n);else if(n.ctrlKey)o.rubberband.undo();else if(2==o.rubberband.points.length)if(o.rubberband.addPoint([e,t]),o.rubberband.points[0]==o.rubberband.points[2]&&o.rubberband.points[1]==o.rubberband.points[3])o.emit("cancel"),o.stop();else{o._isDrawing=!1;var r=o.rubberband.element;r.annotation=o.rubberband.toSelection(),o.emit("complete",r),o.stop()}})),mo(o,"createEditableShape",(function(e){return new co(e,o.g,o.config,o.env)})),o._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&o.undo(),"n"==e.key&&o.newPart()})),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yo(e,t)}(t,e),n=t,(r=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&so(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);vo.identifier="line",vo.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<line/g)};var go=new Set(["point","pointcross","circle","ellipse","freehand","line"]);const wo=function(e,t){(null!=t&&t.tools?t.tools.map((function(e){return e.toLowerCase()})):go).forEach((function(t){"point"===t&&e.addDrawingTool(ct),"pointcross"===t&&e.addDrawingTool(Le),"circle"===t&&e.addDrawingTool(Xt),"ellipse"===t&&e.addDrawingTool(jn),"freehand"===t&&e.addDrawingTool(Zn),"multipolygon"===t&&e.addDrawingTool(Lr),"line"===t&&e.addDrawingTool(vo)}))}})(),r.default})()));
//# sourceMappingURL=annotorious-selector-pack.js.map