{"version":3,"file":"annotorious-selector-pack.js","mappings":"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","sources":["webpack://Annotorious.SelectorPack/webpack/universalModuleDefinition","webpack://Annotorious.SelectorPack/./node_modules/fast-deep-equal/index.js","webpack://Annotorious.SelectorPack/./node_modules/tiny-emitter/index.js","webpack://Annotorious.SelectorPack/webpack/bootstrap","webpack://Annotorious.SelectorPack/webpack/runtime/compat get default export","webpack://Annotorious.SelectorPack/webpack/runtime/define property getters","webpack://Annotorious.SelectorPack/webpack/runtime/hasOwnProperty shorthand","webpack://Annotorious.SelectorPack/./node_modules/uuid/dist/esm-browser/rng.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/util/SVG.js","webpack://Annotorious.SelectorPack/./node_modules/uuid/dist/esm-browser/regex.js","webpack://Annotorious.SelectorPack/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://Annotorious.SelectorPack/./node_modules/uuid/dist/esm-browser/validate.js","webpack://Annotorious.SelectorPack/./node_modules/uuid/dist/esm-browser/v4.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/recogito-client-core/src/WebAnnotation.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/recogito-client-core/src/Selection.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/tools/Tool.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/util/Touch.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/tools/EditableShape.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/selectors/EmbeddedSVG.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/util/Formatting.js","webpack://Annotorious.SelectorPack/./src/pointcross/EditablePointcross.js","webpack://Annotorious.SelectorPack/./src/pointcross/PointcrossSelection.js","webpack://Annotorious.SelectorPack/./src/pointcross/PointcrossTool.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/selectors/RectFragment.js","webpack://Annotorious.SelectorPack/./src/point/Point.js","webpack://Annotorious.SelectorPack/./src/point/EditablePoint.js","webpack://Annotorious.SelectorPack/./src/point/PointTool.js","webpack://Annotorious.SelectorPack/./src/circle/Circle.js","webpack://Annotorious.SelectorPack/./src/circle/CircleMask.js","webpack://Annotorious.SelectorPack/./src/circle/RubberbandCircle.js","webpack://Annotorious.SelectorPack/./src/circle/EditableCircle.js","webpack://Annotorious.SelectorPack/./src/circle/RubberbandCircleTool.js","webpack://Annotorious.SelectorPack/./src/ellipse/Ellipse.js","webpack://Annotorious.SelectorPack/./src/ellipse/EllipseMask.js","webpack://Annotorious.SelectorPack/./src/ellipse/RubberbandEllipse.js","webpack://Annotorious.SelectorPack/./src/ellipse/EditableEllipse.js","webpack://Annotorious.SelectorPack/./src/ellipse/RubberbandEllipseTool.js","webpack://Annotorious.SelectorPack/./src/freehand/RubberbandFreehand.js","webpack://Annotorious.SelectorPack/./src/freehand/EditableFreehand.js","webpack://Annotorious.SelectorPack/./src/freehand/RubberbandFreehandTool.js","webpack://Annotorious.SelectorPack/./node_modules/@recogito/annotorious/src/tools/polygon/PolygonMask.js","webpack://Annotorious.SelectorPack/./src/multipolygon/RubberbandMultipolygon.js","webpack://Annotorious.SelectorPack/./src/multipolygon/EditableMultipolygon.js","webpack://Annotorious.SelectorPack/./src/multipolygon/RubberbandMultipolygonTool.js","webpack://Annotorious.SelectorPack/./src/line/LineMask.js","webpack://Annotorious.SelectorPack/./src/line/RubberbandLine.js","webpack://Annotorious.SelectorPack/./src/line/EditableLine.js","webpack://Annotorious.SelectorPack/./src/line/RubberbandLineTool.js","webpack://Annotorious.SelectorPack/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Annotorious\"] = factory();\n\telse\n\t\troot[\"Annotorious\"] = root[\"Annotorious\"] || {}, root[\"Annotorious\"][\"SelectorPack\"] = factory();\n})(self, () => {\nreturn ","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","function E () {\n  // Keep this empty so it's easier to inherit from\n  // (via https://github.com/lipsmack from https://github.com/scottcorgan/tiny-emitter/issues/3)\n}\n\nE.prototype = {\n  on: function (name, callback, ctx) {\n    var e = this.e || (this.e = {});\n\n    (e[name] || (e[name] = [])).push({\n      fn: callback,\n      ctx: ctx\n    });\n\n    return this;\n  },\n\n  once: function (name, callback, ctx) {\n    var self = this;\n    function listener () {\n      self.off(name, listener);\n      callback.apply(ctx, arguments);\n    };\n\n    listener._ = callback\n    return this.on(name, listener, ctx);\n  },\n\n  emit: function (name) {\n    var data = [].slice.call(arguments, 1);\n    var evtArr = ((this.e || (this.e = {}))[name] || []).slice();\n    var i = 0;\n    var len = evtArr.length;\n\n    for (i; i < len; i++) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data);\n    }\n\n    return this;\n  },\n\n  off: function (name, callback) {\n    var e = this.e || (this.e = {});\n    var evts = e[name];\n    var liveEvents = [];\n\n    if (evts && callback) {\n      for (var i = 0, len = evts.length; i < len; i++) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i]);\n      }\n    }\n\n    // Remove event from queue to prevent memory leak\n    // Suggested by https://github.com/lazd\n    // Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910\n\n    (liveEvents.length)\n      ? e[name] = liveEvents\n      : delete e[name];\n\n    return this;\n  }\n};\n\nmodule.exports = E;\nmodule.exports.TinyEmitter = E;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n\nconst getClassNames = el => {\n  const attr = el.getAttribute('class');\n  return attr ? new Set(attr.split(' ')) : new Set();\n}\n\n// IE11 doesn't support adding/removing classes to SVG elements except \n// via .setAttribute\nexport const addClass = (el, className) => {\n  const classNames = getClassNames(el);\n  classNames.add(className);\n  el.setAttribute('class', Array.from(classNames).join(' '));\n}\n\nexport const removeClass = (el, className) => {\n  const classNames = getClassNames(el);\n  classNames.delete(className);\n\n  if (classNames.size === 0)\n    el.removeAttribute('class');\n  else\n    el.setAttribute('class', Array.from(classNames).join(' '));\n}\n\nexport const hasClass = (el, className) =>\n  getClassNames(el).has(className);","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","import { v4 as uuid } from 'uuid';\nimport equals from 'fast-deep-equal';\n\nexport default class WebAnnotation {\n\n  constructor(annotation, opts) {\n    this.underlying = annotation;\n    this.opts = opts;\n  }\n\n  /** For convenience - creates an empty web annotation **/\n  static create = args => {\n    const stub = {\n      '@context': 'http://www.w3.org/ns/anno.jsonld',\n      'type': 'Annotation',\n      'id': `#${uuid()}`,\n      'body': []\n    };\n\n    return new WebAnnotation({ ...stub, ...args });\n  }\n\n  /** Creates a copy of this annotation **/\n  clone = (opt_props, opt_opts) => {\n    return new WebAnnotation({ ...this.underlying, ...opt_props}, { ...this.opts, ...opt_opts });\n  }\n\n  /** An equality check based on the underlying object **/\n  isEqual(other) {\n    if (other?.type !== 'Annotation') {\n      return false;\n    } else if (this.underlying === other.underlying) {\n      return true;\n    } else if (!this.underlying.id || !other.underlying.id) {\n      return false;\n    } else {\n      return equals(this.underlying, other.underlying);\n    }\n  }\n\n  get readOnly() {\n    return this.opts?.readOnly;\n  }\n\n  /*************************************/\n  /* Getters to forward properties of  */\n  /* the underlying annotation         */\n  /*************************************/\n\n  get id() {\n    return this.underlying.id;\n  }\n\n  get context() {\n    return this.underlying['@context'];\n  }\n\n  get type() {\n    return this.underlying.type;\n  }\n\n  get motivation() {\n    return this.underlying.motivation;\n  }\n\n  get body() {\n    return this.underlying.body;\n  }\n\n  get target() {\n    return this.underlying.target;\n  }\n\n  /** Same as .body, but guaranteed to return an array **/\n  get bodies() {\n    return (Array.isArray(this.underlying.body)) ?\n      this.underlying.body : [ this.underlying.body ];\n  }\n\n  /** Only bodies are meant to be mutated by the application **/\n  set bodies(bodies) {\n    this.underlying.body = bodies;\n  }\n\n  /** Same as .target, but guaranteed to return an array **/\n  get targets() {\n    return (Array.isArray(this.underlying.target)) ?\n      this.underlying.target : [ this.underlying.target ];\n  }\n\n  /*****************************************/\n  /* Various access helpers and shorthands */\n  /*****************************************/\n\n  /** Selector of the given type **/\n  selector = type => {\n    const { target } = this.underlying;\n\n    if (target.selector) {\n      // Normalize to array\n      const selectors = Array.isArray(target.selector) ?\n        target.selector : [ target.selector ];\n\n      return selectors.find(s => s.type === type);\n    }\n  }\n\n  /** Shorthand for the 'exact' field of the TextQuoteSelector **/\n  get quote() {\n    return this.selector('TextQuoteSelector')?.exact;\n  }\n\n  /** Shorthand for the 'start' field of the TextPositionSelector **/\n  get start() {\n    return this.selector('TextPositionSelector')?.start;\n  }\n\n  /** Shorthand for the 'end' field of the TextPositionSelector **/\n  get end() {\n    return this.selector('TextPositionSelector')?.end;\n  }\n\n}\n","import WebAnnotation from './WebAnnotation';\nimport { v4 as uuid } from 'uuid';\nimport equals from 'fast-deep-equal';\n\n/**\n * An \"annotation in draft mode\". Really the same\n * data structure, but as a separate class so we can\n * tell things apart properly.\n */\nexport default class Selection {\n\n  constructor(target, body) {\n    this.underlying = {\n      '@context': 'http://www.w3.org/ns/anno.jsonld',\n      type: 'Selection',\n      body: body || [],\n      target\n    }\n  }\n\n  /** Creates a copy of this selection **/\n  clone = opt_props => {\n    // Deep-clone\n    const cloned = new Selection();\n    cloned.underlying = JSON.parse(JSON.stringify(this.underlying));\n\n    if (opt_props)\n      cloned.underlying = { ...cloned.underlying, ...opt_props };\n\n    return cloned;\n  }\n\n  get context() {\n    return this.underlying['@context'];\n  }\n\n  get type() {\n    return this.underlying.type;\n  }\n\n  get body() {\n    return this.underlying.body;\n  }\n\n  get target() {\n    return this.underlying.target;\n  }\n\n  get targets() {\n    return (Array.isArray(this.underlying.target)) ?\n      this.underlying.target : [ this.underlying.target ];\n  }\n\n  /** For consistency with WebAnnotation **/\n  isEqual(other) {\n    if (!other) {\n      return false;\n    } else {\n      return equals(this.underlying, other.underlying);\n    }\n  }\n\n  get bodies() {\n    return (Array.isArray(this.underlying.body)) ?\n      this.underlying.body : [ this.underlying.body ];\n  }\n\n  selector = type => {\n    const { target } = this.underlying;\n\n    if (target.selector) {\n      // Normalize to array\n      const selectors = Array.isArray(target.selector) ?\n        target.selector : [ target.selector ];\n\n      return selectors.find(s => s.type === type);\n    }\n  }\n\n  /** Shorthand for the 'exact' field of the TextQuoteSelector **/\n  get quote() {\n    return this.selector('TextQuoteSelector')?.exact;\n  }\n\n  /*******************************************/\n  /* Selection-specific properties & methods */\n  /*******************************************/\n\n  get isSelection() {\n    return true;\n  }\n\n  toAnnotation = () => {\n    const a = Object.assign({}, this.underlying, {\n      'type': 'Annotation',\n      'id': `#${uuid()}`\n    });\n\n    return new WebAnnotation(a);\n  }\n\n}\n","import EventEmitter from 'tiny-emitter';\nimport { isTouchDevice } from '../util/Touch';\nimport { SVG_NAMESPACE } from '../util/SVG';\n\nconst IMPLEMENTATION_MISSING = \"An implementation is missing\";\n\nconst isTouch = isTouchDevice();\n\n/**\n * A commmon base class for Tools and EditableShapes\n */\nexport class ToolLike extends EventEmitter {\n\n  constructor(g, config, env) {\n    super();\n\n    this.svg = g.closest('svg');\n\n    this.g = g;\n    this.config = config;\n    this.env = env;\n\n    // Default image scale\n    this.scale = 1;\n\n    // Bit of a hack. If we are dealing with a 'real' image, we enable\n    // reponsive mode. OpenSeadragon handles scaling in a different way,\n    // so we don't need responsive mode.\n    const { image } = env;\n    if (image instanceof Element || image instanceof HTMLDocument)\n      this.enableResponsive();\n  }\n\n  /**\n   * Implementations MAY extend this (calling super),\n   * to destroy SVG elements, mask, etc.\n   */\n  destroy() {\n    if (this.resizeObserver)\n      this.resizeObserver.disconnect();\n\n    this.resizeObserver = null;\n  }\n\n  enableResponsive = () => {\n    if (window.ResizeObserver) {\n      this.resizeObserver = new ResizeObserver(() => {\n        const svgBounds = this.svg.getBoundingClientRect();\n        const { width, height } = this.svg.viewBox.baseVal;\n\n        this.scale = Math.max(\n          width / svgBounds.width,\n          height / svgBounds.height\n        );\n\n        if (this.onScaleChanged)\n          this.onScaleChanged(this.scale);\n      });\n\n      this.resizeObserver.observe(this.svg.parentNode);\n    }\n  }\n\n  getSVGPoint = evt => {\n    const pt = this.svg.createSVGPoint();\n\n    if (isTouch) {\n      const bbox = this.svg.getBoundingClientRect();\n\n      const x = evt.clientX - bbox.x;\n      const y = evt.clientY - bbox.y;\n\n      const { left, top } = this.svg.getBoundingClientRect();\n      pt.x = x + left;\n      pt.y = y + top;\n\n      return pt.matrixTransform(this.g.getScreenCTM().inverse());\n    } else {\n      pt.x = evt.offsetX;\n      pt.y = evt.offsetY;\n\n      return pt.matrixTransform(this.g.getCTM().inverse());\n    }\n  }\n\n  /*********************************/\n  /*  Helpers for drawing handles  */\n  /*********************************/\n\n  drawHandle = (x, y) => {\n    const containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    containerGroup.setAttribute('class', 'a9s-handle');\n\n    const group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    const drawCircle = r => {\n      const c = document.createElementNS(SVG_NAMESPACE, 'circle');\n      c.setAttribute('cx', x);\n      c.setAttribute('cy', y);\n      c.setAttribute('r', r);\n      c.setAttribute('transform-origin', `${x} ${y}`);\n      return c;\n    }\n\n    const radius = this.config.handleRadius || 6;\n\n    const inner = drawCircle(radius);\n    inner.setAttribute('class', 'a9s-handle-inner')\n\n    const outer = drawCircle(radius + 1);\n    outer.setAttribute('class', 'a9s-handle-outer')\n\n    group.appendChild(outer);\n    group.appendChild(inner);\n\n    containerGroup.appendChild(group);\n    return containerGroup;\n  }\n\n  setHandleXY = (handle, x, y) => {\n    const inner = handle.querySelector('.a9s-handle-inner');\n    inner.setAttribute('cx', x);\n    inner.setAttribute('cy', y);\n    inner.setAttribute('transform-origin', `${x} ${y}`);\n\n    const outer = handle.querySelector('.a9s-handle-outer');\n    outer.setAttribute('cx', x);\n    outer.setAttribute('cy', y);\n    outer.setAttribute('transform-origin', `${x} ${y}`);\n  }\n\n  getHandleXY = handle => {\n    const outer = handle.querySelector('.a9s-handle-outer');\n    return {\n      x: parseFloat(outer.getAttribute('cx')),\n      y: parseFloat(outer.getAttribute('cy'))\n    }\n  }\n\n  scaleHandle = handle => {\n    const inner = handle.querySelector('.a9s-handle-inner');\n    const outer = handle.querySelector('.a9s-handle-outer');\n\n    const radius = this.scale * (this.config.handleRadius || 6);\n\n    inner.setAttribute('r', radius);\n    outer.setAttribute('r', radius);\n  }\n\n}\n\n/**\n * Base class that adds some convenience stuff for tool plugins.\n */\nexport default class Tool extends ToolLike {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    // We'll keep a flag set to false until\n    // the user has started moving, so we can\n    // fire the startSelection event\n    this.started = false;\n  }\n\n  attachListeners = ({ mouseMove, mouseUp, dblClick }) => {\n    // Handle SVG conversion on behalf of tool implementations\n    if (mouseMove) {\n      this.mouseMove = evt => {\n        const { x , y } = this.getSVGPoint(evt);\n\n        if (!this.started) {\n          this.emit('startSelection', { x, y });\n          this.started = true;\n        }\n\n        mouseMove(x, y, evt);\n      }\n\n      // Mouse move goes on SVG element\n      this.svg.addEventListener('mousemove', this.mouseMove);\n    }\n\n    if (mouseUp) {\n      this.mouseUp = evt => {\n        if (evt.button !== 0) return;  // left click\n        const { x , y } = this.getSVGPoint(evt);\n        mouseUp(x, y, evt);\n      }\n\n      // Mouse up goes on doc, so we capture events outside, too\n      document.addEventListener('mouseup', this.mouseUp);\n    }\n\n    if (dblClick) {\n      this.dblClick = evt => {\n        const { x , y } = this.getSVGPoint(evt);\n        dblClick(x, y, evt);\n      }\n\n      document.addEventListener('dblclick', this.dblClick);\n    }\n\n  }\n\n  detachListeners = () => {\n    if (this.mouseMove)\n      this.svg.removeEventListener('mousemove', this.mouseMove);\n\n    if (this.mouseUp)\n      document.removeEventListener('mouseup', this.mouseUp);\n\n    if (this.dblClick)\n      document.removeEventListener('dblclick', this.dblClick);\n  }\n\n  /**\n   * If startOnSingleClick is true, the tool starts on single click\n   * as well as drag. If false, starting strictly requires drag!\n   */\n  start = (evt, startOnSingleClick) => {\n    // Handle SVG conversion on behalf of tool implementations\n    const { x, y } = this.getSVGPoint(evt);\n    \n    // Constrain the initial coordinates (x, y) to be within the image bounds\n    const { naturalWidth, naturalHeight } = this.env.image;\n    const startX = x < 0 ? 0 : (x > naturalWidth ? naturalWidth : x);\n    const startY = y < 0 ? 0 : (y > naturalHeight ? naturalHeight : y);\n    \n    this.startDrawing(startX, startY, startOnSingleClick, evt);\n  }\n\n  /**\n   * Tool implementations MUST override these\n   */\n\n  get isDrawing() {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n  startDrawing = evt => {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n  createEditableShape = (annotation, formatters) => {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n}\n\n// In addition, Tool implementations need to implement the following static methods\n\n// Tool.identifier = '...'\n\nTool.supports = annotation => {\n  throw new Error(IMPLEMENTATION_MISSING);\n}\n\n// Just some convenience shortcuts to client-core, for quicker\n// importing in plugins. (In a way, the intention is to make the\n// Tool class serve as a kind of mini-SDK).\nexport { default as Selection } from '@recogito/recogito-client-core/src/Selection';\nexport { default as WebAnnotation } from '@recogito/recogito-client-core/src/WebAnnotation';\n","const SIM_EVENTS = {\n  touchstart: 'mousedown',\n  touchmove: 'mousemove',\n  touchend: 'mouseup'\n}\n\nexport const isTouchDevice = () =>\n  'ontouchstart' in window ||\n    navigator.maxTouchPoints > 0 ||\n      navigator.msMaxTouchPoints > 0;\n\nexport const enableTouchTranslation = el => {\n\n  let pressAndHoldTrigger = null;\n\n  const simulateEvent = (type, e) => new MouseEvent(type, {\n    screenX: e.screenX,\n    screenY: e.screenY,\n    clientX: e.clientX,\n    clientY: e.clientY,\n    pageX: e.pageX,\n    pageY: e.pageY,\n    bubbles: true\n  });\n\n  const touchHandler = evt => {\n    const touch = evt.changedTouches[0];\n    const simulatedEvent = simulateEvent(SIM_EVENTS[evt.type], touch);\n\n    touch.target.dispatchEvent(simulatedEvent);\n    evt.preventDefault();\n\n    if (evt.type === 'touchstart' || evt.type === 'touchmove') {\n      pressAndHoldTrigger && clearTimeout(pressAndHoldTrigger);\n\n      pressAndHoldTrigger = setTimeout(() => {\n        const simulatedEvent = simulateEvent('dblclick', touch);\n        touch.target.dispatchEvent(simulatedEvent);\n      }, 800);\n    }\n\n    if (evt.type === 'touchend')\n      pressAndHoldTrigger && clearTimeout(pressAndHoldTrigger);\n  }\n\n  el.addEventListener('touchstart', touchHandler, true);\n  el.addEventListener('touchmove', touchHandler, true);\n  el.addEventListener('touchend', touchHandler, true);\n  el.addEventListener('touchcancel', touchHandler, true);\n\n}","import { ToolLike } from './Tool';\n\nconst IMPLEMENTATION_MISSING = \"An implementation is missing\";\n\nexport default class EditableShape extends ToolLike {\n\n  constructor(annotation, g, config, env) {\n    super(g, config, env);\n\n    this.annotation = annotation;\n  }\n  \n  /**\n   * Implementations MUST override this method!\n   * \n   * Must return the 'g' element with the a9s-annotation class.\n   */\n  get element() {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n  /**\n   * Implementations MUST override this method!\n   * \n   * The annotation argument MUST be used to update\n   * the current state of the shape. It MUST NOT\n   * be stored as 'this.annotation'! 'this.annotation'\n   * MUST remain the original annotation at the time\n   * this EditableShape was created, because we will\n   * need it again in case the user cancels editing.\n   * \n   * Thinking of it in React terms, 'this.annotation'\n   * has the same purpose as props.annotation, whereas\n   * this method affects state.\n   */\n  updateState = annotation => {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n}\n","import { SVG_NAMESPACE } from '../util/SVG';\nimport { polygonArea, polygonInPolygon, svgPathToPolygons } from '../util/Geom2D';\n\n/** Helper that forces an un-namespaced node to SVG **/\nconst insertSVGNamespace = originalDoc => {\n  // Serialize and parse for the namespace to take effect on every node\n  const serializer = new XMLSerializer();\n  const str = serializer.serializeToString(originalDoc.documentElement);\n\n  // Doesn't seem that there's a clean cross-browser way for this...\n  const namespaced = str.replace('<svg>', `<svg xmlns=\"${SVG_NAMESPACE}\">`);\n\n  const parser = new DOMParser();\n  const namespacedDoc = parser.parseFromString(namespaced, \"image/svg+xml\");\n  return namespacedDoc.documentElement;\n}\n\nconst sanitize = doc => {\n  // Cf. https://github.com/mattkrick/sanitize-svg#readme  \n  // for the basic approach\n  const cleanEl = el => {\n    Array.from(el.attributes).forEach(attr => {\n      if (attr.name.startsWith('on'))\n        el.removeAttribute(attr.name)\n    });\n  }\n\n  // Remove script tags\n  const scripts = doc.getElementsByTagName('script');\n  Array.from(scripts).reverse().forEach(el =>\n    el.parentNode.removeChild(el));\n\n  // Remove on... attributes\n  cleanEl(doc);\n  Array.from(doc.querySelectorAll('*')).forEach(cleanEl);\n\n  return doc;\n}\n\nexport const svgFragmentToShape = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector) {\n    const parser = new DOMParser();\n\n    // Parse the XML document, assuming SVG\n    const { value } = selector;\n    const doc = parser.parseFromString(value, \"image/svg+xml\");\n\n    // SVG needs a namespace declaration - check if it's set or insert if not\n    const isPrefixDeclared = doc.lookupPrefix(SVG_NAMESPACE); // SVG declared via prefix\n    const isDefaultNamespaceSVG = doc.lookupNamespaceURI(null); // SVG declared as default namespace\n\n    if (isPrefixDeclared || isDefaultNamespaceSVG) {\n      return sanitize(doc).firstChild;\n    } else {\n      return sanitize(insertSVGNamespace(doc)).firstChild;\n    }\n  }\n}\n\nexport const drawEmbeddedSVG = annotation => {\n  const shape = svgFragmentToShape(annotation);\n\n  // Because we're nitpicky, we don't just draw the shape,\n  // but duplicate it, so we can have inner and an outer lines\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n\n  const inner = shape.cloneNode(true);\n  inner.setAttribute('class', 'a9s-inner');\n\n  const outer = shape.cloneNode(true);\n  outer.setAttribute('class', 'a9s-outer');\n\n  g.appendChild(outer);\n  g.appendChild(inner);\n\n  return g;\n}\n\nexport const toSVGTarget = (shape, image) => {\n  const inner = shape.querySelector('.a9s-inner').cloneNode(true);\n  inner.removeAttribute('class');\n  inner.removeAttribute('xmlns');\n\n  let serialized = inner.outerHTML || new XMLSerializer().serializeToString(inner);\n  serialized = serialized.replace(` xmlns=\"${SVG_NAMESPACE}\"`, '');\n\n  return {\n    source: image?.src,\n    selector: {\n      type: \"SvgSelector\",\n      value: `<svg>${serialized}</svg>`\n    }\n  }\n}\n\nexport const svgArea = annotation => {\n  const shape = svgFragmentToShape(annotation);\n  const nodeName = shape.nodeName.toLowerCase();\n\n  if (nodeName === 'polygon') \n    return svgPolygonArea(shape);\n  else if (nodeName === 'circle')\n    return svgCircleArea(shape);\n  else if (nodeName === 'ellipse')\n    return svgEllipseArea(shape);\n  else if (nodeName == 'path')\n    return svgPathArea(shape);\n  else if (nodeName == 'line')\n    return 0;\n  else\n    throw `Unsupported SVG shape type: ${nodeName}`;\n}\n\nconst svgPolygonArea = polygon => {\n  const points = polygon.getAttribute('points')\n    .trim()\n    .split(' ') // Split x/y tuples\n    .map(xy => xy.split(',').map(str => parseFloat(str.trim())));\n\n  return polygonArea(points)\n}\n\nconst svgCircleArea = circle => {\n  const r = circle.getAttribute('r');\n  return r * r * Math.PI;\n}\n\nconst svgEllipseArea = ellipse => {\n  const rx = ellipse.getAttribute('rx');\n  const ry = ellipse.getAttribute('ry');\n  return rx * ry * Math.PI;\n}\n\nconst svgPathArea = path => {\n  const polygons = svgPathToPolygons(path);\n\n  if (polygons.length == 1) {\n    return polygonArea(polygons[0]);\n  } else {\n    // Helper to check if a polygon is a hole\n    const isHole = p => polygons.find(other => {\n      if (p !== other)\n        return polygonInPolygon(p, other); \n    })\n\n    let area = 0\n\n    for (let poly of polygons) {\n      if (isHole(poly))\n        area -= polygonArea(poly);\n      else \n        area += polygonArea(poly);\n    }\n\n    return area;\n  }\n}","import { addClass, SVG_NAMESPACE } from './SVG';\n\nconst isFirefox = /firefox/i.test(navigator.userAgent);\n\nconst formatSvgEl = (svgEl, x, y, w, h) => {\n  svgEl.setAttribute('width', w);\n  svgEl.setAttribute('height', h);\n\n  // Argh - Firefox produces broken SVG bounds for nested SVG\n  if (isFirefox) {\n    svgEl.setAttribute('x', 0);\n    svgEl.setAttribute('y', 0);\n    svgEl.setAttribute('transform', `translate(${x}, ${y})`);  \n  } else {\n    svgEl.setAttribute('x', x);\n    svgEl.setAttribute('y', y);\n  }\n}\n\nconst appendFormatterEl = (formatterEl, shape) => {\n  const { x, y, width, height } = shape.getBBox();\n\n  const svgEl = document.createElementNS(SVG_NAMESPACE, 'svg');\n  svgEl.setAttribute('class', 'a9s-formatter-el');\n\n  formatSvgEl(svgEl, x, y, width, height);\n\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n  g.appendChild(formatterEl);y\n\n  svgEl.appendChild(g);\n  \n  shape.append(svgEl);\n}\n\n/**\n * A formatter is a user-defined function that takes an annotation as input,\n * and returns either a string, or an object. If a string is returned, this\n * will be appended to the annotation element CSS class list. Otherwise, the\n * object can have the following properties: \n * \n * - 'className' added to the CSS class list\n * - 'data-*' added as data attributes\n * - 'style' a list of CSS styles (in the form of a string) \n */\nexport const format = (shape, annotation, formatters) => {\n  // The formatter can be undefined\n  if (!formatters)\n    return shape;\n\n  // Merge outputs from all formatter functions into one object\n  const format = formatters.reduce((merged, fn) => {\n    const format = fn(annotation);\n\n    if (!format)\n      return merged;\n\n    if (typeof format === 'string' || format instanceof String) {\n      merged.className = merged.className ? `${merged.className} ${format}` : format; \n    } else if (format.nodeType === Node.ELEMENT_NODE) {\n      merged.elements = merged.elements ? [...merged.elements, format] : [format];\n    } else {\n      const { className, style, element } = format;\n\n      if (className)\n        merged.className = merged.className ? `${merged.className} ${className}` : className;\n\n      if (style)\n        merged.style = merged.style ? `${merged.style} ${style}` : style;\n\n      if (element)\n        merged.elements = merged.elements ? [...merged.elements, element] : [element];\n    }\n\n    // Copy data attributes\n    for (const key in format) {\n      if (format.hasOwnProperty(key) && key.startsWith('data-')) {\n        merged[key] = format[key];\n      }\n    }\n\n    return merged;\n  }, {});\n\n  const { className, style, elements } = format;\n\n  if (className)\n    addClass(shape, className);\n\n  if (style) {\n    const outer = shape.querySelector('.a9s-outer');\n    const inner = shape.querySelector('.a9s-inner');\n\n    if (outer && inner) {\n      outer.setAttribute('style', 'display:none');\n      inner.setAttribute('style', style);\n    } else {\n      shape.setAttribute('style', style);\n    }\n  }\n\n  if (elements)\n    elements.forEach(el => appendFormatterEl(el, shape));\n\n  for (const key in format) {\n    if (format.hasOwnProperty(key) && key.startsWith('data-')) {\n      shape.setAttribute(key, format[key]);\n    }\n  }\n}\n\nexport const setFormatterElSize = (group, x, y, w, h) => {\n  const formatterEl = group.querySelector('.a9s-formatter-el');\n  if (formatterEl)\n    formatSvgEl(formatterEl, x, y, w, h);\n}","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { parseRectFragment } from '@recogito/annotorious/src/selectors/RectFragment';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { toFragment } from './Pointcross';\nimport {\n  drawEmbeddedSVG,\n  svgFragmentToShape,\n  toSVGTarget,\n} from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport {\n  format,\n  setFormatterElSize,\n} from '@recogito/annotorious/src/util/Formatting';\n\n// export default class EditablePointcross extends EditableShape {\n\n//   drawPointcross = (x, y) => {\n//     const containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n//     containerGroup.setAttribute('class', 'a9s-handle');\n\n//     const group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n//     const drawLineHorizontal = size => {\n//       const xStart = x - size;\n//       const xEnd = x + size;\n\n//       const line = document.createElementNS(SVG_NAMESPACE, 'line');\n//       line.setAttribute('x1', xStart);\n//       line.setAttribute('y1', y);\n//       line.setAttribute('x2', xEnd);\n//       line.setAttribute('y2', y);\n//       line.setAttribute('stroke-width', 4);\n//       line.setAttribute('transform-origin', `${x} ${y}`);\n//       return line;\n//     }\n\n//     const drawLineVertical = size => {\n//       const yStart = y - size;\n//       const yEnd = y + size;\n\n//       const line = document.createElementNS(SVG_NAMESPACE, 'line');\n//       line.setAttribute('x1', x);\n//       line.setAttribute('y1', yStart);\n//       line.setAttribute('x2', x);\n//       line.setAttribute('y2', yEnd);\n//       line.setAttribute('stroke-width', 4);\n//       line.setAttribute('transform-origin', `${x} ${y}`);\n//       return line;\n//     }\n\n//     // const radius = this.config.handleRadius || 6;\n\n//     const inner = drawLineHorizontal(25);\n//     inner.setAttribute('class', 'a9s-handle-inner')\n\n//     const outer = drawLineVertical(25);\n//     outer.setAttribute('class', 'a9s-handle-outer')\n\n//     group.appendChild(outer);\n//     group.appendChild(inner);\n\n//     containerGroup.appendChild(group);\n//     return containerGroup;\n//   }\n\n//   // setPointcrossXY = (pointcross, x, y) => {\n//   //   const inners = pointcross.querySelectorAll('.a9s-inner');\n\n//   //   for (let i = 0; i < inners.length; i++) {\n//   //    if (i===0) {\n//   //     inners[i].setAttribute('x1', x - 25);\n//   //     inners[i].setAttribute('y1', y);\n//   //     inners[i].setAttribute('x2', x + 25);\n//   //     inners[i].setAttribute('y2', y);\n//   //     inners[i].setAttribute('center-x', x);\n//   //     inners[i].setAttribute('center-y', y);\n//   //     inners[i].setAttribute('transform-origin', `${x} ${y}`);\n//   //    } else {\n//   //     inners[i].setAttribute('x1', x);\n//   //     inners[i].setAttribute('y1', y - 25);\n//   //     inners[i].setAttribute('x2', x);\n//   //     inners[i].setAttribute('y2', y + 25);\n//   //     inners[i].setAttribute('center-x', x);\n//   //     inners[i].setAttribute('center-y', y);\n//   //     inners[i].setAttribute('transform-origin', `${x} ${y}`);\n//   //    }\n//   //   }\n//   // }\n\n//   setPointcrossXY = (pointcross, x, y) => {\n//     const inner = pointcross.querySelector('.a9s-inner');\n\n//     const lineHorizontal = inner.querySelector('.a9s-pointcross-h');\n//     lineHorizontal.setAttribute('x1', x - 25);\n//     lineHorizontal.setAttribute('y1', y);\n//     lineHorizontal.setAttribute('x2', x + 25);\n//     lineHorizontal.setAttribute('y2', y);\n//     lineHorizontal.setAttribute('center-x', x);\n//     lineHorizontal.setAttribute('center-y', y);\n//     lineHorizontal.setAttribute('transform-origin', `${x} ${y}`);\n\n//     const lineVertical = inner.querySelector('.a9s-pointcross-v');\n//     lineVertical.setAttribute('x1', x);\n//     lineVertical.setAttribute('y1', y - 25);\n//     lineVertical.setAttribute('x2', x);\n//     lineVertical.setAttribute('y2', y + 25);\n//     lineVertical.setAttribute('center-x', x);\n//     lineVertical.setAttribute('center-y', y);\n//     lineVertical.setAttribute('transform-origin', `${x} ${y}`);\n\n//     const outer = handle.querySelector('.a9s-outer');\n\n//     const lineHorizontalOut = outer.querySelector('.a9s-pointcross-h');\n//     lineHorizontalOut.setAttribute('x1', x - 25);\n//     lineHorizontalOut.setAttribute('y1', y);\n//     lineHorizontalOut.setAttribute('x2', x + 25);\n//     lineHorizontalOut.setAttribute('y2', y);\n//     lineHorizontalOut.setAttribute('center-x', x);\n//     lineHorizontalOut.setAttribute('center-y', y);\n//     lineHorizontalOut.setAttribute('transform-origin', `${x} ${y}`);\n\n//     const lineVerticalOut = outer.querySelector('.a9s-pointcross-v');\n//     lineVerticalOut.setAttribute('x1', x);\n//     lineVerticalOut.setAttribute('y1', y - 25);\n//     lineVerticalOut.setAttribute('x2', x);\n//     lineVerticalOut.setAttribute('y2', y + 25);\n//     lineVerticalOut.setAttribute('center-x', x);\n//     lineVerticalOut.setAttribute('center-y', y);\n//     lineVerticalOut.setAttribute('transform-origin', `${x} ${y}`);\n//   }\n\n//   constructor(annotation, g, config, env) {\n//     // super(annotation, g, config, env);\n\n//     // console.log(annotation)\n\n//     // console.log('hey')\n//     // this.svg.addEventListener('mousemove', this.onMouseMove);\n//     // this.svg.addEventListener('mouseup', this.onMouseUp);\n\n//     // const { x, y } = parseRectFragment(annotation, env.image);\n\n//     // console.log('hey2')\n//     // this.container = document.createElementNS(SVG_NAMESPACE, 'g');\n\n//     // console.log('hey3')\n//     // this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n//     // this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n\n//     // console.log('hey4')\n//     // this.pointcross = this.drawPointcross(x, y);\n//     // this.pointcross.addEventListener('mousedown', this.onGrab);\n\n//     // console.log('hey5')\n//     // this.elementGroup.appendChild(this.pointcross);\n\n//     // console.log('hey6')\n//     // this.container.appendChild(this.elementGroup);\n//     // g.appendChild(this.container);\n\n//     // console.log('hey7')\n//     // // true if te mouse has grabbed the point\n//     // this.isGrabbed = false;\n\n//     super(annotation, g, config, env);\n\n//     console.log(annotation)\n\n//     console.log('hey')\n//     this.svg.addEventListener('mousemove', this.onMouseMove);\n//     this.svg.addEventListener('mouseup', this.onMouseUp);\n\n//     // this.container = document.createElementNS(SVG_NAMESPACE, 'g');\n\n//     this.shape = drawEmbeddedSVG(annotation);\n//     this.shape.querySelector('.a9s-inner')\n//       .addEventListener('mousedown', this.onGrab(this.shape));\n\n//     // this.innerShapes = this.shape.querySelectorAll('.a9s-inner');\n//     //   for (let i = 0; i < this.innerShapes.length; i++) {\n//     //     this.innerShapes[i].addEventListener('mousedown', this.onGrab(this.shape));\n//     // }\n\n//       this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n//       this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n//       this.elementGroup.setAttribute('data-id', annotation.id);\n//       this.elementGroup.appendChild(this.shape);\n\n//       // this.container.appendChild(this.elementGroup);\n//       g.appendChild(this.elementGroup);\n\n//       format(this.shape, annotation, config.formatters);\n\n//       this.isGrabbed = false;\n//   }\n\n//   // onScaleChanged = () =>\n//   //   this.scaleHandle(this.pointcross);\n\n//   get element() {\n//     return this.elementGroup;\n//   }\n\n//   onGrab = () => {\n//     this.isGrabbed = true;\n//   }\n\n//   onMouseMove = evt => {\n//     if (evt.button !== 0) return;  // left click\n\n//     if (this.isGrabbed) {\n//       const {x, y} = this.getSVGPoint(evt);\n\n//       // this.setPointcrossXY(this.pointcross, x, y);\n//       this.setPointcrossXY(this.shape, x, y);\n\n//       // const target = toFragment(x, y, this.env.image, this.config.fragmentUnit);\n\n//       this.emit('update', toSVGTarget(this.shape, this.env.image));\n//       // this.emit('update', target);\n//     }\n//   }\n\n//   onMouseUp = () => {\n//     this.isGrabbed = false;\n//   }\n\n//   updateState = annotation => {\n//     // const { x, y } = parseRectFragment(annotation, this.env.image);\n//     // this.setPointcrossXY(this.pointcross, x, y);\n//   }\n\n//   destroy() {\n//     this.svg.removeEventListener('mousemove', this.onMouseMove);\n//     this.svg.removeEventListener('mouseup', this.onMouseUp);\n\n//     this.elementGroup.parentNode.removeChild(this.elementGroup);\n//     super.destroy();\n//   }\n\n// }\n\nconst getPoint = (shape) => {\n  // console.log('8');\n  const svgPath = shape.getAttribute('d');\n\n  const regex = /M(\\S+),(\\S+)/;\n  const match = svgPath.match(regex);\n\n  if (match) {\n    const x = parseFloat(match[1]);\n    const y = parseFloat(match[2]);\n\n    // console.log(`x: ${x}, y: ${y}`)\n\n    return [x, y + 25];\n  }\n\n  // console.log('rip')\n  return [0, 0];\n};\n\nconst getBBox = (shape) => {\n  // console.log('7');\n  return shape.querySelector('.a9s-inner').getBBox();\n};\n\n/**\n * An editable freehand drawing.\n */\nexport default class EditablePointcross extends EditableShape {\n  constructor(annotation, g, config, env) {\n    // console.log('6');\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    //\n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <polygon class=\"a9s-outer\" ... />\n    //     <polygon class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     ...\n    //   </g>\n    // </g>\n\n    // 'g' for the editable free drawing compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.shape = drawEmbeddedSVG(annotation);\n\n    // TODO optional: mask to dim the outside area\n    // this.mask = new Mask(env.image, this.shape.querySelector('.a9s-inner'));\n\n    // this.containerGroup.appendChild(this.mask.element);\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.shape);\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.shape, annotation, config.formatter);\n\n    this.shape\n      .querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    const { x, y, width, height } = getBBox(this.shape);\n\n    // TODO optional: handles to stretch the shape\n    /*    this.handles = [\n      [ x, y ], \n      [ x + width, y ], \n      [ x + width, y + height ], \n      [ x, y + height ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });*/\n\n    // The grabbed element (handle or entire shape), if any\n    this.grabbedElem = null;\n\n    // Mouse grab point\n    this.grabbedAt = null;\n  }\n\n  setPoint = (point) => {\n    // console.log('5');\n    const pointX = parseFloat(point[0]);\n    const pointY = parseFloat(point[1]);\n    const startX = pointX - 25;\n    const endX = pointX + 25;\n    const startY = pointY - 25;\n    const endY = pointY + 25;\n\n    const str =\n      'M' +\n      pointX +\n      ',' +\n      startY +\n      ' ' +\n      'V' +\n      endY +\n      ' ' +\n      'M' +\n      startX +\n      ',' +\n      pointY +\n      ' ' +\n      'H' +\n      endX;\n\n    // // Not using .toFixed(1) because that will ALWAYS\n    // // return one decimal, e.g. \"15.0\" (when we want \"15\")\n    // const round = num => Math.round(10 * num) / 10;\n\n    // var str = points.map(pt => `L${round(pt.x)} ${round(pt.y)}`).join(' ');\n    // str = 'M' + str.substring(1);\n\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('d', str);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('d', str);\n\n    const { x, y, width, height } = outer.getBBox();\n\n    // TODO optional: mask to dim the outside area\n    // this.mask.redraw();\n\n    // TODO optional: handles to stretch the shape\n    /*    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n\n    this.setHandleXY(topleft, x, y);\n    this.setHandleXY(topright, x + width, y);\n    this.setHandleXY(bottomright, x + width, y + height);\n    this.setHandleXY(bottomleft, x, y + height);*/\n\n    setFormatterElSize(this.elementGroup, x, y, width, height);\n  };\n\n  // TODO optional: handles to stretch the shape\n  /*  stretchCorners = (draggedHandleIdx, anchorHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n  }*/\n\n  onGrab = (grabbedElem) => (evt) => {\n    // console.log('grabbed1');\n    this.grabbedElem = grabbedElem;\n    const pos = this.getSVGPoint(evt);\n    this.grabbedAt = { x: pos.x, y: pos.y };\n  };\n\n  onMouseMove = (evt) => {\n    // console.log('4');\n    const constrain = (coord, delta, max) =>\n      coord + delta < 0 ? -coord : coord + delta > max ? max - coord : delta;\n\n    // console.log('11');\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      const { x, y, width, height } = getBBox(this.shape);\n\n      if (this.grabbedElem === this.shape) {\n        // console.log('grabbed');\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const dx = constrain(x, pos.x - this.grabbedAt.x, naturalWidth - width);\n        const dy = constrain(\n          y,\n          pos.y - this.grabbedAt.y,\n          naturalHeight - height,\n        );\n\n        const inner = this.shape.querySelector('.a9s-inner');\n        let updatedPoint = getPoint(inner);\n        updatedPoint[0] = updatedPoint[0] + dx;\n        updatedPoint[1] = updatedPoint[1] + dy;\n\n        this.grabbedAt = pos;\n\n        this.setPoint(updatedPoint);\n        // console.log(updatedPoint)\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }\n      // TODO optional: handles to stretch the shape\n      /* else {\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n\n        this.stretchCorners(handleIdx, oppositeHandle, pos);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }*/\n    }\n  };\n\n  onMouseUp = (evt) => {\n    // console.log('2');\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  };\n\n  get element() {\n    // console.log('1');\n    return this.elementGroup;\n  }\n\n  updateState = (annotation) => {\n    // console.log('uuuuupdated1');\n    const point = getPoint(svgFragmentToShape(annotation));\n\n    // console.log('uuuuupdated');\n    this.setPoint(point);\n  };\n\n  destroy = () => {\n    // console.log('3');\n\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  };\n}\n","import { Selection } from '@recogito/annotorious/src/tools/Tool';\r\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\r\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\r\n\r\n// /**\r\n//  * A 'rubberband' selection tool for creating Line drawing by\r\n//  * clicking and dragging.\r\n//  */\r\n// export default class PointcrossSelection {\r\n// //     drawLineHorizontal = (x, y, size, strokeWidth) => {\r\n// //         const xStart = x - size;\r\n// //         const xEnd = x + size;\r\n\r\n// //         const line = document.createElementNS(SVG_NAMESPACE, 'line');\r\n// //         line.setAttribute('x1', xStart);\r\n// //         line.setAttribute('y1', y);\r\n// //         line.setAttribute('x2', xEnd);\r\n// //         line.setAttribute('y2', y);\r\n// //         line.setAttribute('transform-origin', `${x} ${y}`);\r\n// //         return line;\r\n// //       }\r\n\r\n// //       drawLineVertical = (x, y, size, strokeWidth) => {\r\n// //         const yStart = y - size;\r\n// //         const yEnd = y + size;\r\n\r\n// //         const line = document.createElementNS(SVG_NAMESPACE, 'line');\r\n// //         line.setAttribute('x1', x);\r\n// //         line.setAttribute('y1', yStart);\r\n// //         line.setAttribute('x2', x);\r\n// //         line.setAttribute('y2', yEnd);\r\n// //         line.setAttribute('transform-origin', `${x} ${y}`);\r\n// //         return line;\r\n// //       }\r\n\r\n// //   constructor(x, y, g, env) {\r\n// //     this.env = env;\r\n\r\n// //     this.group = document.createElementNS(SVG_NAMESPACE, 'g');\r\n\r\n// //     this.cross = document.createElementNS(SVG_NAMESPACE, 'g');\r\n// //     this.cross.setAttribute('class', 'a9s-selection');\r\n\r\n// //     const inner = this.drawLineHorizontal(x, y, 50, 4);\r\n// //     inner.setAttribute('class', 'a9s-inner');\r\n\r\n// //     const outer = this.drawLineVertical(x, y, 50, 4);\r\n// //     outer.setAttribute('class', 'a9s-inner');\r\n\r\n// //     this.cross.appendChild(outer);\r\n// //     this.cross.appendChild(inner);\r\n\r\n// //     this.group.appendChild(this.cross);\r\n\r\n// //     g.appendChild(this.group);\r\n// //   }\r\n\r\n//   drawLineHorizontal = (x, y, size, strokeWidth) => {\r\n//     const xStart = x - size;\r\n//     const xEnd = x + size;\r\n\r\n//     const line = document.createElementNS(SVG_NAMESPACE, 'line');\r\n//     line.setAttribute('x1', xStart);\r\n//     line.setAttribute('y1', y);\r\n//     line.setAttribute('x2', xEnd);\r\n//     line.setAttribute('y2', y);\r\n//     line.setAttribute('stroke-width', strokeWidth);\r\n//     line.setAttribute('center-x', x);\r\n//     line.setAttribute('center-y', y);\r\n//     line.setAttribute('transform-origin', `${x} ${y}`);\r\n//     return line;\r\n//   }\r\n\r\n//   drawLineVertical = (x, y, size, strokeWidth) => {\r\n//     const yStart = y - size;\r\n//     const yEnd = y + size;\r\n\r\n//     const line = document.createElementNS(SVG_NAMESPACE, 'line');\r\n//     line.setAttribute('x1', x);\r\n//     line.setAttribute('y1', yStart);\r\n//     line.setAttribute('x2', x);\r\n//     line.setAttribute('y2', yEnd);\r\n//     line.setAttribute('stroke-width', strokeWidth);\r\n//     line.setAttribute('center-x', x);\r\n//     line.setAttribute('center-y', y);\r\n//     line.setAttribute('transform-origin', `${x} ${y}`);\r\n//     return line;\r\n//   }\r\n\r\n// constructor(x, y, g, env) {\r\n// this.env = env;\r\n\r\n// this.group = document.createElementNS(SVG_NAMESPACE, 'g');\r\n// this.group.setAttribute('class', 'a9s-selection');\r\n\r\n// // this.cross = document.createElementNS(SVG_NAMESPACE, 'g');\r\n\r\n// const inner = document.createElementNS(SVG_NAMESPACE, 'g');\r\n// inner.setAttribute('class', 'a9s-inner');\r\n\r\n// const lineHorizontal = this.drawLineHorizontal(x, y, 25, 4);\r\n// lineHorizontal.setAttribute('class', 'a9s-pointcross-h');\r\n\r\n// const lineVertical = this.drawLineVertical(x, y, 25, 4);\r\n// lineVertical.setAttribute('class', 'a9s-pointcross-v');\r\n\r\n// inner.appendChild(lineHorizontal);\r\n// inner.appendChild(lineVertical);\r\n\r\n// // const outer = this.drawLineVertical(x, y, 50, 4);\r\n// const outer = document.createElementNS(SVG_NAMESPACE, 'g');\r\n// outer.setAttribute('class', 'a9s-outer');\r\n\r\n// outer.appendChild(lineHorizontal);\r\n// outer.appendChild(lineVertical);\r\n\r\n// this.group.appendChild(inner);\r\n// this.group.appendChild(outer);\r\n\r\n// // this.group.appendChild(this.cross);\r\n\r\n// g.appendChild(this.group);\r\n// }\r\n\r\n//   get element() {\r\n//     return this.group;\r\n//   }\r\n\r\n//   destroy = () => {\r\n//     this.group.parentNode.removeChild(this.group);\r\n//     // this.cross = null;\r\n//     this.group = null;\r\n//   }\r\n\r\n//   toSelection = () =>\r\n//     new Selection({\r\n//       ...toSVGTarget(this.group, this.env.image),\r\n//       renderedVia: {\r\n//         name: 'pointcross'\r\n//       }\r\n//     });\r\n\r\n// }\r\n\r\n// TODO optional: mask to dim the outside area\r\n//import Mask from './FreehandMask';\r\n\r\n/**\r\n * A 'rubberband' selection tool for creating freehand drawing by\r\n * clicking and dragging.\r\n */\r\nexport default class PointcrossSelection {\r\n  constructor(anchor, g, env) {\r\n    this.point = anchor;\r\n\r\n    this.env = env;\r\n\r\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\r\n\r\n    this.pointcross = document.createElementNS(SVG_NAMESPACE, 'g');\r\n    this.pointcross.setAttribute('class', 'a9s-selection');\r\n\r\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'path');\r\n    this.outer.setAttribute('class', 'a9s-outer');\r\n\r\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'path');\r\n    this.inner.setAttribute('class', 'a9s-inner');\r\n\r\n    this.setPoint(this.point);\r\n\r\n    // TODO optional: mask to dim the outside area\r\n    // this.mask = new Mask(env.image, this.inner);\r\n\r\n    this.pointcross.appendChild(this.outer);\r\n    this.pointcross.appendChild(this.inner);\r\n\r\n    // Additionally, selection remains hidden until\r\n    // the user actually moves the mouse\r\n    // this.group.style.display = 'none';\r\n\r\n    // TODO optional: mask to dim the outside area\r\n    // this.group.appendChild(this.mask.element);\r\n    this.group.appendChild(this.pointcross);\r\n\r\n    g.appendChild(this.group);\r\n\r\n    // console.log('hey')\r\n  }\r\n\r\n  setPoint = (point) => {\r\n    this.group.style.display = null;\r\n    const x = parseFloat(point[0]);\r\n    const y = parseFloat(point[1]);\r\n    const startX = x - 25;\r\n    const endX = x + 25;\r\n    const startY = y - 25;\r\n    const endY = y + 25;\r\n\r\n    const str =\r\n      'M' +\r\n      x +\r\n      ',' +\r\n      startY +\r\n      ' ' +\r\n      'V' +\r\n      endY +\r\n      ' ' +\r\n      'M' +\r\n      startX +\r\n      ',' +\r\n      y +\r\n      ' ' +\r\n      'H' +\r\n      endX;\r\n\r\n    // 'M0,-1 V1 M-1,0 H1'\r\n\r\n    this.outer.setAttribute('d', str);\r\n    this.inner.setAttribute('d', str);\r\n  };\r\n\r\n  getBoundingClientRect = () => this.outer.getBoundingClientRect();\r\n\r\n  dragTo = (xy) => {\r\n    // Make visible\r\n    // console.log(xy)\r\n    // this.group.style.display = null;\r\n\r\n    //TODO optional: edge smoothing\r\n\r\n    this.setPoint(xy);\r\n\r\n    // TODO optional: mask to dim the outside area\r\n    // this.mask.redraw();\r\n  };\r\n\r\n  get element() {\r\n    // console.log('hey2')\r\n    return this.pointcross;\r\n  }\r\n\r\n  destroy = () => {\r\n    // console.log('8');\r\n    this.group.parentNode.removeChild(this.group);\r\n    this.pointcross = null;\r\n    this.group = null;\r\n  };\r\n\r\n  //   toSelection = () => {\r\n  //     // new Selection({\r\n  //     //     ...toSVGTarget(this.group, this.env.image),\r\n  //     //     renderedVia: {\r\n  //     //       name: 'pointcross'\r\n  //     //     }\r\n  //     //   });\r\n\r\n  //     console.log('hey3')\r\n  //     return new Selection(toSVGTarget(this.group, this.env.image));\r\n  //   }\r\n\r\n  toSelection = () =>\r\n    new Selection({\r\n      ...toSVGTarget(this.group, this.env.image),\r\n      renderedVia: {\r\n        name: 'pointcross',\r\n      },\r\n    });\r\n}\r\n","import Tool, { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport EditablePointcross from './EditablePointcross';\nimport { toFragment, isPointcross } from './Pointcross';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport PointcrossSelection from './PointcrossSelection';\n\n// export default class PointcrossTool extends Tool {\n\n//   constructor(g, config, env) {\n//     super(g, config, env);\n//   }\n\n//   drawPointcross = (x, y) => {\n//     const containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n//     containerGroup.setAttribute('class', 'a9s-inner');\n\n//     const group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n//     const drawLineHorizontal = size => {\n//       const xStart = x - size;\n//       const xEnd = x + size;\n\n//       const line = document.createElementNS(SVG_NAMESPACE, 'line');\n//       line.setAttribute('x1', xStart);\n//       line.setAttribute('y1', y);\n//       line.setAttribute('x2', xEnd);\n//       line.setAttribute('y2', y);\n//       line.setAttribute('transform-origin', `${x} ${y}`);\n//       return line;\n//     }\n\n//     const drawLineVertical = size => {\n//       const yStart = y - size;\n//       const yEnd = y + size;\n\n//       const line = document.createElementNS(SVG_NAMESPACE, 'line');\n//       line.setAttribute('x1', x);\n//       line.setAttribute('y1', yStart);\n//       line.setAttribute('x2', x);\n//       line.setAttribute('y2', yEnd);\n//       line.setAttribute('transform-origin', `${x} ${y}`);\n//       return line;\n//     }\n\n//     // const radius = this.config.handleRadius || 6;\n\n//     const inner = drawLineHorizontal(100);\n//     inner.setAttribute('class', 'a9s-handle-inner')\n\n//     const outer = drawLineVertical(100);\n//     outer.setAttribute('class', 'a9s-handle-outer')\n\n//     group.appendChild(outer);\n//     group.appendChild(inner);\n\n//     containerGroup.appendChild(group);\n//     return containerGroup;\n//   }\n\n//   startDrawing = (x, y, _, evt) => {\n//     // The top-most existing annotation at this position (if any)\n//     // const annotation = evt.target.closest('.a9s-annotation')?.annotation;\n\n//     // The point drawing tool will ALWAYS create a point annotation,\n//     // regardless of whether there's already an annotation underneath.\n//     // UNLESS the annotation underneath is itself a point!\n//     // if (!annotation || !isPointcross(annotation)) {\n//       // const element = this.drawPointcross(x, y);\n//       // this.scaleHandle(element);\n\n//       // this.g.appendChild(element);\n\n//       console.log('here')\n//       this.pointcrossSelection = new PointcrossSelection(x, y , this.g, this.env);\n\n//       console.log('here2')\n//       // const shape = this.pointcrossSelection.element;\n//       const shape = this.pointcrossSelection.element;\n//       shape.annotation = this.pointcrossSelection.toSelection();\n//       this.emit('complete', shape);\n\n//       console.log('here3')\n\n//       // element.annotation = new Selection(toFragment(x, y, this.env.image, this.config.fragmentUnit));\n\n//       // this.emit('complete', element);\n//     // } else {\n//       // this.emit('cancel')\n//     // }\n//   }\n\n//   stop = () => {\n//     // Nothing to do\n//   }\n\n//   get isDrawing() {\n//     // Point selection is an instant action - the\n//     // tool is never an 'drawing' state\n//     return false;\n//   }\n\n//   createEditableShape = annotation =>\n//     new EditablePointcross(annotation, this.g, this.config, this.env);\n\n// }\n\n// PointcrossTool.identifier = 'pointcross';\n\n// PointcrossTool.supports = annotation => {\n//   // Not needed, since the target.renderedVia property will be evaluated first\n//   return false;\n// }\n\n// // PointcrossTool.supports = annotation => {\n// //   const selector = annotation.selector('SvgSelector');\n// //   if (selector)\n// //     return selector.value?.match(/^<svg.*<line/g);\n// // }\n\n/**\n * A rubberband selector for freehand fragments.\n */\nexport default class PointcrossTool extends Tool {\n  constructor(g, config, env) {\n    super(g, config, env);\n  }\n\n  startDrawing = (x, y) => {\n    // this._isDrawing = true;\n\n    // this.attachListeners({\n    //   mouseMove: this.onMouseMove,\n    //   mouseUp: this.onMouseUp,\n    //   dblClick: this.onDblClick\n    // });\n\n    // this.rubberband = new RubberbandFreehand([ x, y ], this.g, this.env);\n\n    // console.log('here')\n    this.pointcrossSelection = new PointcrossSelection(\n      [x, y],\n      this.g,\n      this.env,\n    );\n\n    // console.log('here2')\n    // const shape = this.pointcrossSelection.element;\n    const shape = this.pointcrossSelection.element;\n    shape.annotation = this.pointcrossSelection.toSelection();\n    this.emit('complete', shape);\n\n    // console.log('here3')\n  };\n\n  stop = () => {};\n\n  get isDrawing() {\n    return false;\n  }\n\n  createEditableShape = (annotation) =>\n    new EditablePointcross(annotation, this.g, this.config, this.env);\n}\n\nPointcrossTool.identifier = 'pointcross';\n\nPointcrossTool.supports = (annotation) => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return (\n      selector.value.match(/^<svg.*<path*/g) &&\n      !selector.value.toUpperCase().includes('Z')\n    );\n};\n\n// PointcrossTool.supports = annotation => {\n//   // Not needed, since the target.renderedVia property will be evaluated first\n//   return true;\n// }\n\n// PointcrossTool.supports = annotation => {\n//   const selector = annotation.selector('SvgSelector');\n//   if (selector)\n//     return (selector.value.match(/^<svg.*<path*/g) && !selector.value.toUpperCase().includes('Z'));\n// }\n","import { SVG_NAMESPACE, addClass } from '../util/SVG';\n\n/** \n * Parses a W3C Web Annotation FragmentSelector conforming\n * to the Media Fragments spec. Supports (well-formed) xywh=pixel\n * and xywh=percent fragments. \n */\nexport const parseRectFragment = (annotation, image) => {\n  const selector = annotation.selector('FragmentSelector');\n\n  if (selector?.conformsTo.startsWith('http://www.w3.org/TR/media-frags')) {\n    const { value } = selector;\n  \n    const format = value.includes(':') ? value.substring(value.indexOf('=') + 1, value.indexOf(':')) : 'pixel';\n    const coords = value.includes(':') ? value.substring(value.indexOf(':') + 1) : value.substring(value.indexOf('=') + 1);\n\n    let [ x, y, w, h ] = coords.split(',').map(parseFloat);\n\n    if (format.toLowerCase() === 'percent') {\n      x = x * image.naturalWidth  / 100;\n      y = y * image.naturalHeight / 100;\n      w = w * image.naturalWidth  / 100;\n      h = h * image.naturalHeight / 100;\n    }\n\n    return { x, y, w, h };\n  }\n}\n\n/** \n * Serializes a (x, y, w, h)-tuple as Media Fragment selector\n * using pixel coordinates.\n */\nconst toPixelRectFragment = (x, y, w, h, image) => ({\n  source: image?.src,\n  selector: {\n    type: \"FragmentSelector\",\n    conformsTo: \"http://www.w3.org/TR/media-frags/\",\n    value: `xywh=pixel:${x},${y},${w},${h}`\n  }\n});\n\n/** \n * Serializes a (x, y, w, h)-tuple as Media Fragment selector \n * using percent coordinates.\n */\nconst toPercentRectFragment = (x, y, w, h, image) => {\n  const px = x / image.naturalWidth  * 100;\n  const py = y / image.naturalHeight * 100;\n  const pw = w / image.naturalWidth  * 100;\n  const ph = h / image.naturalHeight * 100;\n\n  return {\n    source: image.src,\n    selector: {\n      type: \"FragmentSelector\",\n      conformsTo: \"http://www.w3.org/TR/media-frags/\",\n      value: `xywh=percent:${px},${py},${pw},${ph}`\n    }\n  }\n}\n\nexport const toRectFragment = (x, y, w, h, image, fragmentUnit) =>\n  fragmentUnit?.toLowerCase() === 'percent' ?\n    toPercentRectFragment(x, y, w, h, image) :\n    toPixelRectFragment(x, y, w, h, image);\n\n/** Shorthand to apply the given (x, y, w, h) to the SVG shape **/\nconst setXYWH = (shape, x, y, w, h) => {\n  shape.setAttribute('x', x);\n  shape.setAttribute('y', y);\n  shape.setAttribute('width', w);\n  shape.setAttribute('height', h);\n}\n\n\nconst setPointXY = (shape, x, y) => {\n  shape.setAttribute('cx', x);\n  shape.setAttribute('cy', y);\n  shape.setAttribute('r', 7); // TODO make configurable\n}\n\nexport const drawRectMask = (imageDimensions, x, y, w, h) => {\n  const mask = document.createElementNS(SVG_NAMESPACE, 'path');\n  mask.setAttribute('fill-rule', 'evenodd');\n\n  const { naturalWidth, naturalHeight } = imageDimensions;\n  mask.setAttribute('d', `M0 0 h${naturalWidth} v${naturalHeight} h-${naturalWidth} z M${x} ${y} h${w} v${h} h-${w} z`);\n\n  return mask;\n}\n\nexport const setRectMaskSize = (mask, imageDimensions, x, y, w, h) => {\n  const { naturalWidth, naturalHeight } = imageDimensions;\n  mask.setAttribute('d', `M0 0 h${naturalWidth} v${naturalHeight} h-${naturalWidth} z M${x} ${y} h${w} v${h} h-${w} z`);\n}\n\n/** \n * Draws an SVG rectangle, either from an annotation, or an\n * (x, y, w, h)-tuple.\n */\nexport const drawRect = (arg1, arg2, arg3, arg4) => {\n  const { x, y, w, h } = arg1.type === 'Annotation' || arg1.type === 'Selection' ?\n    parseRectFragment(arg1, arg2) : { x: arg1, y: arg2, w: arg3, h: arg4 };\n\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n\n  if (w === 0 && h === 0) {\n    // Edge case: rect is actually a point\n    addClass(g, 'a9s-point');\n    addClass(g, 'a9s-non-scaling');\n    g.setAttribute('transform-origin', `${x} ${y}`);\n\n    const outerPoint  = document.createElementNS(SVG_NAMESPACE, 'circle');\n    const innerPoint  = document.createElementNS(SVG_NAMESPACE, 'circle');\n\n    innerPoint.setAttribute('class', 'a9s-inner');\n    setPointXY(innerPoint, x, y);\n\n    outerPoint.setAttribute('class', 'a9s-outer');\n    setPointXY(outerPoint, x, y);\n\n    g.appendChild(outerPoint);\n    g.appendChild(innerPoint);  \n  } else {\n    const outerRect = document.createElementNS(SVG_NAMESPACE, 'rect');\n    const innerRect = document.createElementNS(SVG_NAMESPACE, 'rect');\n\n    innerRect.setAttribute('class', 'a9s-inner');\n    setXYWH(innerRect, x, y, w, h);\n\n    outerRect.setAttribute('class', 'a9s-outer');\n    setXYWH(outerRect, x, y, w, h);\n\n    g.appendChild(outerRect);\n    g.appendChild(innerRect);\n  }\n\n  return g;\n}\n\n/** Gets the (x, y, w, h)-values from the attributes of the SVG group **/\nexport const getRectSize = g => {\n  const outer = g.querySelector('.a9s-outer');\n\n  if (outer.nodeName === 'rect') {\n    const x = parseFloat(outer.getAttribute('x'));\n    const y = parseFloat(outer.getAttribute('y'));\n    const w = parseFloat(outer.getAttribute('width'));\n    const h = parseFloat(outer.getAttribute('height'));\n\n    return { x, y, w, h };\n  } else {\n    const x = parseFloat(outer.getAttribute('cx'));\n    const y = parseFloat(outer.getAttribute('cy'));\n\n    return { x, y, w: 0, h: 0 };\n  }\n}\n\n/** Applies the (x, y, w, h)-values to the rects in the SVG group **/\nexport const setRectSize = (g, x, y, w, h) => {\n  const inner = g.querySelector('.a9s-inner');\n  const outer = g.querySelector('.a9s-outer');\n\n  if (outer.nodeName === 'rect') {\n    setXYWH(inner, x, y, w, h);\n    setXYWH(outer, x, y, w, h);  \n  } else {\n    setPointXY(inner, x, y);\n    setPointXY(outer, x, y);\n  }\n}\n\n/** \n * Shorthand to get the area (rectangle w x h) from the \n * annotation's fragment selector. \n */\nexport const rectArea = (annotation, image) => {\n  const { w, h } = parseRectFragment(annotation, image);\n  return w * h;\n}\n\n","import { toRectFragment } from '@recogito/annotorious/src/selectors/RectFragment';\n\nexport const isPoint = annotation =>\n  annotation.target.renderedVia?.name === 'point';\n\nexport const toFragment = (x, y, image, fragmentUnit) => ({\n  ...toRectFragment(x, y, 0, 0, image, fragmentUnit),\n  renderedVia: {\n    name: 'point'\n  }\n});","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { parseRectFragment } from '@recogito/annotorious/src/selectors/RectFragment';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { toFragment } from './Point';\n\nexport default class EditablePoint extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    const { x, y } = parseRectFragment(annotation, env.image);\n\n    this.container = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n\n    this.point = this.drawHandle(x, y);\n    this.point.addEventListener('mousedown', this.onGrab);\n    \n    this.elementGroup.appendChild(this.point);\n\n    this.container.appendChild(this.elementGroup);\n    g.appendChild(this.container);\n\n    // true if te mouse has grabbed the point\n    this.isGrabbed = false;\n  }\n\n  onScaleChanged = () => \n    this.scaleHandle(this.point);\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  onGrab = () => {\n    this.isGrabbed = true;\n  }\n\n  onMouseMove = evt => {\n    if (evt.button !== 0) return;  // left click\n\n    if (this.isGrabbed) {\n      const {x, y} = this.getSVGPoint(evt);\n\n      this.setHandleXY(this.point, x, y);\n\n      const target = toFragment(x, y, this.env.image, this.config.fragmentUnit);\n      this.emit('update', target);\n    }\n  }\n\n  onMouseUp = () => {\n    this.isGrabbed = false;\n  }\n\n  updateState = annotation => {\n    const { x, y } = parseRectFragment(annotation, this.env.image);\n    this.setHandleXY(this.point, x, y);\n  }\n\n  destroy() {\n    this.svg.removeEventListener('mousemove', this.onMouseMove);\n    this.svg.removeEventListener('mouseup', this.onMouseUp);\n\n    this.container.parentNode.removeChild(this.container);\n    super.destroy();\n  }\n\n}","import Tool, { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport EditablePoint from './EditablePoint';\nimport { toFragment, isPoint } from './Point';\n\nexport default class PointTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n  }\n\n  startDrawing = (x, y, _, evt) => {\n    // The top-most existing annotation at this position (if any) \n    const annotation = evt.target.closest('.a9s-annotation')?.annotation;\n\n    // The point drawing tool will ALWAYS create a point annotation,\n    // regardless of whether there's already an annotation underneath.\n    // UNLESS the annotation underneath is itself a point!\n    if (!annotation || !isPoint(annotation)) {\n      const element = this.drawHandle(x, y);\n      this.scaleHandle(element);\n\n      this.g.appendChild(element);\n\n      element.annotation = new Selection(toFragment(x, y, this.env.image, this.config.fragmentUnit));\n\n      this.emit('complete', element);\n    } else {\n      this.emit('cancel')\n    }\n  }\n\n  stop = () => {\n    // Nothing to do\n  }\n\n  get isDrawing() {\n    // Point selection is an instant action - the\n    // tool is never an 'drawing' state\n    return false;\n  }\n  \n  createEditableShape = annotation =>\n    new EditablePoint(annotation, this.g, this.config, this.env);\n\n}\n\nPointTool.identifier = 'point';\n\nPointTool.supports = annotation => {\n  // Not needed, since the target.renderedVia property will be evaluated first\n  return false;\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n\n/** Shorthand to apply the given (x, y, r) to the SVG shape **/\nconst setXYR = (shape, x, y, r) => {  \n  shape.setAttribute('cx', x);\n  shape.setAttribute('cy', y);\n  shape.setAttribute('r', r);\n}\n\n/** \n * Draws an SVG circle, either from an annotation, or an\n * (cx, cy, r)-tuple.\n */\nexport const drawCircle = (cx, cy, r) => {\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n  const outerCircle  = document.createElementNS(SVG_NAMESPACE, 'circle');\n  const innerCircle  = document.createElementNS(SVG_NAMESPACE, 'circle');\n\n  innerCircle.setAttribute('class', 'a9s-inner');\n  setXYR(innerCircle, cx, cy, r);\n\n  outerCircle.setAttribute('class', 'a9s-outer');\n  setXYR(outerCircle, cx, cy, r);\n\n  g.appendChild(outerCircle);\n  g.appendChild(innerCircle);\n\n  return g;\n}\n\nexport const setCircleSize = (g, cx, cy, r) => {\n  const innerCircle = g.querySelector('.a9s-inner');\n  const outerCircle = g.querySelector('.a9s-outer');\n  \n  setXYR(innerCircle, cx, cy, r);\n  setXYR(outerCircle, cx, cy, r);\n}\n\nexport const getCircleSize = g => {\n  const outerCircle = g.querySelector('.a9s-outer');\n\n  const cx = parseFloat(outerCircle.getAttribute('cx'));\n  const cy = parseFloat(outerCircle.getAttribute('cy'));\n  const r = parseFloat(outerCircle.getAttribute('r'));\n  \n  return { cx, cy, r };\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { getCircleSize } from './Circle';\n\nexport default class CircleMask {\n\n  constructor(imageDimensions, circle) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.circle = circle;\n\n    const { cx, cy, r } = getCircleSize(this.circle);\n    const tx = ((cx + r) > this.w) ? this.w - r : cx;\n    const ty = ((cy + r) > this.h) ? this.h - r : cy + r;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');    \n    this.mask.setAttribute('class', 'a9s-selection-mask');\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${tx} ${ty} a ${r} ${r} 0 1 1 1 0`);\n  }\n\n  redraw = () => {\n    const { cx, cy, r } = getCircleSize(this.circle);\n\n    const tx = ((cx + r) > this.w) ? this.w - r : cx;\n    const ty = ((cy + r) > this.h) ? this.h - r : cy + r;\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${tx} ${ty} a ${r} ${r} 0 1 1 1 0`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { drawCircle, setCircleSize } from './Circle';\nimport Mask from './CircleMask';\n\n/**\n * A 'rubberband' selection tool for creating a circle by\n * clicking and dragging.\n */\nexport default class RubberbandCircle {\n\n  constructor(anchorX, anchorY, g, env) {\n    this.anchor = [ anchorX, anchorY ];\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.circle = drawCircle(anchorX, anchorY, 2);\n    this.circle.setAttribute('class', 'a9s-selection');\n\n    this.mask = new Mask(env.image, this.circle);\n\n    // We make the selection transparent to \n    // pointer events because it would interfere with the \n    // rendered annotations' mouseleave/enter events\n    this.group.style.pointerEvents = 'none';\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.circle);\n\n    g.appendChild(this.group);\n  }\n\n  get element() {\n    return this.circle;\n  }\n\n  dragTo = (oppositeX, oppositeY) => {\n    const { naturalWidth, naturalHeight } = this.env.image;\n\n    // Make visible\n    this.group.style.display = null;\n\n    const w = oppositeX - this.anchor[0];\n    const h = oppositeY - this.anchor[1];\n    const r = Math.max(1, Math.pow(w ** 2 + h ** 2, 0.5) / 2);\n\n    const cx = this.anchor[0] + w / 2;\n    const cy = this.anchor[1] + h / 2;\n\n    if ((cx-r < 0 || cx + r > naturalWidth) || (cy-r < 0 || cy + r > naturalHeight)) return;\n    \n    setCircleSize(this.circle, cx, cy, r);\n    this.mask.redraw();\n  }\n\n  getBoundingClientRect = () => \n    this.circle.getBoundingClientRect();\n\n  toSelection = () => {\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n\n    this.mask = null;\n    this.circle = null;\n    this.group = null;\n  }\n\n}","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { drawEmbeddedSVG, svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\nimport { getCircleSize, setCircleSize } from './Circle';\nimport Mask from './CircleMask';\n\n/**\n * An editable circle shape.\n */\nexport default class EditableCircle extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    // \n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <circle class=\"a9s-outer\" ... />\n    //     <circle class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //   </g> \n    // </g>\n\n    // 'g' for the editable circle compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.circle = drawEmbeddedSVG(annotation);\n    this.circle.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.circle));\n\n    this.mask = new Mask(env.image, this.circle);\n\n    this.containerGroup.appendChild(this.mask.element);\n\n    // The 'element' = circle + handles\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.circle);    \n\n    const { cx, cy, r } = getCircleSize(this.circle);\n\n    this.handles = [\n      [ cx, cy - r ],\n      [ cx + r, cy ],\n      [ cx, cy + r ],\n      [ cx - r, cy ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.circle, annotation, config.formatter);\n\n    // The grabbed element (handle or entire group), if any\n    this.grabbedElem = null; \n\n    // Mouse xy offset inside the shape, if mouse pressed\n    this.grabbedAt = null;\n  }\n\n  setSize = (cx, cy, r) => {\n    setCircleSize(this.circle, cx, cy, r);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, r, r);\n\n    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n    this.setHandleXY(topleft, cx, cy - r);\n    this.setHandleXY(topright, cx + r, cy);\n    this.setHandleXY(bottomright, cx, cy + r);\n    this.setHandleXY(bottomleft, cx - r, cy);\n  }\n\n  stretchCorners = (draggedHandleIdx, anchorHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n\n    var mouseX = mousePos.x;\n    var mouseY = mousePos.y;\n    var width = 0;\n    var height = 0;\n    var r;\n    if (draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      mouseX = anchor.x;\n      height = mouseY - anchor.y;\n      r = Math.abs(height) / 2;\n    } else {\n      mouseY = anchor.y;\n      width = mouseX - anchor.x;\n      r = Math.abs(width) / 2;\n    }\n\n    const x = width > 0 ? anchor.x : mouseX;\n    const y = height > 0 ? anchor.y : mouseY;\n    const w = Math.abs(width);\n    const h = Math.abs(height);\n    const cx = x + w/2;\n    const cy = y + h/2;\n\n    setCircleSize(this.circle, cx, cy, r);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, r, r);\n\n    if (draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      var idx0 = 0;\n      var idx2 = 2;\n      if(draggedHandleIdx == 0 && height > 0 || draggedHandleIdx == 2 && height < 0) {\n        idx0 = 2;\n        idx2 = 0;\n      }\n      this.setHandleXY(this.handles[idx0], cx, cy - r);\n      this.setHandleXY(this.handles[idx2], cx, cy + r);\n      this.setHandleXY(this.handles[1], cx + r, cy);\n      this.setHandleXY(this.handles[3], cx - r, cy);\n    } else {\n      var idx3 = 3;\n      var idx1 = 1;\n      if (draggedHandleIdx == 1 && width > 0 || draggedHandleIdx == 3 && width < 0) {\n        idx3 = 1;\n        idx1 = 3;\n      }\n      this.setHandleXY(this.handles[idx3], cx + r, cy);\n      this.setHandleXY(this.handles[idx1], cx - r, cy);\n      this.setHandleXY(this.handles[0], cx, cy - r);\n      this.setHandleXY(this.handles[2], cx, cy + r);\n    }\n  }\n\n  onGrab = grabbedElem => evt => {\n    this.grabbedElem = grabbedElem; \n    \n    const pos = this.getSVGPoint(evt);\n    const { cx, cy } = getCircleSize(this.circle);\n    \n    this.grabbedAt = { x: pos.x - cx, y: pos.y - cy };\n  }\n\n  onMouseMove = evt => {\n    const constrain = (coord, max) =>\n      coord < 0 ? 0 : ( coord > max ? max : coord);\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      if (this.grabbedElem === this.circle) {\n        const { r } = getCircleSize(this.circle);\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const cx = Math.max(constrain(pos.x - this.grabbedAt.x, naturalWidth - r), r);\n        const cy = Math.max(constrain(pos.y - this.grabbedAt.y, naturalHeight - r), r);\n\n        this.setSize(cx, cy, r); \n        this.emit('update', toSVGTarget(this.circle, this.env.image)); \n      } else {\n        // Mouse position replaces one of the corner coords, depending\n        // on which handle is the grabbed element\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n\n        this.stretchCorners(handleIdx, oppositeHandle, pos);\n        this.emit('update', toSVGTarget(this.circle, this.env.image));\n      }\n    }\n  }\n\n  onMouseUp = () => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = scale =>\n    this.handles.map(this.scaleHandle);\n\n  get element() { \n    return this.elementGroup; \n  }\n\n  updateState = annotation => {\n    const shape = svgFragmentToShape(annotation);\n\n    const cx = parseFloat(shape.getAttribute('cx'));\n    const cy = parseFloat(shape.getAttribute('cy'));\n    const r =  parseFloat(shape.getAttribute('r'));\n\n    this.setSize(cx, cy, r);\n  }\n\n  destroy() {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandCircle from './RubberbandCircle';\nimport EditableCircle from './EditableCircle';\n\n/**\n * A rubberband selector for circle selections.\n */\nexport default class RubberbandCircleTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this.rubberband = null;\n  }\n\n  startDrawing = (x, y) => {\n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp\n    });\n\n    this.rubberband = new RubberbandCircle(x, y, this.g, this.env);\n  }\n\n  stop = () => {\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo(x, y);\n  \n  onMouseUp = () => {\n    this.detachListeners();\n    this.started = false;\n\n    const { width, height } = this.rubberband.getBoundingClientRect();\n\n    const minWidth = this.config.minSelectionWidth || 4;\n    const minHeight = this.config.minSelectionHeight || 4;\n\n    if (width >= minWidth && height >= minHeight) {\n      // Emit the SVG shape with selection attached    \n      const { element } = this.rubberband;\n      element.annotation = this.rubberband.toSelection();\n\n      // Emit the completed shape...\n      this.emit('complete', element);\n    } else {\n      this.emit('cancel');\n    }\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this.rubberband != null;\n  }\n  \n  createEditableShape = annotation =>\n    new EditableCircle(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandCircleTool.identifier = 'circle';\n\nRubberbandCircleTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<circle/g);\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n\n/** Shorthand to apply the given (x, y, rx, ry) to the SVG shape **/\nconst setXYR = (shape, x, y, rx, ry) => {  \n  shape.setAttribute('cx', x);\n  shape.setAttribute('cy', y);\n  shape.setAttribute('rx', rx);\n  shape.setAttribute('ry', ry);\n}\n\n/** \n * Draws an SVG ellipse, either from an annotation, or an\n * (cx, cy, rx, ry)-tuple.\n */\nexport const drawEllipse = (cx, cy, rx, ry) => {\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n  const innerEllipse  = document.createElementNS(SVG_NAMESPACE, 'ellipse');\n  const outerEllipse  = document.createElementNS(SVG_NAMESPACE, 'ellipse');\n\n  innerEllipse.setAttribute('class', 'a9s-inner');\n  setXYR(innerEllipse, cx, cy, rx, ry);\n\n  outerEllipse.setAttribute('class', 'a9s-outer');\n  setXYR(outerEllipse, cx, cy, rx, ry);\n\n  g.appendChild(outerEllipse);\n  g.appendChild(innerEllipse);\n\n  return g;\n}\n\nexport const setEllipseSize = (g, cx, cy, rx, ry) => {\n  const innerEllipse = g.querySelector('.a9s-inner');\n  const outerEllipse = g.querySelector('.a9s-outer');\n\n  setXYR(innerEllipse, cx, cy, rx, ry);\n  setXYR(outerEllipse, cx, cy, rx, ry);\n}\n\nexport const getEllipseSize = g => {\n  const outerEllipse = g.querySelector('.a9s-outer');\n\n  const cx = parseFloat(outerEllipse.getAttribute('cx'));\n  const cy = parseFloat(outerEllipse.getAttribute('cy'));\n  const rx = parseFloat(outerEllipse.getAttribute('rx'));\n  const ry = parseFloat(outerEllipse.getAttribute('ry'));\n  \n  return { cx, cy, rx, ry };\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { getEllipseSize } from './Ellipse';\n\nexport default class EllipseMask {\n\n  constructor(imageDimensions, ellipse) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.ellipse = ellipse;\n\n    const { cx, cy, rx, ry } = getEllipseSize(this.ellipse);\n\n    const ty = cy + ry;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');    \n    this.mask.setAttribute('class', 'a9s-selection-mask');\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${cx} ${ty} a ${rx} ${ry} 0 1 1 1 0`);\n  }\n\n  redraw = () => {\n    const { cx, cy, rx, ry } = getEllipseSize(this.ellipse);\n\n    const ty = cy + ry;\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${cx} ${ty} a ${rx} ${ry} 0 1 1 1 0`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { drawEllipse, setEllipseSize } from './Ellipse';\nimport Mask from './EllipseMask';\n\n/**\n * A 'rubberband' selection tool for creating a ellipse by\n * clicking and dragging.\n */\nexport default class RubberbandEllipse {\n\n  constructor(anchorX, anchorY, g, env) {\n    this.anchor = [ anchorX, anchorY ];\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.ellipse = drawEllipse(anchorX, anchorY, 2);\n    this.ellipse.setAttribute('class', 'a9s-selection');\n\n    this.mask = new Mask(env.image, this.ellipse);\n\n    // We make the selection transparent to \n    // pointer events because it would interfere with the \n    // rendered annotations' mouseleave/enter events\n    this.group.style.pointerEvents = 'none';\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.ellipse);\n\n    g.appendChild(this.group);\n  }\n\n  get element() {\n    return this.ellipse;\n  }\n\n  dragTo = (oppositeX, oppositeY) => {\n    // Make visible\n    this.group.style.display = null;\n\n    const w = oppositeX - this.anchor[0];\n    const h = oppositeY - this.anchor[1];\n\n    const cx = w > 0 ? this.anchor[0] + w / 2 : oppositeX + w / 2;\n    const cy = h > 0 ? this.anchor[1] + h / 2 : oppositeY + h / 2;\n\n    const rx = Math.abs(w / 2);\n    const ry = Math.abs(h / 2);\n\n    setEllipseSize(this.ellipse, cx, cy, rx, ry);\n    this.mask.redraw();\n  }\n\n  getBoundingClientRect = () => \n    this.ellipse.getBoundingClientRect();\n\n  toSelection = () => {\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n\n    this.mask = null;\n    this.ellipse = null;\n    this.group = null;\n  }\n\n}","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { drawEmbeddedSVG, svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\nimport { getEllipseSize, setEllipseSize } from './Ellipse';\nimport Mask from './EllipseMask';\n\n/**\n * An editable ellipse shape.\n */\nexport default class EditableEllipse extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    // \n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <ellipse class=\"a9s-outer\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //   </g> \n    // </g>\n\n    // 'g' for the editable ellipse compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.ellipse = drawEmbeddedSVG(annotation);\n    this.ellipse.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.ellipse));\n\n    this.mask = new Mask(env.image, this.ellipse);\n\n    this.containerGroup.appendChild(this.mask.element);\n\n    // The 'element' = ellipse + handles\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.ellipse);    \n\n    const { cx, cy, rx, ry } = getEllipseSize(this.ellipse);\n\n    this.handles = [\n      [ cx, cy - ry ],\n      [ cx + rx, cy ],\n      [ cx, cy + ry ],\n      [ cx - rx, cy ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.ellipse, annotation, config.formatter);\n\n    // The grabbed element (handle or entire group), if any\n    this.grabbedElem = null; \n\n    // Mouse xy offset inside the shape, if mouse pressed\n    this.grabbedAt = null;\n  }\n\n  setSize = (cx, cy, rx, ry) => {\n    setEllipseSize(this.ellipse, cx, cy, rx, ry);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, rx, ry);\n\n    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n    this.setHandleXY(topleft, cx, cy - ry);\n    this.setHandleXY(topright, cx + rx, cy);\n    this.setHandleXY(bottomright, cx, cy + ry);\n    this.setHandleXY(bottomleft, cx - rx, cy);\n  }\n\n  stretchCorners = (draggedHandleIdx, anchorHandle, leftHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n    const anchorLeft = this.getHandleXY(leftHandle);\n\n    var mouseX = mousePos.x;\n    var mouseY = mousePos.y;\n    var rx = 0;\n    var ry = 0;\n    if(draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      mouseX = anchor.x;\n    } else {\n      mouseY = anchor.y;\n    }\n\n    const width = mouseX - anchor.x;\n    const height = mouseY - anchor.y;\n    const x = width > 0 ? anchor.x : mouseX;\n    const y = height > 0 ? anchor.y : mouseY;\n    const w = Math.abs(width);\n    const h = Math.abs(height);\n    const cx = x + w/2;\n    const cy = y + h/2;\n    var rx = w/2;\n    var ry = h/2;\n    if(draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      rx = Math.abs(anchor.x - anchorLeft.x);\n    } else {\n      ry = Math.abs(anchor.y - anchorLeft.y);\n    }\n\n    setEllipseSize(this.ellipse, cx, cy, rx, ry);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, rx, ry);\n\n    if (draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      var idx0 = 0;\n      var idx2 = 2;\n      if(draggedHandleIdx == 0 && height > 0 || draggedHandleIdx == 2 && height < 0) {\n        idx0 = 2;\n        idx2 = 0;\n      }\n      this.setHandleXY(this.handles[idx0], cx, cy - ry);\n      this.setHandleXY(this.handles[idx2], cx, cy + ry);\n      this.setHandleXY(this.handles[1], cx + rx, cy);\n      this.setHandleXY(this.handles[3], cx - rx, cy);\n    } else {\n      var idx3 = 3;\n      var idx1 = 1;\n      if (draggedHandleIdx == 1 && width > 0 || draggedHandleIdx == 3 && width < 0) {\n        idx3 = 1;\n        idx1 = 3;\n      }\n      this.setHandleXY(this.handles[idx3], cx + rx, cy);\n      this.setHandleXY(this.handles[idx1], cx - rx, cy);\n      this.setHandleXY(this.handles[0], cx, cy - ry);\n      this.setHandleXY(this.handles[2], cx, cy + ry);\n    }\n  }\n\n  onGrab = grabbedElem => evt => {\n    this.grabbedElem = grabbedElem; \n\n    const pos = this.getSVGPoint(evt);\n    const { cx, cy } = getEllipseSize(this.ellipse);\n\n    this.grabbedAt = { x: pos.x - cx, y: pos.y - cy };\n  }\n\n  onMouseMove = evt => {\n    const constrain = (coord, max) =>\n      coord < 0 ? 0 : ( coord > max ? max : coord);\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      if (this.grabbedElem === this.ellipse) {\n        const { rx, ry } = getEllipseSize(this.ellipse);\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const cx = constrain(pos.x - this.grabbedAt.x, naturalWidth - rx);\n        const cy = constrain(pos.y - this.grabbedAt.y, naturalHeight - ry);\n\n        this.setSize(cx, cy, rx, ry); \n        this.emit('update', toSVGTarget(this.ellipse, this.env.image));\n      } else {\n        // Mouse position replaces one of the corner coords, depending\n        // on which handle is the grabbed element\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n        const leftHandle = this.handles[(handleIdx + 3) % 4];\n\n        this.stretchCorners(handleIdx, oppositeHandle, leftHandle, pos);\n        this.emit('update', toSVGTarget(this.ellipse, this.env.image));\n      }\n    }\n  }\n\n  onMouseUp = () => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = scale =>\n    this.handles.map(this.scaleHandle);\n\n  get element() { \n    return this.elementGroup; \n  }\n\n  updateState = annotation => {\n    const shape = svgFragmentToShape(annotation);\n\n    const cx = parseFloat(shape.getAttribute('cx'));\n    const cy = parseFloat(shape.getAttribute('cy'));\n    const rx = parseFloat(shape.getAttribute('rx'));\n    const ry = parseFloat(shape.getAttribute('ry'));\n    \n    this.setSize(cx, cy, rx, ry);\n  }\n\n  destroy() {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandEllipse from './RubberbandEllipse';\nimport EditableEllipse from './EditableEllipse';\n\n/**\n * A rubberband selector for ellipse selections.\n */\nexport default class RubberbandEllipseTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this.rubberband = null;\n  }\n\n  startDrawing = (x, y) => {\n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp\n    });\n\n    this.rubberband = new RubberbandEllipse(x, y, this.g, this.env);\n  }\n\n  stop = () => {\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo(x, y);\n  \n  onMouseUp = () => {\n    this.detachListeners();\n    this.started = false;\n\n    const { width, height } = this.rubberband.getBoundingClientRect();\n\n    const minWidth = this.config.minSelectionWidth || 4;\n    const minHeight = this.config.minSelectionHeight || 4;\n\n    if (width >= minWidth && height >= minHeight) {\n      // Emit the SVG shape with selection attached    \n      const { element } = this.rubberband;\n      element.annotation = this.rubberband.toSelection();\n\n      // Emit the completed shape...\n      this.emit('complete', element);\n    } else {\n      this.emit('cancel');\n    }\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this.rubberband != null;\n  }\n  \n  createEditableShape = annotation =>\n    new EditableEllipse(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandEllipseTool.identifier = 'ellipse';\n\nRubberbandEllipseTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<ellipse/g);\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n// TODO optional: mask to dim the outside area\n//import Mask from './FreehandMask';\n\n/**\n * A 'rubberband' selection tool for creating freehand drawing by\n * clicking and dragging.\n */\nexport default class RubberbandFreehand {\n\n  constructor(anchor, g, env) {\n    this.points = [ anchor ];\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.freehand = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.freehand.setAttribute('class', 'a9s-selection');\n\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.outer.setAttribute('class', 'a9s-outer');\n\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.inner.setAttribute('class', 'a9s-inner');\n\n    this.setPoints(this.points);\n\n   // TODO optional: mask to dim the outside area\n   // this.mask = new Mask(env.image, this.inner);\n\n    this.freehand.appendChild(this.outer);\n    this.freehand.appendChild(this.inner);\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n   // TODO optional: mask to dim the outside area\n   // this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.freehand);\n\n    g.appendChild(this.group);\n  }\n\n  setPoints = points => {\n    var str = points.map(pt => `L${pt[0]} ${pt[1]}`).join(' ');\n    str = 'M' + str.substring(1);\n    this.outer.setAttribute('d', str);\n    this.inner.setAttribute('d', str);\n  }\n\n  getBoundingClientRect = () =>\n    this.outer.getBoundingClientRect();\n\n  dragTo = xy => {\n    // Make visible\n    this.group.style.display = null;\n\n    //TODO optional: edge smoothing\n\n    this.addPoint(xy);\n\n   // TODO optional: mask to dim the outside area\n   // this.mask.redraw();\n  }\n\n  addPoint = xy => {\n    this.points = [ ...this.points, xy ];\n    this.setPoints(this.points);   \n   // TODO optional: mask to dim the outside area\n   // this.mask.redraw();\n  }\n\n  get element() {\n    return this.freehand;\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n    this.freehand = null;    \n    this.group = null;\n  }\n\n  toSelection = () => {\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n}\n","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport {\n  drawEmbeddedSVG,\n  svgFragmentToShape,\n  toSVGTarget,\n} from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport {\n  format,\n  setFormatterElSize,\n} from '@recogito/annotorious/src/util/Formatting';\n// TODO optional: mask to dim the outside area\n//import Mask from './FreehandMask';\n\nconst getPoints = (shape) => {\n  const pointList = shape.getAttribute('d').split('L');\n  const points = [];\n  if (pointList.length > 0) {\n    var point = pointList[0].substring(1).trim().split(' ');\n    points.push({ x: parseFloat(point[0]), y: parseFloat(point[1]) });\n\n    for (let i = 1; i < pointList.length; i++) {\n      var point = pointList[i].trim().split(' ');\n      points.push({ x: parseFloat(point[0]), y: parseFloat(point[1]) });\n    }\n  }\n\n  return points;\n};\n\nconst getBBox = (shape) => {\n  return shape.querySelector('.a9s-inner').getBBox();\n};\n\n/**\n * An editable freehand drawing.\n */\nexport default class EditableFreehand extends EditableShape {\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    //\n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <polygon class=\"a9s-outer\" ... />\n    //     <polygon class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     ...\n    //   </g>\n    // </g>\n\n    // 'g' for the editable free drawing compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.shape = drawEmbeddedSVG(annotation);\n\n    // TODO optional: mask to dim the outside area\n    // this.mask = new Mask(env.image, this.shape.querySelector('.a9s-inner'));\n\n    // this.containerGroup.appendChild(this.mask.element);\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.shape);\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.shape, annotation, config.formatter);\n\n    this.shape\n      .querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    const { x, y, width, height } = getBBox(this.shape);\n\n    // TODO optional: handles to stretch the shape\n    /*    this.handles = [\n      [ x, y ], \n      [ x + width, y ], \n      [ x + width, y + height ], \n      [ x, y + height ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });*/\n\n    // The grabbed element (handle or entire shape), if any\n    this.grabbedElem = null;\n\n    // Mouse grab point\n    this.grabbedAt = null;\n  }\n\n  setPoints = (points) => {\n    // Not using .toFixed(1) because that will ALWAYS\n    // return one decimal, e.g. \"15.0\" (when we want \"15\")\n    const round = (num) => Math.round(10 * num) / 10;\n\n    var str = points.map((pt) => `L${round(pt.x)} ${round(pt.y)}`).join(' ');\n    str = 'M' + str.substring(1);\n\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('d', str);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('d', str);\n\n    const { x, y, width, height } = outer.getBBox();\n\n    // TODO optional: mask to dim the outside area\n    // this.mask.redraw();\n\n    // TODO optional: handles to stretch the shape\n    /*    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n\n    this.setHandleXY(topleft, x, y);\n    this.setHandleXY(topright, x + width, y);\n    this.setHandleXY(bottomright, x + width, y + height);\n    this.setHandleXY(bottomleft, x, y + height);*/\n\n    setFormatterElSize(this.elementGroup, x, y, width, height);\n  };\n\n  // TODO optional: handles to stretch the shape\n  /*  stretchCorners = (draggedHandleIdx, anchorHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n  }*/\n\n  onGrab = (grabbedElem) => (evt) => {\n    this.grabbedElem = grabbedElem;\n    const pos = this.getSVGPoint(evt);\n    this.grabbedAt = { x: pos.x, y: pos.y };\n  };\n\n  onMouseMove = (evt) => {\n    const constrain = (coord, delta, max) =>\n      coord + delta < 0 ? -coord : coord + delta > max ? max - coord : delta;\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      const { x, y, width, height } = getBBox(this.shape);\n\n      if (this.grabbedElem === this.shape) {\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const dx = constrain(x, pos.x - this.grabbedAt.x, naturalWidth - width);\n        const dy = constrain(\n          y,\n          pos.y - this.grabbedAt.y,\n          naturalHeight - height,\n        );\n\n        const inner = this.shape.querySelector('.a9s-inner');\n        const updatedPoints = getPoints(inner).map((pt) => ({\n          x: pt.x + dx,\n          y: pt.y + dy,\n        }));\n\n        this.grabbedAt = pos;\n\n        this.setPoints(updatedPoints);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }\n      // TODO optional: handles to stretch the shape\n      /* else {\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n\n        this.stretchCorners(handleIdx, oppositeHandle, pos);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }*/\n    }\n  };\n\n  onMouseUp = (evt) => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  };\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  updateState = (annotation) => {\n    const points = getPoints(svgFragmentToShape(annotation));\n    this.setPoints(points);\n  };\n\n  destroy = () => {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  };\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandFreehand from './RubberbandFreehand';\nimport EditableFreehand from './EditableFreehand';\n\n/**\n * A rubberband selector for freehand fragments.\n */\nexport default class RubberbandFreehandTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this._isDrawing = false;\n  }\n\n  startDrawing = (x, y) => {\n    this._isDrawing = true;\n    \n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp,\n      dblClick: this.onDblClick\n    });\n    \n    this.rubberband = new RubberbandFreehand([ x, y ], this.g, this.env);\n  }\n\n  stop = () => {\n    this.detachListeners();\n    \n    this._isDrawing = false;\n\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo([ x, y ]);\n\n  onMouseUp = (x, y) => {\n    this.onDblClick(x, y);\n  }\n\n  onDblClick = (x, y) => {\n    this._isDrawing = false;\n\n    this.rubberband.addPoint([ x, y ]);\n\n    this.detachListeners();\n\n    const { width, height } = this.rubberband.getBoundingClientRect();\n\n    const minWidth = this.config.minSelectionWidth || 4;\n    const minHeight = this.config.minSelectionHeight || 4;\n\n    if (width >= minWidth || height >= minHeight) {\n\n      const shape = this.rubberband.element;\n      shape.annotation = this.rubberband.toSelection();\n\n      this.emit('complete', shape);\n    } else {\n      this.emit('cancel');\n    }\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  createEditableShape = annotation =>\n    new EditableFreehand(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandFreehandTool.identifier = 'freehand';\n\nRubberbandFreehandTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return (selector.value.match(/^<svg.*<path*/g) && !selector.value.toUpperCase().includes('Z'));\n}","import { SVG_NAMESPACE } from '../../util/SVG';\n\nexport default class PolygonMask {\n\n  constructor(imageDimensions, polygon) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.polygon = polygon;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');    \n    this.mask.setAttribute('class', 'a9s-selection-mask');\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${this.polygon.getAttribute('points')} z`);\n  }\n\n  redraw = () => {\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${this.polygon.getAttribute('points')} z`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport Mask from '@recogito/annotorious/src/tools/polygon/PolygonMask';\n\n// TODO optional: mask to dim the outside area\n//import Mask from './multipolygonMask';\n\n/**\n * A 'rubberband' selection tool for creating multipolygon drawing by\n * clicking and dragging.\n */\nexport default class RubberbandMultipolygon {\n\n  constructor(anchor, g, env) {\n    this.points =  [];\n    this.points.push([ anchor, anchor ])\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.multipolygon = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.multipolygon.setAttribute('class', 'a9s-selection');\n\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.outer.setAttribute('class', 'a9s-outer');\n\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.inner.setAttribute('class', 'a9s-inner');\n\n    this.setPoints(this.points);\n    this.mask = new Mask(env.image, this.inner);\n\n    // TODO optional: mask to dim the outside area\n    // this.mask = new Mask(env.image, this.inner);\n\n    this.multipolygon.appendChild(this.outer);\n    this.multipolygon.appendChild(this.inner);\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    // TODO optional: mask to dim the outside area\n    // this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.multipolygon);\n\n    g.appendChild(this.group);\n  }\n\n  setPoints = points => {\n    var attr =\"\";\n\n    for (var ps of points){\n      var attr2=\"\"\n      if (ps.length>0){\n        for (var p of ps) {\n          if (p){\n            if (attr2===\"\"){\n              attr2  +=`M${p[0]},${p[1]}`;\n            }\n            else{\n              attr2  +=` L${p[0]},${p[1]}`;\n            }\n          }\n        };\n         attr+=attr2\n      }\n    }\n\n    attr+=\" Z\"\n    \n    this.outer.setAttribute('d', attr);\n    this.inner.setAttribute('d', attr);\n  }\n\n  getBoundingClientRect = () =>\n    this.outer.getBoundingClientRect();\n\n  dragTo = xy => {\n    // Make visible\n    this.group.style.display = null;\n    const head = this.points[this.points.length - 1].slice(0, this.points[this.points.length - 1].length - 1);\n    var headRest=this.points.slice(0,-1)\n    const rubberband = [ ...head, xy, head[0] ];\n    headRest.push(rubberband)\n    this.setPoints(headRest);\n    this.mask.redraw();\n  }\n  \n  addPoint = xy => {\n    // Don't add a new point if distance < 2 pixels\n    if (this.points[this.points.length - 1].length>0){\n      const head = this.points[this.points.length - 1].slice(0, this.points[this.points.length - 1].length - 1);\n      const lastCorner = head[head.length - 1];\n      const dist = Math.pow(xy[0] - lastCorner[0], 2) + Math.pow(xy[1] - lastCorner[1], 2);\n      if (dist > 4) {\n        this.points[this.points.length - 1] = [ ...head, xy, head[0] ];\n        this.setPoints(this.points);   \n        this.mask.redraw();\n      } \n    } else{\n      this.points[this.points.length - 1] = [xy,xy];\n      this.setPoints(this.points);\n    }\n  }\n\n  undo = () => {\n    if (this.points[this.points.length - 1].length>2){\n      this.points[this.points.length - 1].pop();\n    } else {\n      if (this.points.length>1){\n        this.points.pop()\n      }\n    }\n  }\n\n  newPart = () => {\n    this.points.push([]);\n  }\n \n  get element() {\n    return this.multipolygon;\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n    this.multipolygon = null;    \n    this.group = null;\n  }\n\n  toSelection = () =>\n    new Selection({\n      ...toSVGTarget(this.group, this.env.image),\n      renderedVia: {\n        name: 'multipolygon'\n      }\n    });\n\n}\n","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\n\n// TODO optional: mask to dim the outside area\n//import Mask from './MultipolygonMask';\n\nconst getPoints = (shape) => {\n  // Could just be Array.from(shape.querySelector('.inner').points) but...\n  // IE11 :-(\n  const pointLists = getPointsFromPathValue(shape.querySelector('.a9s-inner').attributes.d.nodeValue)\n  const pointArray = [];\n  for (let pointList of pointLists) {\n    let points = []\n    for (let point of pointList) {\n      let p = {\n        x:parseFloat(point[0]),\n        y:parseFloat(point[1])\n      }\n      points.push(p);\n    }\n    pointArray.push(points);\n  }\n\n  return pointArray;\n}\nconst getPointsFromPathValue = polygon => {\n  var results =polygon.split('M');\n  var allcoords = []\n  results.forEach(function (result, index) {\n    if (result.length>0){\n      let coords = []\n      result=result.replace(/ Z/g,\"Z\")\n      result=result.replace(/Z /g,\"Z\")\n      result=result.replace(/Z/g,\"\")\n      result=result.replace(/L /g,\"L\")\n      result=result.replace(/ L/g,\"L\")\n      var coordsString = result.split(\"L\")\n      coordsString.forEach(function(coord, index){\n        coords.push([parseFloat(coord.split(\",\")[0]).toFixed(2).toString(),parseFloat(coord.split(\",\")[1]).toFixed(2).toString()]);\n      });\n      if (coords[0] !== coords[coords.length - 1]){\n        coords.push(coords[0])\n      }\n      allcoords.push(coords)\n    }\n  });\n  return allcoords\n}\nconst getBBox = shape => {\n  return shape.querySelector('.a9s-inner').getBBox();\n}\nexport const svgFragmentToPoints = annotation => {\n  const svgShape = svgFragmentToShape(annotation);\n  var polygon = svgShape.getAttribute('d')\n  var allcoords =  getPointsFromPathValue(polygon)\n  return allcoords\n  //svgShape.getAttribute('d')\n  //  .split(' ') // Split x/y tuples\n  //  .map(xy => xy.split(',').map(str => parseFloat(str.trim())));\n}\n\nconst drawEmbeddedSVG = annotation => {\n  const shape = svgFragmentToShape(annotation);\n\n  // Hack\n  svgFragmentToPoints(annotation);\n\n  // Because we're nitpicky, we don't just draw the shape,\n  // but duplicate it, so we can have inner and an outer lines\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n\n  const inner = shape.cloneNode(true);\n  inner.setAttribute('class', 'a9s-inner');\n\n  const outer = shape.cloneNode(true);\n  outer.setAttribute('class', 'a9s-outer');\n\n  g.appendChild(outer);\n  g.appendChild(inner);\n\n  return g;\n}\n/**\n * An editable multipolygon drawing.\n */\nexport default class EditableMultipolygon extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    // \n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <polygon class=\"a9s-outer\" ... />\n    //     <polygon class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     ...\n    //   </g> \n    // </g>\n\n    // 'g' for the editable free drawing compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.shape = drawEmbeddedSVG(annotation);\n   // TODO optional: mask to dim the outside area\n   // this.mask = new Mask(env.image, this.shape.querySelector('.a9s-inner'));\n    \n   // this.containerGroup.appendChild(this.mask.element);\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.shape);\n    let pointList = getPoints(this.shape);\n    this.handles = []\n    for (let points of pointList){\n      this.handles.push(points.map(pt => {\n        const handle = this.drawHandle(pt.x, pt.y);\n        handle.addEventListener('mousedown', this.onGrab(handle));\n        this.elementGroup.appendChild(handle);\n        return handle;\n      }))\n    } \n\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.shape, annotation, config.formatter);\n\n    this.shape.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    const { x, y, width, height } = getBBox(this.shape);\n\n    // TODO optional: handles to stretch the shape\n/*    this.handles = [\n      [ x, y ], \n      [ x + width, y ], \n      [ x + width, y + height ], \n      [ x, y + height ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });*/\n\n    // The grabbed element (handle or entire shape), if any\n    this.grabbedElem = null;\n\n    // Mouse grab point\n    this.grabbedAt = null;\n  }\n\n  setPoints = (points) => {\n    const round = num =>\n    Math.round(10 * num) / 10;\n\n    let str = \"\"\n    for (let pointList of points){\n      str += \"M\"\n      let first = true \n      for (let point of pointList){\n        if (first){\n          first = false\n          str += point.x.toString() + \",\" + point.y.toString()\n        } else {\n          str += \" L\" + round(point.x).toString() + \",\" + round(point.y).toString()\n        }\n      }\n      str += \" Z\"\n    }\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('d', str);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('d', str);\n\n    // this.mask.redraw();\n\n    const { x, y, width, height } = outer.getBBox();\n    setFormatterElSize(this.elementGroup, x, y, width, height);\n  }\n\n\n    // TODO optional: handles to stretch the shape\n/*  stretchCorners = (draggedHandleIdx, anchorHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n  }*/\n\n  onGrab = grabbedElem => evt => {\n    this.grabbedElem = grabbedElem;\n    const pos = this.getSVGPoint(evt);\n    this.grabbedAt = { x: pos.x, y: pos.y };\n  }\n\n  onMouseMove = evt => {\n    if (this.grabbedElem) {\n\n      const pos = this.getSVGPoint(evt);\n\n      if (this.grabbedElem === this.shape) {\n        const dx = pos.x - this.grabbedAt.x;\n        const dy = pos.y - this.grabbedAt.y;\n\n        let pointList = getPoints(this.shape)\n\n        const updatedPoints = []\n        for (let points of pointList){\n          updatedPoints.push(points.map(pt =>\n            ({ x: pt.x + dx, y: pt.y + dy })))\n        } \n    \n        this.grabbedAt = pos;\n\n        this.setPoints(updatedPoints);\n        let i = 0\n        for (let updatedPointsList of updatedPoints){\n            updatedPointsList.forEach((pt, idx) => { \n              if (this.handles[i][idx] !== undefined)\n                this.setHandleXY(this.handles[i][idx], pt.x, pt.y)\n            });\n            i+=1\n        }\n        \n        this.emit('update', {\n          ...toSVGTarget(this.shape, this.env.image),\n          renderedVia: {\n            name: 'multipolygon'\n          }\n        });\n      } else {\n        let handleIdx = -1\n        let pointListIDX = 0\n        let found = false\n\n        for (let handle of this.handles){\n          if (handle.indexOf(this.grabbedElem)>0){\n            handleIdx = handle.indexOf(this.grabbedElem);\n            found=true\n          } else {\n            if (!found){\n              pointListIDX += 1\n            }\n          }\n        }\n  \n        let pointList = getPoints(this.shape)\n  \n        const updatedPoints = []\n        let updatedPointsIDX = 0\n        for (let points of pointList){\n          if (updatedPointsIDX === pointListIDX){\n            let newPoints = []\n            points.forEach(function (value, i) {\n              if (i === handleIdx){\n                newPoints.push(pos)\n              } else {\n                newPoints.push(value)\n              }\n            });\n            updatedPoints.push(newPoints)\n          } else {\n            updatedPoints.push(points)\n          }\n          updatedPointsIDX +=1\n        } \n       \n        this.setPoints(updatedPoints);\n        updatedPointsIDX = 0\n        for (let handle of this.handles){\n          if (updatedPointsIDX === pointListIDX){\n\n            this.setHandleXY(handle[handleIdx], pos.x, pos.y);\n          }\n          updatedPointsIDX +=1\n\n        }\n        \n        this.emit('update', {\n          ...toSVGTarget(this.shape, this.env.image),\n          renderedVia: {\n            name: 'multipolygon'\n          }\n        });\n      }\n    }\n  }\n\n  onMouseUp = evt => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  updateState = annotation => {\n    const points = getPoints(svgFragmentToShape(annotation));\n    this.setPoints(points);\n  }\n\n  destroy = () => {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandMultipolygon from './RubberbandMultipolygon';\nimport EditableMultipolygon from './EditableMultipolygon';\n\n/**\n * A rubberband selector for Multipolygon fragments.\n */\nexport default class RubberbandMultipolygonTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this._isDrawing = false;\n    \n    document.addEventListener('keydown', evt => {\n      if (evt.key == \"z\" && evt.ctrlKey) {\n        this.undo();\n      }\n      \n      if (evt.key == 'n') {\n        this.newPart();\n      }\n    });  \n  }\n\n  startDrawing = (x, y) => {\n    this._isDrawing = true;\n    \n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp,\n      dblClick: this.onDblClick\n    });\n    \n    this.rubberband = new RubberbandMultipolygon([ x, y ], this.g, this.env);\n  }\n\n  stop = () => {\n    this.detachListeners();\n    \n    this._isDrawing = false;\n\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n  undo = () =>{\n    if (this.rubberband){\n      this.rubberband.undo();\n\n    }\n  }\n  newPart = () =>{\n    if (this.rubberband){\n      this.rubberband.newPart();\n\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo([ x, y ]);\n\n  onMouseUp = (x, y, evt) => {\n    if (evt.altKey){\n      this.onDblClick(evt);\n    } else if (evt.ctrlKey) {\n      this.rubberband.undo();\n    } else{\n      const { width, height } = this.rubberband.getBoundingClientRect();\n\n      const minWidth = this.config.minSelectionWidth || 4;\n      const minHeight = this.config.minSelectionHeight || 4;\n      \n      if (width >= minWidth || height >= minHeight) {\n        this.rubberband.addPoint([ x, y ]);\n      } else {\n        this.emit('cancel');\n        this.stop();\n      }\n    }\n  }\n  \n  onDblClick = (x, y) => {\n    this._isDrawing = false;\n\n    this.rubberband.addPoint([ x, y ]);\n\n    const shape = this.rubberband.element;\n    shape.annotation = this.rubberband.toSelection();\n    this.emit('complete', shape);\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  createEditableShape = annotation => \n    new EditableMultipolygon(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandMultipolygonTool.identifier = 'multipolygon';\n\nRubberbandMultipolygonTool.supports = annotation => false;","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n\nexport default class LineMask {\n\n  constructor(imageDimensions, line) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.line = line;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');\n    this.mask.setAttribute('class', 'a9s-selection-mask');\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${this.line.getAttribute('x1')} ${this.line.getAttribute('y1')} z`);\n  }\n\n  redraw = () => {\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${this.line.getAttribute('x1')} ${this.line.getAttribute('y1')} ${this.line.getAttribute('x2')} ${this.line.getAttribute('y2')}z`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport Mask from './LineMask';\n\n\n/**\n * A 'rubberband' selection tool for creating Line drawing by\n * clicking and dragging.\n */\nexport default class RubberbandLine {\n\n  constructor(anchor, g, env) {\n    this.points =  anchor\n    //this.points.push([ anchor, anchor ])\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.Line = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.Line.setAttribute('class', 'a9s-selection');\n\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'line');\n    this.outer.setAttribute('class', 'a9s-outer');\n\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'line');\n    this.inner.setAttribute('class', 'a9s-inner');\n\n    this.setPoints(this.points);\n    this.mask = new Mask(env.image, this.inner);\n\n    // TODO optional: mask to dim the outside area\n    // this.mask = new Mask(env.image, this.inner);\n\n    this.Line.appendChild(this.outer);\n    this.Line.appendChild(this.inner);\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    // TODO optional: mask to dim the outside area\n    // this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.Line);\n\n    g.appendChild(this.group);\n  }\n\n  setPoints = points => {\n    const attr = points;\n    // set attribute for line svg element for outer and inner\n    // example: <line x1=\"0\" y1=\"80\" x2=\"100\" y2=\"20\" stroke=\"black\" />\n    this.outer.setAttribute('x1', attr[0]);\n    this.inner.setAttribute('x1', attr[0]);\n    this.outer.setAttribute('y1', attr[1]);\n    this.inner.setAttribute('y1', attr[1]);\n    if(attr.length > 2) {\n    this.outer.setAttribute('x2', attr[2]);\n    this.inner.setAttribute('x2', attr[2]);\n    this.outer.setAttribute('y2', attr[3]);\n    this.inner.setAttribute('y2', attr[3]);\n    }\n  }\n\n  getBoundingClientRect = () =>\n    this.outer.getBoundingClientRect();\n\n  dragTo = xy => {\n    // Make visible\n    this.group.style.display = null;\n\n    this.mousepos = xy;\n    //console.log(xy);\n    const rubberband = [ ...this.points, xy[0], xy[1] ];\n    \n    this.setPoints(rubberband);\n    this.mask.redraw();\n  }\n  \n  addPoint = xy => {\n    // Don't add a new point if distance < 2 pixels\n    if (this.points.length <= 2) {\n      this.points[2] = xy[0];\n      this.points[3] = xy[1];\n      this.setPoints(this.points);\n    }\n  }\n\n  undo = () => {\n    if (this.points[this.points.length - 1].length>2){\n      this.points[this.points.length - 1].pop();\n    } else {\n      if (this.points.length>1){\n        this.points.pop()\n      }\n    }\n  }\n\n  newPart = () => {\n    this.points.push([]);\n  }\n \n  get element() {\n    return this.Line;\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n    this.Line = null;    \n    this.group = null;\n  }\n\n  toSelection = () =>\n    new Selection({\n      ...toSVGTarget(this.group, this.env.image),\n      renderedVia: {\n        name: 'line'\n      }\n    });\n\n}\n","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport {\n  drawEmbeddedSVG,\n  svgFragmentToShape,\n  toSVGTarget,\n} from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport {\n  format,\n  setFormatterElSize,\n} from '@recogito/annotorious/src/util/Formatting';\nimport Mask from './LineMask';\n\nconst getPoints = (shape) => {\n  // Could just be Array.from(shape.querySelector('.inner').points) but...\n  // IE11 :-(\n  const innerElement = shape.querySelector('.a9s-inner');\n  const points = [\n    [innerElement.x1.baseVal, innerElement.y1.baseVal],\n    [innerElement.x2.baseVal, innerElement.y2.baseVal],\n  ];\n\n  return points;\n};\n\nconst getBBox = (shape) => shape.querySelector('.a9s-inner').getBBox();\n\n/**\n * An editable line shape.\n */\nexport default class EditableLine extends EditableShape {\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    //\n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <line class=\"a9s-outer\" ... />\n    //     <line class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     ...\n    //   </g>\n    // </g>\n\n    // 'g' for the editable line shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.shape = drawEmbeddedSVG(annotation);\n    this.shape\n      .querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    this.mask = new Mask(env.image, this.shape.querySelector('.a9s-inner'));\n\n    this.containerGroup.appendChild(this.mask.element);\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.setAttribute('data-id', annotation.id);\n    this.elementGroup.appendChild(this.shape);\n\n    this.handles = getPoints(this.shape).map((pt) => {\n      const handle = this.drawHandle(pt[0].value, pt[1].value);\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n      return handle;\n    });\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.shape, annotation, config.formatters);\n\n    // The grabbed element (handle or entire shape), if any\n    this.grabbedElem = null;\n\n    // Mouse grab point\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = () => this.handles.map(this.scaleHandle);\n\n  setPoints = (points) => {\n    // Not using .toFixed(1) because that will ALWAYS\n    // return one decimal, e.g. \"15.0\" (when we want \"15\")\n    const round = (num) => Math.round(10 * num) / 10;\n\n    var x1 = points[0].x;\n    var y1 = points[0].y;\n    var x2 = points[1].x;\n    var y2 = points[1].y;\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('x1', x1);\n    inner.setAttribute('y1', y1);\n    inner.setAttribute('x2', x2);\n    inner.setAttribute('y2', y2);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('x1', x1);\n    outer.setAttribute('y1', y1);\n    outer.setAttribute('x2', x2);\n    outer.setAttribute('y2', y2);\n\n    this.mask.redraw();\n\n    const { x, y, width, height } = outer.getBBox();\n    setFormatterElSize(this.elementGroup, x, y, width, height);\n  };\n\n  onGrab = (grabbedElem) => (evt) => {\n    if (evt.button !== 0) return; // left click\n    this.grabbedElem = grabbedElem;\n    this.grabbedAt = this.getSVGPoint(evt);\n  };\n\n  onMouseMove = (evt) => {\n    const constrain = (coord, delta, max) =>\n      coord + delta < 0 ? -coord : coord + delta > max ? max - coord : delta;\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n      if (this.grabbedElem === this.shape) {\n        const { x, y, width, height } = getBBox(this.shape);\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const dx = constrain(x, pos.x - this.grabbedAt.x, naturalWidth - width);\n        const dy = constrain(\n          y,\n          pos.y - this.grabbedAt.y,\n          naturalHeight - height,\n        );\n\n        const updatedPoints = getPoints(this.shape).map((pt) => ({\n          x: pt[0].value + dx,\n          y: pt[1].value + dy,\n        }));\n\n        this.grabbedAt = pos;\n\n        this.setPoints(updatedPoints);\n        updatedPoints.forEach((pt, idx) =>\n          this.setHandleXY(this.handles[idx], pt.x, pt.y),\n        );\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      } else {\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n\n        const updatedPoints = getPoints(this.shape).map((pt, idx) =>\n          idx === handleIdx ? pos : { x: pt[0].value, y: pt[1].value },\n        );\n\n        this.setPoints(updatedPoints);\n        this.setHandleXY(this.handles[handleIdx], pos.x, pos.y);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }\n    }\n  };\n\n  onMouseUp = (evt) => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  };\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  // TODO: update this for line svg Attributes, currently not being used\n  updateState = (annotation) => {\n    const points = svgFragmentToShape(annotation)\n      .getAttribute('points')\n      .split(' ') // Split x/y tuples\n      .map((xy) => {\n        const [x, y] = xy.split(',').map((str) => parseFloat(str.trim()));\n        return { x, y };\n      });\n\n    this.setPoints(points);\n    points.forEach((pt, idx) =>\n      this.setHandleXY(this.handles[idx], pt.x, pt.y),\n    );\n  };\n\n  destroy = () => {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  };\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandLine from './RubberbandLine';\nimport EditableLine from './EditableLine';\n\n/**\n * A rubberband selector for Line fragments.\n */\nexport default class RubberbandLineTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this._isDrawing = false;\n    \n    document.addEventListener('keydown', evt => {\n      if (evt.key == \"z\" && evt.ctrlKey) {\n        this.undo();\n      }\n      \n      if (evt.key == 'n') {\n        this.newPart();\n      }\n    });  \n  }\n\n  startDrawing = (x, y) => {\n    this._isDrawing = true;\n    \n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp,\n    });\n    \n    this.rubberband = new RubberbandLine([ x, y ], this.g, this.env);\n  }\n\n  stop = () => {\n    this.detachListeners();\n    \n    this._isDrawing = false;\n\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n  undo = () =>{\n    if (this.rubberband){\n      this.rubberband.undo();\n\n    }\n  }\n  newPart = () =>{\n    if (this.rubberband){\n      this.rubberband.newPart();\n\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo([ x, y ]);\n\n  onMouseUp = (x, y, evt) => {\n    if (evt.altKey){\n      this.onDblClick(evt);\n    } else if (evt.ctrlKey) {\n      this.rubberband.undo();\n    } else{\n      // TODO: see when this is useful\n      // const { width, height } = this.rubberband.getBoundingClientRect();\n\n      // const minWidth = this.config.minSelectionWidth || 4;\n      // const minHeight = this.config.minSelectionHeight || 4;\n      \n      if (this.rubberband.points.length == 2) {\n        this.rubberband.addPoint([ x, y ]); \n        // check if both coordinates are same\n        if (this.rubberband.points[0] == this.rubberband.points[2] && this.rubberband.points[1] == this.rubberband.points[3]) {\n          this.emit('cancel');\n          this.stop();\n        }\n        else{\n          this._isDrawing = false;\n          const shape = this.rubberband.element;\n          shape.annotation = this.rubberband.toSelection();\n          this.emit('complete', shape);\n          this.stop();\n        }\n      }\n    }\n  }\n  \n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  createEditableShape = annotation => \n    new EditableLine(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandLineTool.identifier = 'line';\n\nRubberbandLineTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<line/g);\n}","import PointcrossTool from './pointcross/PointcrossTool';\nimport PointTool from './point/PointTool';\nimport RubberbandCircleTool from './circle/RubberbandCircleTool';\nimport RubberbandEllipseTool from './ellipse/RubberbandEllipseTool';\nimport RubberbandFreehandTool from './freehand/RubberbandFreehandTool';\nimport RubberbandMultipolygonTool from './multipolygon/RubberbandMultipolygonTool';\nimport RubberbandLineTool from './line/RubberbandLineTool';\n\nconst ALL_TOOLS = new Set([\n  'point',\n  'pointcross',\n  'circle',\n  'ellipse',\n  'freehand',\n  'line',\n  // 'multipolygon' // exclude from defaults for now\n]);\n\nconst SelectorPack = (anno, config) => {\n\n  // Add configured tools, or all\n  const tools = config?.tools ? \n    config.tools.map(t => t.toLowerCase()) : ALL_TOOLS;\n\n  tools.forEach(tool => {\n    if (tool === 'point')\n      anno.addDrawingTool(PointTool);\n\n    if (tool === 'pointcross')\n      anno.addDrawingTool(PointcrossTool);\n\n    if (tool === 'circle')\n      anno.addDrawingTool(RubberbandCircleTool);\n\n    if (tool === 'ellipse')\n      anno.addDrawingTool(RubberbandEllipseTool);\n  \n    if (tool === 'freehand')\n      anno.addDrawingTool(RubberbandFreehandTool);\n\n    if (tool === 'multipolygon')\n      anno.addDrawingTool(RubberbandMultipolygonTool);\n\n    if (tool === 'line')\n      anno.addDrawingTool(RubberbandLineTool);\n  });\n\n}\n\nexport default SelectorPack;\n"],"names":["root","factory","exports","module","define","amd","self","_typeof","o","Symbol","iterator","constructor","prototype","equal","a","b","length","i","keys","Array","isArray","RegExp","source","flags","valueOf","Object","toString","hasOwnProperty","call","key","E","on","name","callback","ctx","e","this","push","fn","once","listener","off","apply","arguments","_","emit","data","slice","evtArr","len","evts","liveEvents","TinyEmitter","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","definition","defineProperty","enumerable","get","obj","prop","getRandomValues","SVG_NAMESPACE","rnds8","Uint8Array","rng","crypto","bind","msCrypto","Error","byteToHex","substr","arr","offset","uuid","toLowerCase","REGEX","test","validate","TypeError","options","buf","rnds","random","stringify","WebAnnotation","annotation","opts","_this","_classCallCheck","_defineProperty","opt_props","opt_opts","_objectSpread","underlying","type","target","selector","find","s","value","other","id","equals","_this$opts","readOnly","motivation","body","set","bodies","_this$selector","exact","_this$selector2","start","_this$selector3","end","_WebAnnotation","args","stub","concat","Selection","cloned","JSON","parse","assign","IMPLEMENTATION_MISSING","isTouch","window","navigator","maxTouchPoints","msMaxTouchPoints","ToolLike","_EventEmitter","g","config","env","_callSuper","ResizeObserver","resizeObserver","svgBounds","svg","getBoundingClientRect","_this$svg$viewBox$bas","viewBox","baseVal","width","height","scale","Math","max","onScaleChanged","observe","parentNode","evt","pt","createSVGPoint","bbox","x","clientX","y","clientY","_this$svg$getBounding","left","top","matrixTransform","getScreenCTM","inverse","offsetX","offsetY","getCTM","containerGroup","document","createElementNS","setAttribute","group","drawCircle","r","c","radius","handleRadius","inner","outer","appendChild","handle","querySelector","parseFloat","getAttribute","closest","image","Element","HTMLDocument","enableResponsive","_inherits","_createClass","disconnect","EventEmitter","Tool","_ToolLike2","_this2","_ref","mouseMove","mouseUp","dblClick","_this2$getSVGPoint","getSVGPoint","started","addEventListener","button","_this2$getSVGPoint2","_this2$getSVGPoint3","removeEventListener","startOnSingleClick","_this2$getSVGPoint4","_this2$env$image","naturalWidth","naturalHeight","startX","startY","startDrawing","formatters","supports","EditableShape","_ToolLike","sanitize","doc","cleanEl","el","from","attributes","forEach","attr","startsWith","removeAttribute","scripts","getElementsByTagName","reverse","removeChild","querySelectorAll","svgFragmentToShape","originalDoc","namespaced","parser","DOMParser","parseFromString","isPrefixDeclared","lookupPrefix","isDefaultNamespaceSVG","lookupNamespaceURI","firstChild","XMLSerializer","serializeToString","documentElement","replace","drawEmbeddedSVG","shape","cloneNode","toSVGTarget","serialized","outerHTML","src","isFirefox","userAgent","formatSvgEl","svgEl","w","h","format","reduce","merged","String","className","nodeType","Node","ELEMENT_NODE","elements","_toConsumableArray","style","element","classNames","Set","split","getClassNames","add","join","addClass","formatterEl","_shape$getBBox","getBBox","append","appendFormatterEl","setFormatterElSize","getPoint","match","EditablePointcross","_EditableShape","point","pointX","pointY","str","_outer$getBBox","elementGroup","grabbedElem","pos","grabbedAt","constrain","coord","delta","_getBBox","_this$env$image","dx","dy","updatedPoint","setPoint","_get","_getPrototypeOf","onMouseMove","onMouseUp","formatter","onGrab","_getBBox2","PointcrossSelection","anchor","display","xy","pointcross","renderedVia","PointcrossTool","_Tool","pointcrossSelection","toSelection","identifier","toUpperCase","includes","parseRectFragment","conformsTo","substring","indexOf","_coords$split$map2","_slicedToArray","map","toFragment","fragmentUnit","px","py","pw","ph","toPercentRectFragment","toPixelRectFragment","toRectFragment","EditablePoint","scaleHandle","isGrabbed","_this$getSVGPoint","setHandleXY","_parseRectFragment","_parseRectFragment2","container","drawHandle","PointTool","_evt$target$closest","_annotation$target$re","isPoint","setXYR","setCircleSize","cx","cy","innerCircle","outerCircle","getCircleSize","CircleMask","imageDimensions","circle","_getCircleSize","tx","ty","mask","_getCircleSize2","RubberbandCircle","anchorX","anchorY","oppositeX","oppositeY","pow","redraw","Mask","pointerEvents","EditableCircle","_this$handles","handles","topleft","topright","bottomright","bottomleft","draggedHandleIdx","anchorHandle","mousePos","getHandleXY","mouseX","mouseY","abs","idx0","idx2","idx3","idx1","setSize","handleIdx","oppositeHandle","stretchCorners","_getCircleSize3","t","_t","RubberbandCircleTool","attachListeners","rubberband","destroy","dragTo","detachListeners","_this$rubberband$getB","minWidth","minSelectionWidth","minHeight","minSelectionHeight","stop","_selector$value","rx","ry","setEllipseSize","innerEllipse","outerEllipse","getEllipseSize","EllipseMask","ellipse","_getEllipseSize","_getEllipseSize2","RubberbandEllipse","drawEllipse","EditableEllipse","leftHandle","anchorLeft","_getEllipseSize3","RubberbandEllipseTool","RubberbandFreehand","points","addPoint","setPoints","freehand","getPoints","pointList","trim","EditableFreehand","round","num","updatedPoints","RubberbandFreehandTool","_isDrawing","onDblClick","PolygonMask","polygon","RubberbandMultipolygon","_step","_iterator","_createForOfIteratorHelper","done","ps","attr2","_step2","_iterator2","p","err","f","head","headRest","lastCorner","pop","multipolygon","pointArray","getPointsFromPathValue","nodeValue","results","allcoords","result","index","coords","toFixed","EditableMultipolygon","_step3","_iterator3","_step4","first","_iterator4","_step5","_iterator5","_i","_updatedPoints","idx","_step6","pointListIDX","found","_iterator6","_step7","updatedPointsIDX","_iterator7","_loop","newPoints","_step8","_iterator8","svgFragmentToPoints","_step9","_iterator9","RubberbandMultipolygonTool","undo","newPart","altKey","ctrlKey","LineMask","line","RubberbandLine","mousepos","Line","innerElement","x1","y1","x2","y2","EditableLine","_xy$split$map2","RubberbandLineTool","ALL_TOOLS","anno","tools","tool","addDrawingTool"],"sourceRoot":""}